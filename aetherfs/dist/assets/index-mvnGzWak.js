(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();const k={hashStr(t){let n=5381;for(let e=0;e<t.length;e++)n=(n<<5)+n^t.charCodeAt(e);return(n>>>0).toString(36)},uid(){return Math.random().toString(36).slice(2,10)},formatSize(t){if(t===0)return"‚Äî";const n=["B","KB","MB","GB","TB"],e=Math.floor(Math.log2(Math.max(t,1))/10),r=t/Math.pow(1024,e);return`${r<10?r.toFixed(1):Math.round(r)} ${n[e]}`},formatDate(t){return!(t instanceof Date)||isNaN(t)?"‚Äî":t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},animate({duration:t=400,easing:n=k.easeInOutCubic,onUpdate:e,onComplete:r}){const i=performance.now();function s(o){const a=Math.min((o-i)/t,1);e(n(a)),a<1?requestAnimationFrame(s):r&&r()}requestAnimationFrame(s)},easeInOutCubic(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2},easeOutExpo(t){return t===1?1:1-Math.pow(2,-10*t)},dist(t,n,e,r){return Math.sqrt((e-t)**2+(r-n)**2)},lerpVec(t,n,e){return{x:t.x+(n.x-t.x)*e,y:t.y+(n.y-t.y)*e}},clamp(t,n,e){return Math.max(n,Math.min(e,t))},clone(t){try{return structuredClone(t)}catch{return JSON.parse(JSON.stringify(t))}},escapeHtml(t){if(t==null)return"";const n=document.createElement("div");return n.textContent=t,n.innerHTML},el(t){return document.getElementById(t)},show(t){t.classList.remove("hidden")},hide(t){t.classList.add("hidden")},toggle(t){t.classList.toggle("hidden")},toast(t,n="info",e=2800){const r=k.el("toast-container");if(!r)return;const i=document.createElement("div");i.className=`toast ${n}`,i.textContent=t,r.appendChild(i),setTimeout(()=>{i.classList.add("exit"),setTimeout(()=>i.remove(),350)},e)},async copyText(t){try{await navigator.clipboard.writeText(t),k.toast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞","success")}catch{k.toast("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å","error")}},debounce(t,n){let e;return(...r)=>{clearTimeout(e),e=setTimeout(()=>t(...r),n)}},throttle(t,n){let e=0;return(...r)=>{const i=Date.now();i-e>=n&&(e=i,t(...r))}}},rt={CATEGORIES:{image:{color:"#a0a0a0",label:"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"},code:{color:"#ffffff",label:"–ö–æ–¥"},video:{color:"#888888",label:"–í–∏–¥–µ–æ"},audio:{color:"#666666",label:"–ê—É–¥–∏–æ"},document:{color:"#cccccc",label:"–î–æ–∫—É–º–µ–Ω—Ç"},archive:{color:"#555555",label:"–ê—Ä—Ö–∏–≤"},folder:{color:"#ffffff",label:"–ü–∞–ø–∫–∞"},"file-group":{color:"#a0c0ff",label:"–ì—Ä—É–ø–ø–∞ —Ñ–∞–π–ª–æ–≤"},unknown:{color:"#444444",label:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}},EXT_MAP:(()=>{const t=new Map,n={image:[".png",".jpg",".jpeg",".svg",".webp",".gif",".avif",".ico",".bmp",".tiff",".heic",".raw"],code:[".js",".ts",".tsx",".jsx",".py",".go",".rs",".cpp",".c",".h",".java",".rb",".php",".swift",".kt",".cs",".html",".css",".scss",".sass",".less",".json",".yaml",".yml",".toml",".xml",".sh",".bash",".zsh",".ps1",".vue",".svelte",".elm",".clj",".ex",".exs",".hs",".ml",".r",".jl",".lua",".dart"],video:[".mp4",".mov",".webm",".mkv",".avi",".m4v",".flv",".wmv",".ogv",".3gp"],audio:[".mp3",".wav",".flac",".aac",".ogg",".m4a",".opus",".wma"],document:[".pdf",".doc",".docx",".md",".txt",".rtf",".xls",".xlsx",".ppt",".pptx",".odt",".ods",".odp",".epub",".pages",".numbers",".key"],archive:[".zip",".tar",".gz",".7z",".rar",".bz2",".xz",".lz4",".zst",".cab"]};for(const[e,r]of Object.entries(n))for(const i of r)t.set(i,e);return t})(),infer(t,n){if(n)return"folder";const e=t.lastIndexOf(".");if(e===-1)return"unknown";const r=t.slice(e).toLowerCase();return rt.EXT_MAP.get(r)||"unknown"},get(t){return rt.CATEGORIES[t]||rt.CATEGORIES.unknown},color(t){return rt.get(t).color},label(t){return rt.get(t).label},radius(t,n=!1){return n?70:60},hexToRgba(t,n=1){const e=parseInt(t.slice(1,3),16),r=parseInt(t.slice(3,5),16),i=parseInt(t.slice(5,7),16);return`rgba(${e},${r},${i},${n})`},heatColor(t){const n=Math.round(255*t);return`rgba(${n}, ${n}, ${n}, 0.8)`}},et={nodes:[],edges:[],alpha:1,running:!1,_raf:null,clusterMode:"folder",onTick:null,cfg:{repulsion:-280,linkDistance:80,linkStrength:.35,centerStrength:.03,alphaDecay:.018,alphaMin:.005,collideBuffer:6,clusterStrength:.12},init(t,n,e="free",r=null){this.nodes=t.map(i=>({...i,vx:(Math.random()-.5)*.5,vy:(Math.random()-.5)*.5,x:i.x!==void 0?i.x:(Math.random()-.5)*600,y:i.y!==void 0?i.y:(Math.random()-.5)*600})),this.edges=n,this.alpha=1,this.mode=e,this.onTick=r,this._calcTreeDepths(this.nodes,this.edges),this.mode==="strict"&&this.applyStrictLayout()},start(){this.running||(this.running=!0,this._tick())},stop(){this.running=!1,this._raf&&(cancelAnimationFrame(this._raf),this._raf=null)},reheat(t=.6){this.alpha=t,this._calcTreeDepths(this.nodes,this.edges),this.running||this.start()},setMode(t){this.mode=t,this._calcTreeDepths(this.nodes,this.edges),this.reheat(.8)},_tick(){if(!this.running||this.alpha<this.cfg.alphaMin){this.running=!1,this.onTick&&this.onTick(this.nodes,!0);return}this._applyForces(),this.alpha*=1-this.cfg.alphaDecay,this.onTick&&this.onTick(this.nodes,!1),this._raf=requestAnimationFrame(()=>this._tick())},_applyForces(){const t=this.cfg,n=this.alpha,e=this._getActiveNodes(),r=this._getActiveEdges(e);if(e.length===0)return;if(e.length<=600)for(let s=0;s<e.length;s++)for(let o=s+1;o<e.length;o++){const a=e[s],d=e[o],c=d.x-a.x||.001,p=d.y-a.y||.001,_=c*c+p*p,m=Math.sqrt(_),h=t.repulsion/_*n,y=h*c/m,f=h*p/m;a.vx-=y,a.vy-=f,d.vx+=y,d.vy+=f}else this._gridRepulsion(e,n);const i=new Map(e.map(s=>[s.id,s]));for(const s of r){const o=i.get(s.source),a=i.get(s.target);if(!o||!a)continue;const d=a.x-o.x,c=a.y-o.y,p=Math.sqrt(d*d+c*c)||.001,_=(p-t.linkDistance)/p*t.linkStrength*n,m=d*_*.5,h=c*_*.5;o.vx+=m,o.vy+=h,a.vx-=m,a.vy-=h}if(this.mode==="free"){let s=0,o=0;for(const a of e)s+=a.x,o+=a.y;s/=e.length,o/=e.length;for(const a of e)a.vx-=(a.x-s)*t.centerStrength*n,a.vy-=(a.y-o)*t.centerStrength*n}if(this.mode==="strict"){for(const s of e)s.fx!==void 0&&s.fx!==null&&(s.x=s.fx,s.y=s.fy,s.vx=0,s.vy=0);return}else this.mode==="radial"&&this._applyRadialGraph(e,n);for(let s=0;s<e.length;s++)for(let o=s+1;o<e.length;o++){const a=e[s],d=e[o],c=(a._radius||10)+(d._radius||10)+t.collideBuffer,p=d.x-a.x||.001,_=d.y-a.y||.001,m=Math.sqrt(p*p+_*_);if(m<c){const h=(c-m)/m*.5;a.vx-=p*h,a.vy-=_*h,d.vx+=p*h,d.vy+=_*h}}for(const s of e)s.fx!==void 0&&s.fx!==null?(s.x=s.fx,s.y=s.fy,s.vx=0,s.vy=0):(s.vx*=.7,s.vy*=.7,s.x+=k.clamp(s.vx,-20,20),s.y+=k.clamp(s.vy,-20,20))},_gridRepulsion(t,n){const r=new Map;for(const i of t){const s=`${Math.floor(i.x/150)},${Math.floor(i.y/150)}`;r.has(s)||r.set(s,[]),r.get(s).push(i)}for(const i of t){const s=Math.floor(i.x/150),o=Math.floor(i.y/150);for(let a=-1;a<=1;a++)for(let d=-1;d<=1;d++){const c=r.get(`${s+a},${o+d}`)||[];for(const p of c){if(p===i)continue;const _=p.x-i.x||.001,m=p.y-i.y||.001,h=_*_+m*m,y=Math.sqrt(h),f=this.cfg.repulsion/h*n*.5;i.vx-=f*_/y,i.vy-=f*m/y}}}},_applyRadialGraph(t,n){for(const r of t){if(r._depth===0){r.vx+=(0-r.x)*.1*n,r.vy+=(0-r.y)*.1*n;continue}const i=(r._depth||1)*200,s=Math.sqrt(r.x*r.x+r.y*r.y)||.1,o=(i-s)*.08*n;r.vx+=r.x/s*o,r.vy+=r.y/s*o;const a=Math.atan2(r.y,r.x),d=r._vIndex||0,c=r._vCount||1,_=d/Math.max(c,1)*Math.PI*2-Math.PI-a;r.vx+=Math.cos(a+Math.PI/2)*_*15*n,r.vy+=Math.sin(a+Math.PI/2)*_*15*n}},_calcTreeDepths(t,n){if(!t||t.length===0)return;for(const h of t)h._depth=-1,h._vIndex=0,h._visited=!1,h._vCount=1,h._maxDepth=0;const e=new Map(t.map(h=>[h.id,h])),r=new Map,i=new Map;for(const h of t)r.set(h.id,[]),i.set(h.id,0);for(const h of n)!e.has(h.source)||!e.has(h.target)||(r.get(h.source).push(h.target),i.set(h.target,(i.get(h.target)||0)+1));const s=[];for(const h of t)(i.get(h.id)||0)===0&&s.push(h);s.length===0&&t.length>0&&s.push(t[0]);const o=new Set,a=[];for(const h of s)h._depth=0,o.add(h.id),a.push(h);for(;a.length>0;){const h=a.shift(),y=r.get(h.id)||[];for(const f of y){if(o.has(f))continue;const v=e.get(f);v&&(v._depth=h._depth+1,o.add(f),a.push(v))}}let d=0;for(const h of t)h._depth>d&&(d=h._depth);for(const h of t)h._depth===-1&&(h._depth=d+1);d=0;for(const h of t)h._depth>d&&(d=h._depth);const c=new Map,p=h=>{const y=e.get(h);if(!y||y._visited)return;y._visited=!0;const f=y._depth;c.has(f)||c.set(f,0),y._vIndex=c.get(f),c.set(f,y._vIndex+1);const v=(r.get(h)||[]).map(g=>e.get(g)).filter(g=>g&&!g._visited).sort((g,x)=>g.name.localeCompare(x.name));for(const g of v)p(g.id)},_=s.sort((h,y)=>h.name.localeCompare(y.name));for(const h of _)p(h.id);for(const h of t)h._visited||p(h.id);const m=new Map;for(const h of t){const y=h._depth;m.set(y,Math.max(m.get(y)||0,h._vIndex+1))}for(const h of t)h._vCount=m.get(h._depth)||1,h._maxDepth=d},applyStrictLayout(t={}){const n=t.onlyUnpositioned===!0,e=this.nodes;if(!e.length)return;this._calcTreeDepths(e,this.edges);const r=300,i=100;for(const s of e){if(n&&s.x!=null&&s.y!=null&&!(s.x===0&&s.y===0))continue;const o=s._depth*r,d=((s._vCount||1)-1)*i,c=s._vIndex*i-d/2;s.x=o,s.y=c,s.vx=0,s.vy=0}},getPositions(){return this.nodes},_getActiveNodes(){const t=new Map(this.nodes.map(r=>[r.id,r])),n=[],e=r=>{let i=r;for(;i&&i.parentId;){const s=t.get(i.parentId);if(s&&s.collapsed)return!0;i=s}return!1};for(const r of this.nodes)e(r)||n.push(r);return n},_getActiveEdges(t){const n=new Set(t.map(e=>e.id));return this.edges.filter(e=>n.has(e.source)&&n.has(e.target))}},W={canvas:null,ctx:null,miniCanvas:null,miniCtx:null,appHooks:null,_cam:{x:0,y:0,scale:1},_targetCam:{x:0,y:0,scale:1},_drag:null,_hoveredId:null,_selectedId:null,_selectedIds:new Set,_draggingNodes:[],_draggingStartPositions:null,nodes:[],edges:[],_nodeMap:new Map,heatmapMode:!1,_highlightId:null,_dimMode:!1,_focusType:null,_dashOffset:0,_animFrame:0,_selectionRect:null,_ctrlDown:!1,_uploadPickerMode:!1,_pathHighlightIds:new Set,FILE_CIRCLE_RADIUS:10,_raf:null,_dirty:!0,init(t,n,e){this.appHooks=e||{},this.canvas=k.el(t),this.ctx=this.canvas.getContext("2d"),this.miniCanvas=k.el(n),this.miniCtx=this.miniCanvas.getContext("2d"),this._bindEvents(),this._loop()},resize(){this._resize()},_resize(){if(!this.canvas||!this.canvas.parentElement)return;const t=this.canvas.parentElement,n=t.clientWidth||window.innerWidth,e=t.clientHeight||window.innerHeight-52;this.canvas.width=n,this.canvas.height=e,this._dirty=!0},loadGraph(t,n){this.nodes=t,this.edges=n,this._nodeMap=new Map(t.map(e=>[e.id,e])),this._dirty=!0},_loop(){(this.canvas.width===0||this.canvas.height===0)&&this._resize();const t=.12;this._cam.x+=(this._targetCam.x-this._cam.x)*t,this._cam.y+=(this._targetCam.y-this._cam.y)*t,this._cam.scale+=(this._targetCam.scale-this._cam.scale)*t;const n=Math.abs(this._targetCam.x-this._cam.x)>.1||Math.abs(this._targetCam.y-this._cam.y)>.1||Math.abs(this._targetCam.scale-this._cam.scale)>.001;(this._dirty||n||et.running||this._drawingConnectionSrc||this._uploadPickerMode)&&(this._render(),this._renderMinimap(),this._dirty=!1),this._updateZoomLabel(),this._raf=requestAnimationFrame(()=>this._loop())},markDirty(){this._dirty=!0},_getThemeColors(){const t=getComputedStyle(document.documentElement);return{bg:t.getPropertyValue("--canvas-bg").trim()||"#111111",dot:t.getPropertyValue("--canvas-dot").trim()||"rgba(255,255,255,0.06)",nodeBg:t.getPropertyValue("--canvas-node-bg").trim()||"#1a1a1a",nodeBgSel:t.getPropertyValue("--canvas-node-bg-sel").trim()||"#262626",nodeBorder:t.getPropertyValue("--canvas-node-border").trim()||"#333333",nodeBorderHov:t.getPropertyValue("--canvas-node-border-hover").trim()||"#555555",edge:t.getPropertyValue("--canvas-edge").trim()||"rgba(255,255,255,0.2)",edgeSel:t.getPropertyValue("--canvas-edge-sel").trim()||"rgba(255,255,255,0.8)",text:t.getPropertyValue("--canvas-text").trim()||"#d1d5db",textSel:t.getPropertyValue("--canvas-text-sel").trim()||"#ffffff"}},_render(){const t=this.ctx,n=this.canvas.width,e=this.canvas.height;if(n===0||e===0)return;const r=this._cam,i=this.nodes,s=this.edges,o=this._getThemeColors();t.fillStyle=o.bg,t.fillRect(0,0,n,e),t.save(),t.translate(n/2+r.x,e/2+r.y),t.scale(r.scale,r.scale);const a=25,d=1,c=n/r.scale+a*2,p=e/r.scale+a*2,_=-r.x/r.scale,m=-r.y/r.scale;t.fillStyle=o.dot;for(let y=_-c;y<_+c;y+=a)for(let f=m-p;f<m+p;f+=a)t.beginPath(),t.arc(y,f,d,0,Math.PI*2),t.fill();this.heatmapMode&&this._drawHeatmapAuras(t,i);const h=this._getVisibleNodes(i);if(this._drawEdges(t,s,h,o),this._drawActiveConnection(t,o),this._drawNodes(t,h,r,o),this._selectionRect){const y=this._selectionRect;t.strokeStyle="rgba(100, 150, 255, 0.7)",t.lineWidth=1,t.setLineDash([4,3]);const f=Math.min(y.x1,y.x2),v=Math.min(y.y1,y.y2),g=Math.abs(y.x2-y.x1),x=Math.abs(y.y2-y.y1);t.strokeRect(f,v,g,x),t.fillStyle="rgba(100, 150, 255, 0.08)",t.fillRect(f,v,g,x),t.setLineDash([])}t.restore(),this._animFrame++,this._dashOffset=(this._dashOffset+.5)%16},setFilesVisible(t){this._filesVisible=t,this._dirty=!0},_getVisibleNodes(t){const n=new Map(t.map(e=>[e.id,e]));return t.filter(e=>{if(e._tempHidden||this._filesVisible===!1&&e.type!=="folder")return!1;let r=e;for(;r&&r.parentId;){const i=n.get(r.parentId);if(i&&i.collapsed)return!1;r=i}return!0})},_drawEdges(t,n,e,r){const i=new Map(e.map(s=>[s.id,s]));for(const s of n){const o=i.get(s.source),a=i.get(s.target);if(!o||!a||o.x==null||a.x==null)continue;const d=o.id===this._selectedId||a.id===this._selectedId||this._selectedIds.has(o.id)||this._selectedIds.has(a.id),c=this._pathHighlightIds.size>0,p=c&&this._pathHighlightIds.has(o.id)&&this._pathHighlightIds.has(a.id);c&&!p&&(t.save(),t.globalAlpha=.08);const _=this._isFolderShape(o)?70:this.FILE_CIRCLE_RADIUS,m=this._isFolderShape(a)?70:this.FILE_CIRCLE_RADIUS,h=o.x+_,y=a.x-m,f=Math.abs(y-h),v=Math.max(f*.45,60);t.strokeStyle=d||p?r.edgeSel:r.edge,t.lineWidth=d||p?2:1,t.beginPath(),t.moveTo(h,o.y),t.bezierCurveTo(h+v,o.y,y-v,a.y,y,a.y),t.stroke(),c&&!p&&t.restore()}},_drawActiveConnection(t,n){if(!this._drawingConnectionSrc||!this._drawingConnectionTo)return;const e=this._drawingConnectionSrc,r=this._drawingConnectionTo;t.strokeStyle=n.edgeSel,t.lineWidth=2,t.setLineDash([6,4]),t.lineDashOffset=-this._dashOffset;const i=this._isFolderShape(e)?70:this.FILE_CIRCLE_RADIUS,s=e.x+i;t.beginPath(),t.moveTo(s,e.y);const o=r.x-s,a=s+o*.5,d=s+o*.5;t.bezierCurveTo(a,e.y,d,r.y,r.x,r.y),t.stroke(),t.setLineDash([]),t.lineDashOffset=0,t.beginPath(),t.arc(r.x,r.y,5,0,Math.PI*2),t.fillStyle=n.edgeSel,t.fill()},_isFolderShape(t){return t.type==="folder"||t.type==="file-group"},_drawFavoriteStar(t,n,e){t.beginPath();for(let s=0;s<5;s++){const o=-Math.PI/2+s*2*Math.PI/5,a=-Math.PI/2+(s+.5)*2*Math.PI/5,d=n+7*Math.cos(o),c=e+7*Math.sin(o),p=n+3*Math.cos(a),_=e+3*Math.sin(a);s===0?t.moveTo(d,c):t.lineTo(d,c),t.lineTo(p,_)}t.closePath(),t.lineCap="round",t.lineJoin="round",t.strokeStyle="rgba(255, 255, 255, 0.85)",t.lineWidth=2,t.stroke()},_drawRect(t,n,e,r,i,s=8){t.beginPath(),t.moveTo(n+s,e),t.lineTo(n+r-s,e),t.quadraticCurveTo(n+r,e,n+r,e+s),t.lineTo(n+r,e+i-s),t.quadraticCurveTo(n+r,e+i,n+r-s,e+i),t.lineTo(n+s,e+i),t.quadraticCurveTo(n,e+i,n,e+i-s),t.lineTo(n,e+s),t.quadraticCurveTo(n,e,n+s,e),t.closePath()},_drawNodes(t,n,e,r){for(const i of n){if(i.x==null)continue;i._timelineHidden&&(t.save(),t.globalAlpha=.08);const s=this._uploadPickerMode&&!i._timelineHidden;s&&i.type!=="folder"&&(t.save(),t.globalAlpha=.15);const o=rt.color(i.type),a=i.id===this._selectedId||this._selectedIds.has(i.id),d=i.id===this._hoveredId,c=i.id===this._highlightId,p=this._dimMode&&this._focusType&&i.type!==this._focusType&&i.id!==this._selectedId,_=this._pathHighlightIds.size>0&&!this._pathHighlightIds.has(i.id);t.save(),t.globalAlpha=p||_?.15:1;const m=this._isFolderShape(i),h=this.FILE_CIRCLE_RADIUS;if(m){const v=i.x-70,g=i.y-36/2;if(t.fillStyle=a?r.nodeBgSel:r.nodeBg,this._drawRect(t,v,g,140,36),t.fill(),t.strokeStyle=c?r.textSel:a?o:d?r.nodeBorderHov:r.nodeBorder,t.lineWidth=a||c?2:1,t.stroke(),t.beginPath(),t.rect(v+10,i.y-4,8,8),t.fillStyle=o,t.fill(),i.type==="folder"&&d){const I=v+140-6,O=i.y,R=5;t.beginPath(),t.arc(I,O,R,0,Math.PI*2),t.fillStyle=o,t.fill(),t.strokeStyle=r.textSel,t.lineWidth=1,t.stroke(),t.strokeStyle=r.textSel,t.lineWidth=1.5,t.beginPath(),t.moveTo(I-2.5,O),t.lineTo(I+2.5,O),t.moveTo(I,O-2.5),t.lineTo(I,O+2.5),t.stroke()}const x=16,C=i.name.length>x?i.name.slice(0,x-1)+"‚Ä¶":i.name;t.font='12px "Inter Tight", sans-serif',t.textAlign="left",t.textBaseline="middle",t.fillStyle=a?r.textSel:r.text,t.fillText(C,v+28,i.y),i.type==="folder"&&i.collapsed&&(t.fillStyle=r.textSel,t.font="bold 12px monospace",t.textAlign="center",t.fillText("+",v+140-22,i.y));const T=this.appHooks?.getFavorites?.();if(T&&T.has(i.id)&&this._drawFavoriteStar(t,v+140-11,i.y),s&&i.type==="folder"){const I=Math.sin(this._animFrame*.05)*.3+.7;t.strokeStyle=`rgba(100, 180, 255, ${I})`,t.lineWidth=3,t.stroke()}if(i._tag){const I={urgent:"#ff4444",review:"#ffaa00",wip:"#44aaff",done:"#44cc44",important:"#cc44ff"};t.fillStyle=I[i._tag]||"#888",t.fillRect(v+2,g+36-4,136,3)}}else{t.beginPath(),t.arc(i.x,i.y,h,0,Math.PI*2),t.fillStyle="rgba(255, 255, 255, 0.9)",t.fill(),t.strokeStyle=c?r.textSel:a?o:d?r.nodeBorderHov:r.nodeBorder,t.lineWidth=a||c?2:1,t.stroke();const y=14,f=i.name.length>y?i.name.slice(0,y-1)+"‚Ä¶":i.name;t.font='12px "Inter Tight", sans-serif',t.textAlign="left",t.textBaseline="middle",t.fillStyle=a?r.textSel:r.text,t.fillText(f,i.x+h+10,i.y);const v=this.appHooks?.getFavorites?.();if(v&&v.has(i.id)&&this._drawFavoriteStar(t,i.x+h+5,i.y),i._tag){const g={urgent:"#ff4444",review:"#ffaa00",wip:"#44aaff",done:"#44cc44",important:"#cc44ff"};t.fillStyle=g[i._tag]||"#888",t.beginPath(),t.arc(i.x+h*.85,i.y+h*.85,4,0,Math.PI*2),t.fill()}}t.restore(),i._timelineHidden&&t.restore(),s&&i.type!=="folder"&&t.restore()}},_drawHeatmapAuras(t,n){const e=Math.max(...n.map(r=>r.subtreeSizeBytes||0),1);for(const r of n.filter(i=>i.type==="folder")){if(r.x==null)continue;const i=(r.subtreeSizeBytes||0)/e;if(i<.01)continue;const s=r._radius*(1.5+i*4);t.beginPath(),t.arc(r.x,r.y,s,0,Math.PI*2),t.fillStyle=`rgba(255, 255, 255, ${.05+i*.1})`,t.fill()}},_renderMinimap(){const t=this.miniCtx,n=this.miniCanvas.width,e=this.miniCanvas.height,r=this.nodes;if(!r.length)return;let i=1/0,s=-1/0,o=1/0,a=-1/0;for(const C of r)C.x!=null&&(i=Math.min(i,C.x),s=Math.max(s,C.x),o=Math.min(o,C.y),a=Math.max(a,C.y));if(!isFinite(i))return;const d=10,c=s-i||1,p=a-o||1,_=Math.min((n-d*2)/c,(e-d*2)/p);t.fillStyle="#0a0a0a",t.fillRect(0,0,n,e);for(const C of r){if(C.x==null)continue;const T=Math.max(2,C._radius*_*.7),I=(C.x-i)*_+d,O=(C.y-o)*_+d;t.fillStyle=rt.hexToRgba(rt.color(C.type),.7),this._isFolderShape(C)?t.fillRect(I-T/2,O-T*.25,T,T*.5):(t.beginPath(),t.arc(I,O,Math.max(2,T*.5),0,Math.PI*2),t.fill())}const m=this._cam,h=this.canvas.width,y=this.canvas.height,f=h/m.scale,v=y/m.scale,g=-m.x/m.scale,x=-m.y/m.scale;t.strokeStyle="rgba(255,255,255,0.4)",t.lineWidth=1,t.strokeRect((g-c/2-i)*_+d,(x-p/2-o)*_+d,f*_,v*_)},zoom(t,n,e){n==null&&(n=this.canvas.width/2),e==null&&(e=this.canvas.height/2);const r=k.clamp(this._targetCam.scale*t,.04,6);this._targetCam.scale=r,this._dirty=!0},fitView(){if(!this.nodes.length)return;this.canvas.width===0&&this._resize();let t=1/0,n=-1/0,e=1/0,r=-1/0;for(const p of this.nodes)p.x!=null&&(t=Math.min(t,p.x),n=Math.max(n,p.x),e=Math.min(e,p.y),r=Math.max(r,p.y));if(!isFinite(t))return;const i=n-t||100,s=r-e||100,o=t+i/2,a=e+s/2,d=120,c=k.clamp(Math.min((this.canvas.width-d)/i,(this.canvas.height-d)/s),.06,2.5);this._targetCam.x=-o*c,this._targetCam.y=-a*c,this._targetCam.scale=c,this._dirty=!0},panTo(t,n){const e=this._nodeMap.get(t);if(!e||e.x==null)return;const r=n||Math.max(this._targetCam.scale,1.2);this._targetCam.x=-e.x*r,this._targetCam.y=-e.y*r,this._targetCam.scale=r,this._dirty=!0},screenToWorld(t,n){const e=this.canvas.width,r=this.canvas.height;return{x:(t-e/2-this._cam.x)/this._cam.scale,y:(n-r/2-this._cam.y)/this._cam.scale}},hitTest(t,n,e=null){const r=this.FILE_CIRCLE_RADIUS,i=new Set(this._getVisibleNodes(this.nodes).map(s=>s.id));for(let s=this.nodes.length-1;s>=0;s--){const o=this.nodes[s];if(!(o.x==null||!i.has(o.id))&&!(e&&o.id===e)){if(this._isFolderShape(o)){if(t>=o.x-70&&t<=o.x+70&&n>=o.y-18&&n<=o.y+18)return o}else if(k.dist(t,n,o.x,o.y)<=r)return o}}return null},hitTestPort(t,n){for(let e=this.nodes.length-1;e>=0;e--){const r=this.nodes[e];if(r.x==null||r.type!=="folder")continue;const i=r.x+64;if(k.dist(t,n,i,r.y)<=10)return r}return null},_bindEvents(){const t=this.canvas;window.addEventListener("keydown",n=>{n.key==="Control"&&(this._ctrlDown=!0)}),window.addEventListener("keyup",n=>{n.key==="Control"&&(this._ctrlDown=!1)}),t.addEventListener("wheel",n=>{n.preventDefault(),this.zoom(n.deltaY<0?1.12:.89,n.offsetX,n.offsetY)},{passive:!1}),t.addEventListener("mousedown",n=>{if(n.button===0||n.button===1){const e=this.screenToWorld(n.offsetX,n.offsetY),r=this.hitTestPort(e.x,e.y);if(r&&n.button===0){this._drawingConnectionSrc=r,this._drawingConnectionTo={x:e.x,y:e.y},this._drag=null;return}const i=this.hitTest(e.x,e.y);if(this._drag={startX:n.clientX,startY:n.clientY,camX:this._targetCam.x,camY:this._targetCam.y,clickedNode:i,moved:!1,worldStartX:e.x,worldStartY:e.y,ctrlWasHeld:this._ctrlDown},!i&&this._ctrlDown&&n.button===0&&(this._selectionRect={x1:e.x,y1:e.y,x2:e.x,y2:e.y}),i&&n.button===0){this._draggingNode=i;const o=(i.id===this._selectedId||this._selectedIds.has(i.id))&&(this._selectedId||this._selectedIds.size>0)?[this._selectedId,...this._selectedIds].filter(Boolean):[i.id];this._draggingNodes=o.map(a=>this._nodeMap.get(a)).filter(Boolean),this._draggingStartPositions=new Map;for(const a of this._draggingNodes)a.fx=a.x,a.fy=a.y,this._draggingStartPositions.set(a.id,{x:a.x,y:a.y});et&&(et.alpha=.3)}}}),t.addEventListener("mousemove",n=>{const e=this.screenToWorld(n.offsetX,n.offsetY);if(this._drawingConnectionSrc){this._drawingConnectionTo={x:e.x,y:e.y},this._dirty=!0;return}if(this._selectionRect&&(this._selectionRect.x2=e.x,this._selectionRect.y2=e.y,this._dirty=!0),this._draggingNode&&this._draggingStartPositions){const s=n.clientX-this._drag.startX,o=n.clientY-this._drag.startY;if(Math.abs(s)>4||Math.abs(o)>4){this._drag.moved=!0;const a=e.x-this._drag.worldStartX,d=e.y-this._drag.worldStartY;for(const c of this._draggingNodes){const p=this._draggingStartPositions.get(c.id);p&&(c.fx=p.x+a,c.fy=p.y+d,et&&et.mode==="strict"&&(c.x=c.fx,c.y=c.fy))}et&&(et.alpha=.3),this._dirty=!0}}else if(this._drag){const s=n.clientX-this._drag.startX,o=n.clientY-this._drag.startY;(Math.abs(s)>2||Math.abs(o)>2)&&(this._drag.moved=!0,!this._ctrlDown&&(!this._drag.clickedNode||n.button===1)&&(this._targetCam.x=this._drag.camX+s,this._targetCam.y=this._drag.camY+o,this._dirty=!0))}const r=this.hitTest(e.x,e.y),i=this._hoveredId;this._hoveredId=r?r.id:null,i!==this._hoveredId&&(this._dirty=!0,t.style.cursor=r?"pointer":this._drag&&!this._draggingNode?"grabbing":"grab")}),t.addEventListener("mouseup",n=>{const e=this.screenToWorld(n.offsetX,n.offsetY);if(this._drawingConnectionSrc){const r=this.hitTest(e.x,e.y);!r&&n.button===0&&this.appHooks.onConnectionDrop&&this.appHooks.onConnectionDrop(this._drawingConnectionSrc,n.clientX,n.clientY,e.x,e.y),r&&r.type==="folder"&&r.id!==this._drawingConnectionSrc.id&&this.appHooks.onNodeMoveAttempt&&this.appHooks.onNodeMoveAttempt(this._drawingConnectionSrc,r),this._drawingConnectionSrc=null,this._drawingConnectionTo=null,this._dirty=!0;return}if(this._draggingNode){const r=this.hitTest(e.x,e.y,this._draggingNode.id);if(r&&r.id!==this._draggingNode.id&&r.type==="folder"){const i=[];if(this._selectedIds.size>0&&this._selectedIds.has(this._draggingNode.id))for(const s of this._selectedIds){const o=this.nodes.find(a=>a.id===s);o&&o.id!==r.id&&i.push(o)}else i.push(this._draggingNode);if(this.appHooks?.onShowMoveCopyMenu)this.appHooks.onShowMoveCopyMenu(i.length===1?i[0]:i,r,n.clientX,n.clientY);else if(this.appHooks?.onNodeMoveAttempt)for(const s of i)this.appHooks.onNodeMoveAttempt(s,r)}for(const i of this._draggingNodes)i.x=i.fx??i.x,i.y=i.fy??i.y,i.fx=null,i.fy=null;this._draggingNode=null,this._draggingNodes=[],this._draggingStartPositions=null,et&&(et.alpha=.1),this._dirty=!0}if(this._selectionRect){const r=this._selectionRect,i=Math.min(r.x1,r.x2),s=Math.max(r.x1,r.x2),o=Math.min(r.y1,r.y2),a=Math.max(r.y1,r.y2),d=this.FILE_CIRCLE_RADIUS;this._ctrlDown||this._selectedIds.clear();for(const c of this.nodes){if(c.x==null)continue;const p=this._isFolderShape(c)?70:d,_=this._isFolderShape(c)?18:d;c.x>=i-p&&c.x<=s+p&&c.y>=o-_&&c.y<=a+_&&this._selectedIds.add(c.id)}this._selectionRect=null,this._dirty=!0,this._drag=null,t.style.cursor="grab";return}if(this._drag&&!this._drag.moved&&this._drag.clickedNode&&n.button===0){const r=this._drag.clickedNode.id;this._ctrlDown?(this._selectedIds.has(r)?this._selectedIds.delete(r):this._selectedIds.add(r),this._dirty=!0):(this._selectedIds.clear(),this.selectNode(r),this._highlightPath(r))}else this._drag&&!this._drag.moved&&!this._drag.clickedNode&&n.button===0&&!this._ctrlDown&&(this._selectedIds.clear(),this._selectedId=null,this._pathHighlightIds.clear(),this._dirty=!0);this._drag=null,t.style.cursor="grab"}),t.addEventListener("mouseleave",()=>{this._drag=null}),t.addEventListener("contextmenu",n=>{n.preventDefault();const e=this.screenToWorld(n.offsetX,n.offsetY),r=this.hitTest(e.x,e.y);r&&(this.selectNode(r.id),this.appHooks.onContextMenu&&this.appHooks.onContextMenu(n.clientX,n.clientY,r.id))}),window.addEventListener("resize",k.debounce(()=>{this._resize()},150))},selectNode(t){this._selectedId=t,this._dirty=!0,this.appHooks.onNodeSelect&&this.appHooks.onNodeSelect(t)},deselect(){this._selectedId=null,this._highlightId=null,this._dirty=!0},highlightNode(t){this._highlightId=t,this._dirty=!0},setDimMode(t,n){this._dimMode=t,this._focusType=n||null,this._dirty=!0},_highlightPath(t){if(this._pathHighlightIds.clear(),!t)return;const n=new Map,e=new Map;for(const s of this.edges)n.set(s.target,s.source),e.has(s.source)||e.set(s.source,[]),e.get(s.source).push(s.target);let r=t;for(;r;)this._pathHighlightIds.add(r),r=n.get(r)||null;const i=[t];for(;i.length>0;){const s=i.pop();this._pathHighlightIds.add(s);const o=e.get(s)||[];for(const a of o)this._pathHighlightIds.has(a)||i.push(a)}this._dirty=!0},showInlineInput(t,n,e,r){this.hideInlineInput();const i=this.worldToScreen(t,n),s=document.createElement("input");s.type="text",s.placeholder=e||"–ò–º—è...",s.className="inline-node-input",s.style.cssText=`
            position:fixed; left:${i.x-80}px; top:${i.y-16}px;
            width:180px; padding:8px 12px; font-size:13px;
            background:rgba(20,25,40,0.95); color:#e0e8ff;
            border:2px solid rgba(100,180,255,0.5); border-radius:8px;
            outline:none; z-index:10000; backdrop-filter:blur(8px);
            box-shadow:0 4px 20px rgba(0,0,0,0.5);
            font-family:'Inter Tight',sans-serif;
            animation: inlineInputAppear 0.2s ease-out;
        `,document.body.appendChild(s),this._inlineInput=s,requestAnimationFrame(()=>s.focus());const o=()=>{const a=s.value.trim();this.hideInlineInput(),a&&r&&r(a)};s.addEventListener("keydown",a=>{a.key==="Enter"&&o(),a.key==="Escape"&&this.hideInlineInput()}),s.addEventListener("blur",()=>{setTimeout(()=>this.hideInlineInput(),100)})},hideInlineInput(){this._inlineInput&&this._inlineInput.parentNode&&this._inlineInput.parentNode.removeChild(this._inlineInput),this._inlineInput=null},worldToScreen(t,n){const e=this._cam;return{x:t*e.scale+e.x+this.canvas.width/2,y:n*e.scale+e.y+this.canvas.height/2}},_updateZoomLabel(){const t=k.el("zoom-level");t&&(t.textContent=`${Math.round(this._cam.scale*100)}%`)}},It={nodes:[],_query:"",_results:[],load(t){this.nodes=t},query(t,n=30){if(this._query=t.toLowerCase().trim(),!this._query)return this._results=[],[];const e=[];for(const r of this.nodes){const i=this._score(r,this._query);i>0&&e.push({node:r,score:i})}return e.sort((r,i)=>i.score-r.score),this._results=e.slice(0,n).map(r=>r.node),this._results},_score(t,n){const e=t.name.toLowerCase(),r=t.path.toLowerCase();if(e===n)return 100;if(e.startsWith(n))return 80;const i=e.indexOf(n);if(i!==-1)return 60-i*.5;if(r.includes(n))return 30;let s=0;for(let o=0;o<e.length&&s<n.length;o++)e[o]===n[s]&&s++;return s===n.length?Math.max(1,20-(e.length-n.length)):0},highlight(t,n){if(!n)return this._escape(t);const e=n.toLowerCase(),i=t.toLowerCase().indexOf(e);if(i!==-1)return this._escape(t.slice(0,i))+`<mark>${this._escape(t.slice(i,i+e.length))}</mark>`+this._escape(t.slice(i+e.length));let s="",o=0;for(let a=0;a<t.length;a++)o<e.length&&t[a].toLowerCase()===e[o]?(s+=`<mark>${this._escape(t[a])}</mark>`,o++):s+=this._escape(t[a]);return s},_escape(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},renderResults(t,n,e,r){if(n.length===0){t.innerHTML=e?`<div class="search-empty">–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å—É "<strong>${this._escape(e)}</strong>" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>`:'<div class="search-empty">–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫‚Ä¶</div>';return}t.innerHTML=n.map((i,s)=>`
                <div class="search-result" data-id="${i.id}">
                    <div class="sr-icon"><div style="background: ${rt.color(i.type)}; width: 10px; height: 10px;"></div></div>
                    <div class="sr-info">
                        <div class="sr-name">${this.highlight(i.name,e)}</div>
                        <div class="sr-path">${this.highlight(i.path,e)}</div>
                    </div>
                </div>
            `).join(""),this._onSelect=r,t.querySelectorAll(".search-result").forEach(i=>{i.addEventListener("click",()=>{this._onSelect&&this._onSelect(i.dataset.id)})})}},Yt={create:"–°–æ–∑–¥–∞–Ω–∏–µ",delete:"–£–¥–∞–ª–µ–Ω–∏–µ",move:"–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ",copy:"–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ",rename:"–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ",upload:"–ó–∞–≥—Ä—É–∑–∫–∞"},mt={_entries:[],_containerId:"activity-log-entries",_panelId:"activity-log-panel",_maxEntries:100,add({type:t,title:n,status:e="success",tags:r=[],steps:i=[]}){const s=k.uid(),o={id:s,type:t||"unknown",title:n||Yt[t]||"–î–µ–π—Å—Ç–≤–∏–µ",status:e,time:new Date,tags:Array.isArray(r)?r:[r].filter(Boolean),steps:Array.isArray(i)?i:[]};return this._entries.unshift(o),this._entries.length>this._maxEntries&&this._entries.pop(),this._render(),s},setStatus(t,n,e=null){const r=this._entries.find(i=>i.id===t);r&&(r.status=n,e&&(r.steps=e),this._render())},_timeStr(t){return t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})},_render(){const t=document.getElementById(this._containerId);t&&(t.innerHTML=this._entries.map(n=>this._renderEntry(n)).join(""),t.querySelectorAll(".activity-entry-toggle").forEach(n=>{n.addEventListener("click",()=>{const e=n.closest(".activity-entry");e&&e.classList.toggle("is-expanded")})}))},_renderEntry(t){t.tags.length>0||t.steps.length>0;const n=this._statusIcon(t.status),e=this._timeStr(t.time),r=t.steps.length?t.steps.map(o=>`
                <div class="activity-step">
                    <span class="activity-step-icon">${o.status==="pending"?this._spinnerSvg():this._checkSvg()}</span>
                    <span class="activity-step-text">${this._escape(o.text)}</span>
                </div>`).join(""):"",i=t.tags.length?`<div class="activity-tags">${t.tags.map(o=>`<span class="activity-tag">${this._escape(o)}</span>`).join("")}</div>`:"",s=t.steps.length>0;return`
            <div class="activity-entry ${s?"has-details":""}" data-id="${t.id}">
                <div class="activity-timeline-dot ${t.status}">${n}</div>
                <div class="activity-body">
                    <div class="activity-header">
                        <button type="button" class="activity-entry-toggle" aria-expanded="false">
                            <span class="activity-title">${this._escape(t.title)}</span>
                            ${s?'<span class="activity-caret">‚ñº</span>':""}
                        </button>
                        <span class="activity-time">${e}</span>
                    </div>
                    ${i}
                    ${r?`<div class="activity-steps">${r}</div>`:""}
                </div>
            </div>`},_statusIcon(t){return t==="pending"?this._spinnerSvg():t==="error"?this._errorSvg():this._checkSvg()},_checkSvg(){return'<svg class="activity-icon activity-icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>'},_spinnerSvg(){return'<svg class="activity-icon activity-icon-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10" stroke-dasharray="32" stroke-dashoffset="12"/></svg>'},_errorSvg(){return'<svg class="activity-icon activity-icon-error" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>'},_escape(t){if(t==null)return"";const n=document.createElement("div");return n.textContent=t,n.innerHTML},togglePanel(){const t=document.getElementById(this._panelId);t&&t.classList.toggle("hidden")},isPanelVisible(){const t=document.getElementById(this._panelId);return t&&!t.classList.contains("hidden")}},kt={enterUploadPickerMode(t){if(!t._pendingUploadFiles||t._pendingUploadFiles.length===0)return;t._uploadPickerMode=!0;const n=k.el("upload-picker-banner");if(n){const r=t._pendingUploadFiles.length,i=t._pendingUploadFiles.map(o=>o.name).slice(0,3).join(", "),s=r>3?` –∏ –µ—â—ë ${r-3}...`:"";n.querySelector(".upload-picker-text").textContent=`üìÅ –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏: ${i}${s}`,k.show(n)}W.setDimMode(!0,"folder"),W._uploadPickerMode=!0,W.markDirty();const e=r=>{const i=W.screenToWorld(r.offsetX,r.offsetY),s=W.hitTest(i.x,i.y);s&&s.type==="folder"&&(r.stopImmediatePropagation(),W.canvas.removeEventListener("click",e,!0),kt.uploadToFolder(t,s))};t._uploadClickHandler=e,W.canvas.addEventListener("click",e,!0)},exitUploadPickerMode(t){t._uploadPickerMode=!1,t._pendingUploadFiles=null,W.setDimMode(!1),W._uploadPickerMode=!1,W.markDirty(),k.hide(k.el("upload-picker-banner")),t._uploadClickHandler&&(W.canvas.removeEventListener("click",t._uploadClickHandler,!0),t._uploadClickHandler=null)},cancelUploadPicker(t){kt.exitUploadPickerMode(t),k.toast("–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞","info",1500)},async uploadToFolder(t,n){const e=t.getStorage?.(),r=t.isDropboxMode?.()??!1,i=[...t._pendingUploadFiles||[]];if(kt.exitUploadPickerMode(t),i.length===0)return;k.toast(`‚¨Ü –ó–∞–≥—Ä—É–∑–∫–∞ ${i.length} —Ñ–∞–π–ª(–æ–≤) –≤ ${n.name}...`,"info",3e3);let s=0;for(const o of i)try{if(r&&e?.uploadFile){const a=(n._dbxPath||n.path||"/"+n.name)+"/"+o.name;await e.uploadFile(a,o),s++}}catch(a){k.toast(`–û—à–∏–±–∫–∞: ${o.name}: ${a.message}`,"error",3e3)}if(s>0){k.toast(`‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${s} —Ñ–∞–π–ª(–æ–≤) –≤ ${n.name}`,"success",3e3);const o=i.slice(0,5).map(a=>a.name);i.length>5&&o.push(`‚Ä¶–µ—â—ë ${i.length-5}`),mt.add({type:"upload",title:`–ó–∞–≥—Ä—É–∑–∫–∞ –≤ ¬´${n.name}¬ª`,status:"success",tags:[n.name,`${s} —Ñ–∞–π–ª(–æ–≤)`,...o]}),t._syncDropboxNow&&t._syncDropboxNow()}}},Rt={open(t){if(t._timelineOpen){Rt.close(t);return}t._timelineOpen=!0;const n=t._nodes.filter(d=>d.modifiedAt instanceof Date&&!isNaN(d.modifiedAt)).map(d=>d.modifiedAt.getTime());if(n.length===0){k.toast("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –¥–∞—Ç–∞—Ö","info"),t._timelineOpen=!1;return}const e=new Date(Math.min(...n)),r=new Date(Math.max(...n)),i=k.el("timeline-from"),s=k.el("timeline-to"),o=k.el("timeline-range");i.value=e.toISOString().split("T")[0],s.value=r.toISOString().split("T")[0],o.value=100;const a=()=>{const d=new Date(i.value).getTime(),c=parseInt(o.value,10),p=new Date(s.value).getTime(),_=d+(p-d)*(c/100);let m=0;for(const y of t._nodes){if(y.type==="folder"){y._timelineHidden=!1;continue}const f=y.modifiedAt instanceof Date?y.modifiedAt.getTime():0;y._timelineHidden=f<d||f>_,y._timelineHidden||m++}const h=k.el("timeline-count");h&&(h.textContent=`${m}`),W.markDirty()};i.addEventListener("change",a),s.addEventListener("change",a),o.addEventListener("input",a),t._timelineCleanup=()=>{i.removeEventListener("change",a),s.removeEventListener("change",a),o.removeEventListener("input",a)},k.show(k.el("timeline-panel")),a()},close(t){t._timelineOpen=!1,t._timelineCleanup&&(t._timelineCleanup(),t._timelineCleanup=null),k.hide(k.el("timeline-panel"));for(const n of t._nodes)n._timelineHidden=!1;W.markDirty()}},Kt={renderTree(t,n){const e=k.el("tree-container");if(!e)return;const r=new Map;let i=null;for(const o of n)o.parentId?(r.has(o.parentId)||r.set(o.parentId,[]),r.get(o.parentId).push(o)):i=o;for(const o of r.values())o.sort((a,d)=>a.type==="folder"&&d.type!=="folder"?-1:d.type==="folder"&&a.type!=="folder"?1:a.name.localeCompare(d.name));const s=o=>{const a=o.type==="folder",d=r.get(o.id)||[];let c=`
                <div class="tree-item" data-id="${k.escapeHtml(o.id)}">
                    ${a?'<span class="tree-expander open">‚ñº</span>':'<span style="width:14px;display:inline-block"></span>'}
                    <div style="background: ${rt.color(o.type)}; width: 8px; height: 8px; display: inline-block; margin-right: 8px; opacity: 0.8;"></div>
                    <span class="tree-item-label">${k.escapeHtml(o.name)}</span>
                </div>
            `;if(a&&d.length>0){c+='<div class="tree-children">';for(const p of d)c+=s(p);c+="</div>"}return c};i?e.innerHTML=s(i):e.innerHTML='<div style="opacity:0.5; text-align:center; padding: 20px 0;">–ü—É—Å—Ç–æ</div>',e.querySelectorAll(".tree-item").forEach(o=>{o.addEventListener("click",a=>{a.stopPropagation(),document.querySelectorAll(".tree-item").forEach(d=>d.classList.remove("selected")),o.classList.add("selected"),t.onNodeSelect(o.dataset.id),W.panTo(o.dataset.id,1.5)})}),e.querySelectorAll(".tree-expander").forEach(o=>{o.addEventListener("click",a=>{a.stopPropagation();const d=o.classList.contains("open"),c=o.closest(".tree-item").nextElementSibling;d?(o.classList.remove("open"),o.textContent="‚ñ∂",c?.classList.contains("tree-children")&&(c.style.display="none")):(o.classList.add("open"),o.textContent="‚ñº",c?.classList.contains("tree-children")&&(c.style.display="block"))})})}};class Zt{constructor(){this.nodes=[],this.edges=[],this.rootName="",this.totalFiles=0,this.totalFolders=0}async openDirectory(n){let e;try{e=await window.showDirectoryPicker({mode:"readwrite"})}catch(o){if(o.name==="AbortError")return null;throw o}this.nodes=[],this.edges=[],this.totalFiles=0,this.totalFolders=0,this.rootName=e.name;const r=k.hashStr(e.name),i={id:r,name:e.name,path:e.name,type:"folder",sizeBytes:0,subtreeSizeBytes:0,modifiedAt:new Date,parentId:null,handle:e,_radius:rt.radius(0,!0)};this.nodes.push(i),this.totalFolders++;const s=await this._walkDir(e,r,e.name,n);i.subtreeSizeBytes=s,i._radius=rt.radius(s,!0);for(const o of this.nodes)o.type==="folder"?o._radius=rt.radius(o.subtreeSizeBytes,!0):o._radius=rt.radius(o.sizeBytes,!1);return{nodes:this.nodes,edges:this.edges}}async _walkDir(n,e,r,i){let s=0;const o=[];try{for await(const[a,d]of n.entries())a.startsWith(".")||a==="node_modules"||a==="$RECYCLE.BIN"||o.push([a,d])}catch{return 0}o.sort(([a,d],[c,p])=>d.kind===p.kind?a.localeCompare(c):d.kind==="directory"?-1:1);for(const[a,d]of o){const c=`${r}/${a}`,p=k.hashStr(c),_=d.kind==="directory";if(i&&i(this.totalFiles+this.totalFolders,a),_){const m={id:p,name:a,path:c,type:"folder",sizeBytes:0,subtreeSizeBytes:0,modifiedAt:new Date,parentId:e,handle:d,_radius:16};this.nodes.push(m),this.edges.push({id:`${e}-${p}`,source:e,target:p}),this.totalFolders++;const h=await this._walkDir(d,p,c,i);m.subtreeSizeBytes=h,m._radius=rt.radius(h,!0),s+=h}else{const h=new Date,y={id:p,name:a,path:c,type:rt.infer(a,!1),sizeBytes:0,subtreeSizeBytes:0,modifiedAt:h,parentId:e,handle:d,_radius:rt.radius(0,!1)};this.nodes.push(y),this.edges.push({id:`${e}-${p}`,source:e,target:p}),this.totalFiles++,s+=0}}return s}async readFileText(n,e=8e3){try{return await(await n.getFile()).slice(0,e).text()}catch{return null}}async readFileURL(n){try{return URL.createObjectURL(await n.getFile())}catch{return null}}async getFileBlob(n){if(!n||!n.handle||n.type==="folder")return null;try{return await n.handle.getFile()}catch(e){return console.warn("[LocalFS] getFileBlob error:",e.message),null}}async createFolder(n,e){const r=this.nodes.find(i=>i.id===n);if(!r||!r.handle||r.handle.kind!=="directory")return null;try{return await r.handle.getDirectoryHandle(e,{create:!0})}catch(i){return console.error(i),null}}async createFile(n,e){const r=this.nodes.find(i=>i.id===n);if(!r||!r.handle||r.handle.kind!=="directory")return null;try{return await r.handle.getFileHandle(e,{create:!0})}catch(i){return console.error(i),null}}async moveNode(n,e){if(!n||!n.handle)throw new Error("Source not a valid local file");if(!e||!e.handle||e.handle.kind!=="directory")throw new Error("Target is not a valid directory");try{if(typeof n.handle.move=="function")return await n.handle.move(e.handle,n.name),!0;throw new Error("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ.")}catch(r){throw console.error("Failed to move local node:",r),r}}generateDemo(){this.nodes=[],this.edges=[];const n=(e,r,i,s,o,a,d=new Date)=>{const c={id:e,name:r,path:i,type:s,sizeBytes:o,subtreeSizeBytes:o,modifiedAt:d,parentId:a,handle:null,_radius:rt.radius(o,s==="folder")};return this.nodes.push(c),a&&this.edges.push({id:`${a}-${e}`,source:a,target:e}),c};return n("root","my-project","my-project","folder",0,null),n("src","src","my-project/src","folder",0,"root"),n("src_app","App.tsx","my-project/src/App.tsx","code",8400,"src"),n("src_main","main.tsx","my-project/src/main.tsx","code",2100,"src"),n("comp","components","my-project/src/components","folder",0,"src"),n("c_btn","Button.tsx","my-project/src/components/Button.tsx","code",2800,"comp"),n("assets","assets","my-project/src/assets","folder",0,"src"),n("a_logo","logo.svg","my-project/src/assets/logo.svg","image",12400,"assets"),n("pub","public","my-project/public","folder",0,"root"),n("pub_vid","demo.mp4","my-project/public/demo.mp4","video",185e5,"pub"),this._computeSubtreeSizes(),this.rootName="my-project [DEMO]",{nodes:this.nodes,edges:this.edges}}_computeSubtreeSizes(){const n=new Map(this.nodes.map(i=>[i.id,i])),e=(i,s=new Set)=>{if(s.has(i))return 0;s.add(i);const o=n.get(i);if(!o)return 0;if(o.type!=="folder")return o.sizeBytes;const a=this.edges.filter(c=>c.source===i).map(c=>c.target);let d=0;for(const c of a)d+=e(c,s);return o.subtreeSizeBytes=d,o._radius=rt.radius(d,!0),d},r=this.nodes.find(i=>!i.parentId);r&&e(r.id)}}const qt={},At=qt?.VITE_DROPBOX_APP_KEY||"wdia6zo086h1n2a",Jt="https://www.dropbox.com/oauth2/authorize",Ut="https://api.dropboxapi.com/oauth2/token",yt={ACCESS_TOKEN:"dbx_access_token",REFRESH_TOKEN:"dbx_refresh_token",EXPIRES_AT:"dbx_expires_at",CODE_VERIFIER:"dbx_code_verifier",REDIRECT_URI:"dbx_redirect_uri"};function $t(){const t=sessionStorage.getItem(yt.REDIRECT_URI);if(t)return t;const n=new URL(window.location.href);return n.origin+n.pathname}const Tt={_generateCodeVerifier(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=new Uint8Array(64);return crypto.getRandomValues(n),Array.from(n,e=>t[e%t.length]).join("")},_generateState(){const t=new Uint8Array(16);return crypto.getRandomValues(t),Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")},async _sha256(t){const e=new TextEncoder().encode(t);return await crypto.subtle.digest("SHA-256",e)},_base64urlEncode(t){let n="";const e=new Uint8Array(t);for(const r of e)n+=String.fromCharCode(r);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},isLoggedIn(){return!!sessionStorage.getItem(yt.ACCESS_TOKEN)},async getAccessToken(){const t=sessionStorage.getItem(yt.ACCESS_TOKEN),n=parseInt(sessionStorage.getItem(yt.EXPIRES_AT)||"0",10);if(t&&Date.now()<n-3e5)return t;const e=sessionStorage.getItem(yt.REFRESH_TOKEN);if(e)try{return await this._refreshAccessToken(e)}catch(r){return console.error("Token refresh failed:",r),this.logout(),null}return t||null},async login(){this.logout();const t=this._generateCodeVerifier();sessionStorage.setItem(yt.CODE_VERIFIER,t);const n=await this._sha256(t),e=this._base64urlEncode(n),r=$t();sessionStorage.setItem(yt.REDIRECT_URI,r);const i=this._generateState();sessionStorage.setItem("dbx_oauth_state",i);const s=new URLSearchParams({client_id:At,response_type:"code",code_challenge:e,code_challenge_method:"S256",redirect_uri:r,token_access_type:"offline",state:i});console.log("[DropboxAuth] Redirecting to Dropbox OAuth..."),console.log("[DropboxAuth] Redirect URI:",r),window.location.href=`${Jt}?${s.toString()}`},logout(){Object.values(yt).forEach(t=>sessionStorage.removeItem(t)),sessionStorage.removeItem("dbx_oauth_state")},async handleCallback(){const t=new URLSearchParams(window.location.search),n=t.get("code"),e=t.get("state");if(!n)return!1;const r=sessionStorage.getItem("dbx_oauth_state");if(e!==r)return console.error("[DropboxAuth] OAuth state mismatch ‚Äî possible CSRF attack"),console.error("[DropboxAuth] Expected:",r,"Got:",e),!1;sessionStorage.removeItem("dbx_oauth_state");const i=sessionStorage.getItem(yt.CODE_VERIFIER);if(!i)return console.error("[DropboxAuth] Missing code_verifier ‚Äî auth flow broken"),!1;const s=$t();console.log("[DropboxAuth] Exchanging code for token..."),console.log("[DropboxAuth] Redirect URI for token exchange:",s);try{const o=new URLSearchParams({grant_type:"authorization_code",code:n,client_id:At,redirect_uri:s,code_verifier:i}),a=await fetch(Ut,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()});if(!a.ok){const c=await a.text();throw console.error("[DropboxAuth] Token exchange failed:",a.status,c),new Error(`Token exchange failed: ${a.status} ${c}`)}const d=await a.json();return console.log("[DropboxAuth] Token received successfully. Expires in:",d.expires_in,"seconds"),this._storeTokens(d),window.history.replaceState({},document.title,s),!0}catch(o){return console.error("[DropboxAuth] OAuth token exchange error:",o),!1}},_storeTokens(t){sessionStorage.setItem(yt.ACCESS_TOKEN,t.access_token),t.refresh_token&&sessionStorage.setItem(yt.REFRESH_TOKEN,t.refresh_token);const n=Date.now()+(t.expires_in||14400)*1e3;sessionStorage.setItem(yt.EXPIRES_AT,String(n))},async _refreshAccessToken(t){console.log("[DropboxAuth] Refreshing access token...");const n=new URLSearchParams({grant_type:"refresh_token",refresh_token:t,client_id:At}),e=await fetch(Ut,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()});if(!e.ok){const i=await e.text();throw console.error("[DropboxAuth] Refresh failed:",e.status,i),new Error(`Refresh failed: ${e.status}`)}const r=await e.json();return console.log("[DropboxAuth] Token refreshed successfully."),this._storeTokens(r),r.access_token},getAppKey(){return At}},Qt="https://api.dropboxapi.com/2",te="https://content.dropboxapi.com/2",Ht=3,jt="/aetherfs-tags.json";class Ot{constructor(){this.nodes=[],this.edges=[],this.rootName="",this.totalFiles=0,this.totalFolders=0,this._pathMap=new Map}async _apiCall(n,e={},{isContent:r=!1,isUpload:i=!1,rawBody:s=null}={}){const o=await Tt.getAccessToken();if(!o)throw new Error("–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ Dropbox");const a=r?te:Qt;let d;for(let c=0;c<Ht;c++)try{const p={Authorization:`Bearer ${o}`};let _;i?(p["Dropbox-API-Arg"]=this._asciiSafeJson(e),p["Content-Type"]="application/octet-stream",_=s||new Uint8Array(0)):r?(p["Dropbox-API-Arg"]=this._asciiSafeJson(e),_=null):(p["Content-Type"]="application/json",_=JSON.stringify(e)),console.log(`[Dropbox API] POST ${n}`,e);const m=await fetch(`${a}${n}`,{method:"POST",headers:p,body:_});if(m.status===429){const h=parseInt(m.headers.get("Retry-After")||"5",10);console.warn(`Dropbox rate limited, retry after ${h}s`),await this._sleep(h*1e3);continue}if(m.status>=500){await this._sleep(Math.pow(2,c)*1e3);continue}if(!m.ok){const h=await m.text();throw console.error(`[Dropbox API] ${n} ‚Üí ${m.status}:`,h),new Error(`Dropbox API Error ${m.status}: ${h}`)}return r&&!i?{response:m,meta:JSON.parse(m.headers.get("dropbox-api-result")||"{}")}:await m.json()}catch(p){d=p;const _=!p.message?.includes("Dropbox API Error");if(c<Ht-1&&_&&p.name!=="AbortError")await this._sleep(Math.pow(2,c)*1e3);else throw p}throw d}_sleep(n){return new Promise(e=>setTimeout(e,n))}_asciiSafeJson(n){return JSON.stringify(n).replace(/[\u0080-\uffff]/g,e=>"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4))}async openDirectory(n){this.nodes=[],this.edges=[],this._pathMap=new Map,this.totalFiles=0,this.totalFolders=0;const e=k.hashStr("dropbox_root"),r={id:e,name:"Dropbox",path:"",type:"folder",sizeBytes:0,subtreeSizeBytes:0,modifiedAt:new Date,parentId:null,handle:null,_radius:rt.radius(0,!0),_dbxPath:""};return this.nodes.push(r),this._pathMap.set("",r),this.totalFolders++,await this._loadFolder("",e,n),this._computeSubtreeSizes(),this.rootName="Dropbox ‚òÅ",{nodes:this.nodes,edges:this.edges}}async _loadFolder(n,e,r,i=0){const s=i===0,o=[];let a=null,d=!0;for(;d;){let c;a?c=await this._apiCall("/files/list_folder/continue",{cursor:a}):c=await this._apiCall("/files/list_folder",{path:n===""?"":n,recursive:s,include_media_info:!1,include_deleted:!1,limit:2e3}),o.push(...c.entries),a=c.cursor,d=c.has_more,r&&r(o.length,`${o.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤...`)}if(s){o.sort((c,p)=>{const _=c[".tag"]==="folder"?0:1,m=p[".tag"]==="folder"?0:1;return _!==m?_-m:c.path_display.split("/").length-p.path_display.split("/").length});for(const c of o){const p=c.path_display,_=c.name,m=k.hashStr(p),h=c[".tag"]==="folder",y=p.substring(0,p.lastIndexOf("/")),f=this._pathMap.get(y)||this._pathMap.get(""),v=f?f.id:e;if(r&&r(this.totalFiles+this.totalFolders,_),h){if(this._pathMap.has(p))continue;const g={id:m,name:_,path:p,type:"folder",sizeBytes:0,subtreeSizeBytes:0,modifiedAt:new Date,parentId:v,handle:null,_radius:16,_dbxPath:p};this.nodes.push(g),this.edges.push({id:`${v}-${m}`,source:v,target:m}),this._pathMap.set(p,g),this.totalFolders++}else{const g=c.size||0,x=c.client_modified?new Date(c.client_modified):new Date,C={id:m,name:_,path:p,type:rt.infer(_,!1),sizeBytes:g,subtreeSizeBytes:g,modifiedAt:x,parentId:v,handle:null,_radius:rt.radius(g,!1),_dbxPath:p};this.nodes.push(C),this.edges.push({id:`${v}-${m}`,source:v,target:m}),this._pathMap.set(p,C),this.totalFiles++}}}else for(const c of o){const p=c.path_display,_=c.name,m=k.hashStr(p),h=c[".tag"]==="folder";if(r&&r(this.totalFiles+this.totalFolders,_),h){const y={id:m,name:_,path:p,type:"folder",sizeBytes:0,subtreeSizeBytes:0,modifiedAt:new Date,parentId:e,handle:null,_radius:16,_dbxPath:p};this.nodes.push(y),this.edges.push({id:`${e}-${m}`,source:e,target:m}),this._pathMap.set(p,y),this.totalFolders++,await this._loadFolder(p,m,r,i+1)}else{const y=c.size||0,f=c.client_modified?new Date(c.client_modified):new Date,v={id:m,name:_,path:p,type:rt.infer(_,!1),sizeBytes:y,subtreeSizeBytes:y,modifiedAt:f,parentId:e,handle:null,_radius:rt.radius(y,!1),_dbxPath:p};this.nodes.push(v),this.edges.push({id:`${e}-${m}`,source:e,target:m}),this._pathMap.set(p,v),this.totalFiles++}}}async readFileText(n,e=8e3){const r=typeof n=="string"?this._pathMap.get(n):n;if(!r||!r._dbxPath)return null;try{const{response:i}=await this._apiCall("/files/download",{path:r._dbxPath},{isContent:!0});return(await i.text()).slice(0,e)}catch{return null}}async readFileURL(n){const e=typeof n=="string"?this._pathMap.get(n):n;if(!e||!e._dbxPath)return null;try{return(await this._apiCall("/files/get_temporary_link",{path:e._dbxPath})).link}catch{return null}}async getFileBlob(n){if(!n||!n._dbxPath||n.type==="folder")return null;try{const{response:e}=await this._apiCall("/files/download",{path:n._dbxPath},{isContent:!0});return await e.blob()}catch(e){return console.warn("[Dropbox] getFileBlob error:",e.message),null}}async readTagsConfig(){try{const{response:n}=await this._apiCall("/files/download",{path:jt},{isContent:!0}),e=await n.text(),r=JSON.parse(e);return r&&typeof r.pathToTag=="object"?r:{pathToTag:{}}}catch(n){return n.message&&(n.message.includes("not_found")||n.message.includes("404")||n.message.includes("409"))||console.warn("[Dropbox] readTagsConfig error:",n.message),null}}async writeTagsConfig(n){const e=new TextEncoder().encode(JSON.stringify(n,null,2));await this._apiCall("/files/upload",{path:jt,mode:"overwrite",autorename:!1,mute:!0},{isContent:!0,isUpload:!0,rawBody:e})}async createFolder(n,e){let r;if(e===void 0)r=n;else{const i=this.nodes.find(s=>s.id===n);if(!i)return null;r=(i._dbxPath||"")+"/"+e}try{return(await this._apiCall("/files/create_folder_v2",{path:r,autorename:!1})).metadata}catch(i){return console.error("Dropbox createFolder error:",i),null}}async createFile(n,e){let r;if(e===void 0)r=n;else{const i=this.nodes.find(s=>s.id===n);if(!i)return null;r=(i._dbxPath||"")+"/"+e}try{return await this._apiCall("/files/upload",{path:r,mode:"add",autorename:!1,mute:!1},{isContent:!0,isUpload:!0,rawBody:new Uint8Array(0)})}catch(i){return console.error("Dropbox createFile error:",i),null}}async moveNode(n,e){if(!n._dbxPath)throw new Error("Source node has no Dropbox path");if(!e)throw new Error("Target folder is invalid");const r=(e._dbxPath||"")+"/"+n.name;try{const i=await this._apiCall("/files/move_v2",{from_path:n._dbxPath,to_path:r,autorename:!1,allow_ownership_transfer:!1});return n._dbxPath=i.metadata.path_display,n.path=i.metadata.path_display,!0}catch(i){throw console.error("Dropbox move error:",i),i}}async renameNode(n,e){if(!n._dbxPath)throw new Error("Node has no Dropbox path");const r=n._dbxPath.split("/");r[r.length-1]=e;const i=r.join("/");try{const s=await this._apiCall("/files/move_v2",{from_path:n._dbxPath,to_path:i,autorename:!1});return n._dbxPath=s.metadata.path_display,n.path=s.metadata.path_display,n.name=e,!0}catch(s){throw console.error("Dropbox rename error:",s),s}}async deleteNode(n){if(!n._dbxPath)throw new Error("Node has no Dropbox path");try{return await this._apiCall("/files/delete_v2",{path:n._dbxPath}),!0}catch(e){throw console.error("Dropbox delete error:",e),e}}async copyNode(n,e){if(!n._dbxPath)throw new Error("Source has no Dropbox path");const r=(e._dbxPath||"")+"/"+n.name;try{return(await this._apiCall("/files/copy_v2",{from_path:n._dbxPath,to_path:r,autorename:!0})).metadata}catch(i){throw console.error("Dropbox copy error:",i),i}}_computeSubtreeSizes(){const n=new Map(this.nodes.map(i=>[i.id,i])),e=(i,s=new Set)=>{if(s.has(i))return 0;s.add(i);const o=n.get(i);if(!o)return 0;if(o.type!=="folder")return o.sizeBytes;const a=this.edges.filter(c=>c.source===i).map(c=>c.target);let d=0;for(const c of a)d+=e(c,s);return o.subtreeSizeBytes=d,o._radius=rt.radius(d,!0),d},r=this.nodes.find(i=>!i.parentId);r&&e(r.id)}generateDemo(){throw new Error("Dropbox provider does not support demo mode")}async uploadFile(n,e){const r=await e.arrayBuffer();return this._apiCall("/files/upload",{path:n,mode:"add",autorename:!0,mute:!1},{isContent:!0,isUpload:!0,rawBody:r})}async getRevisions(n,e=10){try{return await this._apiCall("/files/list_revisions",{path:n,mode:{".tag":"path"},limit:e})}catch(r){return console.warn("Dropbox getRevisions error:",r),{entries:[]}}}}var Mt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ee(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Pt(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Bt={exports:{}};var Wt;function ie(){return Wt||(Wt=1,(function(t,n){(function(e){t.exports=e()})(function(){return(function e(r,i,s){function o(c,p){if(!i[c]){if(!r[c]){var _=typeof Pt=="function"&&Pt;if(!p&&_)return _(c,!0);if(a)return a(c,!0);var m=new Error("Cannot find module '"+c+"'");throw m.code="MODULE_NOT_FOUND",m}var h=i[c]={exports:{}};r[c][0].call(h.exports,function(y){var f=r[c][1][y];return o(f||y)},h,h.exports,e,r,i,s)}return i[c].exports}for(var a=typeof Pt=="function"&&Pt,d=0;d<s.length;d++)o(s[d]);return o})({1:[function(e,r,i){var s=e("./utils"),o=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(d){for(var c,p,_,m,h,y,f,v=[],g=0,x=d.length,C=x,T=s.getTypeOf(d)!=="string";g<d.length;)C=x-g,_=T?(c=d[g++],p=g<x?d[g++]:0,g<x?d[g++]:0):(c=d.charCodeAt(g++),p=g<x?d.charCodeAt(g++):0,g<x?d.charCodeAt(g++):0),m=c>>2,h=(3&c)<<4|p>>4,y=1<C?(15&p)<<2|_>>6:64,f=2<C?63&_:64,v.push(a.charAt(m)+a.charAt(h)+a.charAt(y)+a.charAt(f));return v.join("")},i.decode=function(d){var c,p,_,m,h,y,f=0,v=0,g="data:";if(d.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var x,C=3*(d=d.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(d.charAt(d.length-1)===a.charAt(64)&&C--,d.charAt(d.length-2)===a.charAt(64)&&C--,C%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=o.uint8array?new Uint8Array(0|C):new Array(0|C);f<d.length;)c=a.indexOf(d.charAt(f++))<<2|(m=a.indexOf(d.charAt(f++)))>>4,p=(15&m)<<4|(h=a.indexOf(d.charAt(f++)))>>2,_=(3&h)<<6|(y=a.indexOf(d.charAt(f++))),x[v++]=c,h!==64&&(x[v++]=p),y!==64&&(x[v++]=_);return x}},{"./support":30,"./utils":32}],2:[function(e,r,i){var s=e("./external"),o=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),d=e("./stream/DataLengthProbe");function c(p,_,m,h,y){this.compressedSize=p,this.uncompressedSize=_,this.crc32=m,this.compression=h,this.compressedContent=y}c.prototype={getContentWorker:function(){var p=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new d("data_length")),_=this;return p.on("end",function(){if(this.streamInfo.data_length!==_.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(p,_,m){return p.pipe(new a).pipe(new d("uncompressedSize")).pipe(_.compressWorker(m)).pipe(new d("compressedSize")).withStreamInfo("compression",_)},r.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,r,i){var s=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,r,i){var s=e("./utils"),o=(function(){for(var a,d=[],c=0;c<256;c++){a=c;for(var p=0;p<8;p++)a=1&a?3988292384^a>>>1:a>>>1;d[c]=a}return d})();r.exports=function(a,d){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?(function(c,p,_,m){var h=o,y=m+_;c^=-1;for(var f=m;f<y;f++)c=c>>>8^h[255&(c^p[f])];return-1^c})(0|d,a,a.length,0):(function(c,p,_,m){var h=o,y=m+_;c^=-1;for(var f=m;f<y;f++)c=c>>>8^h[255&(c^p.charCodeAt(f))];return-1^c})(0|d,a,a.length,0):0}},{"./utils":32}],5:[function(e,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,r,i){var s=null;s=typeof Promise<"u"?Promise:e("lie"),r.exports={Promise:s}},{lie:37}],7:[function(e,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=e("pako"),a=e("./utils"),d=e("./stream/GenericWorker"),c=s?"uint8array":"array";function p(_,m){d.call(this,"FlateWorker/"+_),this._pako=null,this._pakoAction=_,this._pakoOptions=m,this.meta={}}i.magic="\b\0",a.inherits(p,d),p.prototype.processChunk=function(_){this.meta=_.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,_.data),!1)},p.prototype.flush=function(){d.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var _=this;this._pako.onData=function(m){_.push({data:m,meta:_.meta})}},i.compressWorker=function(_){return new p("Deflate",_)},i.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,r,i){function s(h,y){var f,v="";for(f=0;f<y;f++)v+=String.fromCharCode(255&h),h>>>=8;return v}function o(h,y,f,v,g,x){var C,T,I=h.file,O=h.compression,R=x!==c.utf8encode,H=a.transformTo("string",x(I.name)),P=a.transformTo("string",c.utf8encode(I.name)),G=I.comment,Q=a.transformTo("string",x(G)),S=a.transformTo("string",c.utf8encode(G)),L=P.length!==I.name.length,u=S.length!==G.length,F="",it="",$="",nt=I.dir,j=I.date,tt={crc32:0,compressedSize:0,uncompressedSize:0};y&&!f||(tt.crc32=h.crc32,tt.compressedSize=h.compressedSize,tt.uncompressedSize=h.uncompressedSize);var A=0;y&&(A|=8),R||!L&&!u||(A|=2048);var z=0,J=0;nt&&(z|=16),g==="UNIX"?(J=798,z|=(function(V,ht){var pt=V;return V||(pt=ht?16893:33204),(65535&pt)<<16})(I.unixPermissions,nt)):(J=20,z|=(function(V){return 63&(V||0)})(I.dosPermissions)),C=j.getUTCHours(),C<<=6,C|=j.getUTCMinutes(),C<<=5,C|=j.getUTCSeconds()/2,T=j.getUTCFullYear()-1980,T<<=4,T|=j.getUTCMonth()+1,T<<=5,T|=j.getUTCDate(),L&&(it=s(1,1)+s(p(H),4)+P,F+="up"+s(it.length,2)+it),u&&($=s(1,1)+s(p(Q),4)+S,F+="uc"+s($.length,2)+$);var Y="";return Y+=`
\0`,Y+=s(A,2),Y+=O.magic,Y+=s(C,2),Y+=s(T,2),Y+=s(tt.crc32,4),Y+=s(tt.compressedSize,4),Y+=s(tt.uncompressedSize,4),Y+=s(H.length,2),Y+=s(F.length,2),{fileRecord:_.LOCAL_FILE_HEADER+Y+H+F,dirRecord:_.CENTRAL_FILE_HEADER+s(J,2)+Y+s(Q.length,2)+"\0\0\0\0"+s(z,4)+s(v,4)+H+F+Q}}var a=e("../utils"),d=e("../stream/GenericWorker"),c=e("../utf8"),p=e("../crc32"),_=e("../signature");function m(h,y,f,v){d.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=f,this.encodeFileName=v,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(m,d),m.prototype.push=function(h){var y=h.meta.percent||0,f=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,d.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:f?(y+100*(f-v-1))/f:100}}))},m.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var y=this.streamFiles&&!h.file.dir;if(y){var f=o(h,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:f.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(h){this.accumulate=!1;var y=this.streamFiles&&!h.file.dir,f=o(h,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(f.dirRecord),y)this.push({data:(function(v){return _.DATA_DESCRIPTOR+s(v.crc32,4)+s(v.compressedSize,4)+s(v.uncompressedSize,4)})(h),meta:{percent:100}});else for(this.push({data:f.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var h=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var f=this.bytesWritten-h,v=(function(g,x,C,T,I){var O=a.transformTo("string",I(T));return _.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(g,2)+s(g,2)+s(x,4)+s(C,4)+s(O.length,2)+O})(this.dirRecords.length,f,h,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(h){this._sources.push(h);var y=this;return h.on("data",function(f){y.processChunk(f)}),h.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),h.on("error",function(f){y.error(f)}),this},m.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(h){var y=this._sources;if(!d.prototype.error.call(this,h))return!1;for(var f=0;f<y.length;f++)try{y[f].error(h)}catch{}return!0},m.prototype.lock=function(){d.prototype.lock.call(this);for(var h=this._sources,y=0;y<h.length;y++)h[y].lock()},r.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,r,i){var s=e("../compressions"),o=e("./ZipFileWorker");i.generateWorker=function(a,d,c){var p=new o(d.streamFiles,c,d.platform,d.encodeFileName),_=0;try{a.forEach(function(m,h){_++;var y=(function(x,C){var T=x||C,I=s[T];if(!I)throw new Error(T+" is not a valid compression method !");return I})(h.options.compression,d.compression),f=h.options.compressionOptions||d.compressionOptions||{},v=h.dir,g=h.date;h._compressWorker(y,f).withStreamInfo("file",{name:m,dir:v,date:g,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(p)}),p.entriesCount=_}catch(m){p.error(m)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=e("./object")).loadAsync=e("./load"),s.support=e("./support"),s.defaults=e("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=e("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,r,i){var s=e("./utils"),o=e("./external"),a=e("./utf8"),d=e("./zipEntries"),c=e("./stream/Crc32Probe"),p=e("./nodejsUtils");function _(m){return new o.Promise(function(h,y){var f=m.decompressed.getContentWorker().pipe(new c);f.on("error",function(v){y(v)}).on("end",function(){f.streamInfo.crc32!==m.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(m,h){var y=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),p.isNode&&p.isStream(m)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",m,!0,h.optimizedBinaryString,h.base64).then(function(f){var v=new d(h);return v.load(f),v}).then(function(f){var v=[o.Promise.resolve(f)],g=f.files;if(h.checkCRC32)for(var x=0;x<g.length;x++)v.push(_(g[x]));return o.Promise.all(v)}).then(function(f){for(var v=f.shift(),g=v.files,x=0;x<g.length;x++){var C=g[x],T=C.fileNameStr,I=s.resolve(C.fileNameStr);y.file(I,C.decompressed,{binary:!0,optimizedBinaryString:!0,date:C.date,dir:C.dir,comment:C.fileCommentStr.length?C.fileCommentStr:null,unixPermissions:C.unixPermissions,dosPermissions:C.dosPermissions,createFolders:h.createFolders}),C.dir||(y.file(I).unsafeOriginalName=T)}return v.zipComment.length&&(y.comment=v.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,r,i){var s=e("../utils"),o=e("../stream/GenericWorker");function a(d,c){o.call(this,"Nodejs stream input adapter for "+d),this._upstreamEnded=!1,this._bindStream(c)}s.inherits(a,o),a.prototype._bindStream=function(d){var c=this;(this._stream=d).pause(),d.on("data",function(p){c.push({data:p,meta:{percent:0}})}).on("error",function(p){c.isPaused?this.generatedError=p:c.error(p)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,r,i){var s=e("readable-stream").Readable;function o(a,d,c){s.call(this,d),this._helper=a;var p=this;a.on("data",function(_,m){p.push(_)||p._helper.pause(),c&&c(m)}).on("error",function(_){p.emit("error",_)}).on("end",function(){p.push(null)})}e("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(e,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,o)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var o=new Buffer(s);return o.fill(0),o},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(e,r,i){function s(I,O,R){var H,P=a.getTypeOf(O),G=a.extend(R||{},p);G.date=G.date||new Date,G.compression!==null&&(G.compression=G.compression.toUpperCase()),typeof G.unixPermissions=="string"&&(G.unixPermissions=parseInt(G.unixPermissions,8)),G.unixPermissions&&16384&G.unixPermissions&&(G.dir=!0),G.dosPermissions&&16&G.dosPermissions&&(G.dir=!0),G.dir&&(I=g(I)),G.createFolders&&(H=v(I))&&x.call(this,H,!0);var Q=P==="string"&&G.binary===!1&&G.base64===!1;R&&R.binary!==void 0||(G.binary=!Q),(O instanceof _&&O.uncompressedSize===0||G.dir||!O||O.length===0)&&(G.base64=!1,G.binary=!0,O="",G.compression="STORE",P="string");var S=null;S=O instanceof _||O instanceof d?O:y.isNode&&y.isStream(O)?new f(I,O):a.prepareContent(I,O,G.binary,G.optimizedBinaryString,G.base64);var L=new m(I,S,G);this.files[I]=L}var o=e("./utf8"),a=e("./utils"),d=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),p=e("./defaults"),_=e("./compressedObject"),m=e("./zipObject"),h=e("./generate"),y=e("./nodejsUtils"),f=e("./nodejs/NodejsStreamInputAdapter"),v=function(I){I.slice(-1)==="/"&&(I=I.substring(0,I.length-1));var O=I.lastIndexOf("/");return 0<O?I.substring(0,O):""},g=function(I){return I.slice(-1)!=="/"&&(I+="/"),I},x=function(I,O){return O=O!==void 0?O:p.createFolders,I=g(I),this.files[I]||s.call(this,I,null,{dir:!0,createFolders:O}),this.files[I]};function C(I){return Object.prototype.toString.call(I)==="[object RegExp]"}var T={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(I){var O,R,H;for(O in this.files)H=this.files[O],(R=O.slice(this.root.length,O.length))&&O.slice(0,this.root.length)===this.root&&I(R,H)},filter:function(I){var O=[];return this.forEach(function(R,H){I(R,H)&&O.push(H)}),O},file:function(I,O,R){if(arguments.length!==1)return I=this.root+I,s.call(this,I,O,R),this;if(C(I)){var H=I;return this.filter(function(G,Q){return!Q.dir&&H.test(G)})}var P=this.files[this.root+I];return P&&!P.dir?P:null},folder:function(I){if(!I)return this;if(C(I))return this.filter(function(P,G){return G.dir&&I.test(P)});var O=this.root+I,R=x.call(this,O),H=this.clone();return H.root=R.name,H},remove:function(I){I=this.root+I;var O=this.files[I];if(O||(I.slice(-1)!=="/"&&(I+="/"),O=this.files[I]),O&&!O.dir)delete this.files[I];else for(var R=this.filter(function(P,G){return G.name.slice(0,I.length)===I}),H=0;H<R.length;H++)delete this.files[R[H].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(I){var O,R={};try{if((R=a.extend(I||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");a.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var H=R.comment||this.comment||"";O=h.generateWorker(this,R,H)}catch(P){(O=new d("error")).error(P)}return new c(O,R.type||"string",R.mimeType)},generateAsync:function(I,O){return this.generateInternalStream(I).accumulate(O)},generateNodeStream:function(I,O){return(I=I||{}).type||(I.type="nodebuffer"),this.generateInternalStream(I).toNodejsStream(O)}};r.exports=T},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,r,i){r.exports=e("stream")},{stream:void 0}],17:[function(e,r,i){var s=e("./DataReader");function o(a){s.call(this,a);for(var d=0;d<this.data.length;d++)a[d]=255&a[d]}e("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var d=a.charCodeAt(0),c=a.charCodeAt(1),p=a.charCodeAt(2),_=a.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===d&&this.data[m+1]===c&&this.data[m+2]===p&&this.data[m+3]===_)return m-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var d=a.charCodeAt(0),c=a.charCodeAt(1),p=a.charCodeAt(2),_=a.charCodeAt(3),m=this.readData(4);return d===m[0]&&c===m[1]&&p===m[2]&&_===m[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var d=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,d},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(e,r,i){var s=e("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var d,c=0;for(this.checkOffset(a),d=this.index+a-1;d>=this.index;d--)c=(c<<8)+this.byteAt(d);return this.index+=a,c},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(e,r,i){var s=e("./Uint8ArrayReader");function o(a){s.call(this,a)}e("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var d=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,d},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,r,i){var s=e("./DataReader");function o(a){s.call(this,a)}e("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var d=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,d},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(e,r,i){var s=e("./ArrayReader");function o(a){s.call(this,a)}e("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var d=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,d},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(e,r,i){var s=e("../utils"),o=e("../support"),a=e("./ArrayReader"),d=e("./StringReader"),c=e("./NodeBufferReader"),p=e("./Uint8ArrayReader");r.exports=function(_){var m=s.getTypeOf(_);return s.checkSupport(m),m!=="string"||o.uint8array?m==="nodebuffer"?new c(_):o.uint8array?new p(s.transformTo("uint8array",_)):new a(s.transformTo("array",_)):new d(_)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,r,i){var s=e("./GenericWorker"),o=e("../utils");function a(d){s.call(this,"ConvertWorker to "+d),this.destType=d}o.inherits(a,s),a.prototype.processChunk=function(d){this.push({data:o.transformTo(this.destType,d.data),meta:d.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,r,i){var s=e("./GenericWorker"),o=e("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,s),a.prototype.processChunk=function(d){this.streamInfo.crc32=o(d.data,this.streamInfo.crc32||0),this.push(d)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,r,i){var s=e("../utils"),o=e("./GenericWorker");function a(d){o.call(this,"DataLengthProbe for "+d),this.propName=d,this.withStreamInfo(d,0)}s.inherits(a,o),a.prototype.processChunk=function(d){if(d){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+d.data.length}o.prototype.processChunk.call(this,d)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,r,i){var s=e("../utils"),o=e("./GenericWorker");function a(d){o.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,d.then(function(p){c.dataIsReady=!0,c.data=p,c.max=p&&p.length||0,c.type=s.getTypeOf(p),c.isPaused||c._tickAndRepeat()},function(p){c.error(p)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var d=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":d=this.data.substring(this.index,c);break;case"uint8array":d=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":d=this.data.slice(this.index,c)}return this.index=c,this.push({data:d,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var d=0;d<this._listeners[o].length;d++)this._listeners[o][d].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(d){a.processChunk(d)}),o.on("end",function(){a.end()}),o.on("error",function(d){a.error(d)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(e,r,i){var s=e("../utils"),o=e("./ConvertWorker"),a=e("./GenericWorker"),d=e("../base64"),c=e("../support"),p=e("../external"),_=null;if(c.nodestream)try{_=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(y,f){return new p.Promise(function(v,g){var x=[],C=y._internalType,T=y._outputType,I=y._mimeType;y.on("data",function(O,R){x.push(O),f&&f(R)}).on("error",function(O){x=[],g(O)}).on("end",function(){try{var O=(function(R,H,P){switch(R){case"blob":return s.newBlob(s.transformTo("arraybuffer",H),P);case"base64":return d.encode(H);default:return s.transformTo(R,H)}})(T,(function(R,H){var P,G=0,Q=null,S=0;for(P=0;P<H.length;P++)S+=H[P].length;switch(R){case"string":return H.join("");case"array":return Array.prototype.concat.apply([],H);case"uint8array":for(Q=new Uint8Array(S),P=0;P<H.length;P++)Q.set(H[P],G),G+=H[P].length;return Q;case"nodebuffer":return Buffer.concat(H);default:throw new Error("concat : unsupported type '"+R+"'")}})(C,x),I);v(O)}catch(R){g(R)}x=[]}).resume()})}function h(y,f,v){var g=f;switch(f){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=f,this._mimeType=v,s.checkSupport(g),this._worker=y.pipe(new o(g)),y.lock()}catch(x){this._worker=new a("error"),this._worker.error(x)}}h.prototype={accumulate:function(y){return m(this,y)},on:function(y,f){var v=this;return y==="data"?this._worker.on(y,function(g){f.call(v,g.data,g.meta)}):this._worker.on(y,function(){s.delay(f,arguments,v)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(y){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new _(this,{objectMode:this._outputType!=="nodebuffer"},y)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(e,r,i){for(var s=e("./utils"),o=e("./support"),a=e("./nodejsUtils"),d=e("./stream/GenericWorker"),c=new Array(256),p=0;p<256;p++)c[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;c[254]=c[254]=1;function _(){d.call(this,"utf-8 decode"),this.leftOver=null}function m(){d.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):(function(y){var f,v,g,x,C,T=y.length,I=0;for(x=0;x<T;x++)(64512&(v=y.charCodeAt(x)))==55296&&x+1<T&&(64512&(g=y.charCodeAt(x+1)))==56320&&(v=65536+(v-55296<<10)+(g-56320),x++),I+=v<128?1:v<2048?2:v<65536?3:4;for(f=o.uint8array?new Uint8Array(I):new Array(I),x=C=0;C<I;x++)(64512&(v=y.charCodeAt(x)))==55296&&x+1<T&&(64512&(g=y.charCodeAt(x+1)))==56320&&(v=65536+(v-55296<<10)+(g-56320),x++),v<128?f[C++]=v:(v<2048?f[C++]=192|v>>>6:(v<65536?f[C++]=224|v>>>12:(f[C++]=240|v>>>18,f[C++]=128|v>>>12&63),f[C++]=128|v>>>6&63),f[C++]=128|63&v);return f})(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):(function(y){var f,v,g,x,C=y.length,T=new Array(2*C);for(f=v=0;f<C;)if((g=y[f++])<128)T[v++]=g;else if(4<(x=c[g]))T[v++]=65533,f+=x-1;else{for(g&=x===2?31:x===3?15:7;1<x&&f<C;)g=g<<6|63&y[f++],x--;1<x?T[v++]=65533:g<65536?T[v++]=g:(g-=65536,T[v++]=55296|g>>10&1023,T[v++]=56320|1023&g)}return T.length!==v&&(T.subarray?T=T.subarray(0,v):T.length=v),s.applyFromCharCode(T)})(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(_,d),_.prototype.processChunk=function(h){var y=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var f=y;(y=new Uint8Array(f.length+this.leftOver.length)).set(this.leftOver,0),y.set(f,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var v=(function(x,C){var T;for((C=C||x.length)>x.length&&(C=x.length),T=C-1;0<=T&&(192&x[T])==128;)T--;return T<0||T===0?C:T+c[x[T]]>C?T:C})(y),g=y;v!==y.length&&(o.uint8array?(g=y.subarray(0,v),this.leftOver=y.subarray(v,y.length)):(g=y.slice(0,v),this.leftOver=y.slice(v,y.length))),this.push({data:i.utf8decode(g),meta:h.meta})},_.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=_,s.inherits(m,d),m.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,r,i){var s=e("./support"),o=e("./base64"),a=e("./nodejsUtils"),d=e("./external");function c(f){return f}function p(f,v){for(var g=0;g<f.length;++g)v[g]=255&f.charCodeAt(g);return v}e("setimmediate"),i.newBlob=function(f,v){i.checkSupport("blob");try{return new Blob([f],{type:v})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(f),g.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var _={stringifyByChunk:function(f,v,g){var x=[],C=0,T=f.length;if(T<=g)return String.fromCharCode.apply(null,f);for(;C<T;)v==="array"||v==="nodebuffer"?x.push(String.fromCharCode.apply(null,f.slice(C,Math.min(C+g,T)))):x.push(String.fromCharCode.apply(null,f.subarray(C,Math.min(C+g,T)))),C+=g;return x.join("")},stringifyByChar:function(f){for(var v="",g=0;g<f.length;g++)v+=String.fromCharCode(f[g]);return v},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function m(f){var v=65536,g=i.getTypeOf(f),x=!0;if(g==="uint8array"?x=_.applyCanBeUsed.uint8array:g==="nodebuffer"&&(x=_.applyCanBeUsed.nodebuffer),x)for(;1<v;)try{return _.stringifyByChunk(f,g,v)}catch{v=Math.floor(v/2)}return _.stringifyByChar(f)}function h(f,v){for(var g=0;g<f.length;g++)v[g]=f[g];return v}i.applyFromCharCode=m;var y={};y.string={string:c,array:function(f){return p(f,new Array(f.length))},arraybuffer:function(f){return y.string.uint8array(f).buffer},uint8array:function(f){return p(f,new Uint8Array(f.length))},nodebuffer:function(f){return p(f,a.allocBuffer(f.length))}},y.array={string:m,array:c,arraybuffer:function(f){return new Uint8Array(f).buffer},uint8array:function(f){return new Uint8Array(f)},nodebuffer:function(f){return a.newBufferFrom(f)}},y.arraybuffer={string:function(f){return m(new Uint8Array(f))},array:function(f){return h(new Uint8Array(f),new Array(f.byteLength))},arraybuffer:c,uint8array:function(f){return new Uint8Array(f)},nodebuffer:function(f){return a.newBufferFrom(new Uint8Array(f))}},y.uint8array={string:m,array:function(f){return h(f,new Array(f.length))},arraybuffer:function(f){return f.buffer},uint8array:c,nodebuffer:function(f){return a.newBufferFrom(f)}},y.nodebuffer={string:m,array:function(f){return h(f,new Array(f.length))},arraybuffer:function(f){return y.nodebuffer.uint8array(f).buffer},uint8array:function(f){return h(f,new Uint8Array(f.length))},nodebuffer:c},i.transformTo=function(f,v){if(v=v||"",!f)return v;i.checkSupport(f);var g=i.getTypeOf(v);return y[g][f](v)},i.resolve=function(f){for(var v=f.split("/"),g=[],x=0;x<v.length;x++){var C=v[x];C==="."||C===""&&x!==0&&x!==v.length-1||(C===".."?g.pop():g.push(C))}return g.join("/")},i.getTypeOf=function(f){return typeof f=="string"?"string":Object.prototype.toString.call(f)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(f)?"nodebuffer":s.uint8array&&f instanceof Uint8Array?"uint8array":s.arraybuffer&&f instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(f){if(!s[f.toLowerCase()])throw new Error(f+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(f){var v,g,x="";for(g=0;g<(f||"").length;g++)x+="\\x"+((v=f.charCodeAt(g))<16?"0":"")+v.toString(16).toUpperCase();return x},i.delay=function(f,v,g){setImmediate(function(){f.apply(g||null,v||[])})},i.inherits=function(f,v){function g(){}g.prototype=v.prototype,f.prototype=new g},i.extend=function(){var f,v,g={};for(f=0;f<arguments.length;f++)for(v in arguments[f])Object.prototype.hasOwnProperty.call(arguments[f],v)&&g[v]===void 0&&(g[v]=arguments[f][v]);return g},i.prepareContent=function(f,v,g,x,C){return d.Promise.resolve(v).then(function(T){return s.blob&&(T instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(T))!==-1)&&typeof FileReader<"u"?new d.Promise(function(I,O){var R=new FileReader;R.onload=function(H){I(H.target.result)},R.onerror=function(H){O(H.target.error)},R.readAsArrayBuffer(T)}):T}).then(function(T){var I=i.getTypeOf(T);return I?(I==="arraybuffer"?T=i.transformTo("uint8array",T):I==="string"&&(C?T=o.decode(T):g&&x!==!0&&(T=(function(O){return p(O,s.uint8array?new Uint8Array(O.length):new Array(O.length))})(T))),T):d.Promise.reject(new Error("Can't read the data of '"+f+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,r,i){var s=e("./reader/readerFor"),o=e("./utils"),a=e("./signature"),d=e("./zipEntry"),c=e("./support");function p(_){this.files=[],this.loadOptions=_}p.prototype={checkSignature:function(_){if(!this.reader.readAndCheckSignature(_)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(m)+", expected "+o.pretty(_)+")")}},isSignature:function(_,m){var h=this.reader.index;this.reader.setIndex(_);var y=this.reader.readString(4)===m;return this.reader.setIndex(h),y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var _=this.reader.readData(this.zipCommentLength),m=c.uint8array?"uint8array":"array",h=o.transformTo(m,_);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var _,m,h,y=this.zip64EndOfCentralSize-44;0<y;)_=this.reader.readInt(2),m=this.reader.readInt(4),h=this.reader.readData(m),this.zip64ExtensibleData[_]={id:_,length:m,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var _,m;for(_=0;_<this.files.length;_++)m=this.files[_],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var _;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(_=new d({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(_);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var _=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(_<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(_);var m=_;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(_=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(_),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var y=m-h;if(0<y)this.isSignature(m,a.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},prepareReader:function(_){this.reader=s(_)},load:function(_){this.prepareReader(_),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,r,i){var s=e("./reader/readerFor"),o=e("./utils"),a=e("./compressedObject"),d=e("./crc32"),c=e("./utf8"),p=e("./compressions"),_=e("./support");function m(h,y){this.options=h,this.loadOptions=y}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var y,f;if(h.skip(22),this.fileNameLength=h.readInt(2),f=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(f),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=(function(v){for(var g in p)if(Object.prototype.hasOwnProperty.call(p,g)&&p[g].magic===v)return p[g];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,y,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var y=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(y),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var y,f,v,g=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<g;)y=h.readInt(2),f=h.readInt(2),v=h.readData(f),this.extraFields[y]={id:y,length:f,value:v};h.setIndex(g)},handleUTF8:function(){var h=_.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var f=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(f)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var g=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var y=s(h.value);return y.readInt(1)!==1||d(this.fileName)!==y.readInt(4)?null:c.utf8decode(y.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var y=s(h.value);return y.readInt(1)!==1||d(this.fileComment)!==y.readInt(4)?null:c.utf8decode(y.readData(h.length-5))}return null}},r.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,r,i){function s(y,f,v){this.name=y,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=f,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var o=e("./stream/StreamHelper"),a=e("./stream/DataWorker"),d=e("./utf8"),c=e("./compressedObject"),p=e("./stream/GenericWorker");s.prototype={internalStream:function(y){var f=null,v="string";try{if(!y)throw new Error("No output type specified.");var g=(v=y.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),f=this._decompressWorker();var x=!this._dataBinary;x&&!g&&(f=f.pipe(new d.Utf8EncodeWorker)),!x&&g&&(f=f.pipe(new d.Utf8DecodeWorker))}catch(C){(f=new p("error")).error(C)}return new o(f,v,"")},async:function(y,f){return this.internalStream(y).accumulate(f)},nodeStream:function(y,f){return this.internalStream(y||"nodebuffer").toNodejsStream(f)},_compressWorker:function(y,f){if(this._data instanceof c&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new d.Utf8EncodeWorker)),c.createWorkerFrom(v,y,f)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof p?this._data:new a(this._data)}};for(var _=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<_.length;h++)s.prototype[_[h]]=m;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,r,i){(function(s){var o,a,d=s.MutationObserver||s.WebKitMutationObserver;if(d){var c=0,p=new d(y),_=s.document.createTextNode("");p.observe(_,{characterData:!0}),o=function(){_.data=c=++c%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var f=s.document.createElement("script");f.onreadystatechange=function(){y(),f.onreadystatechange=null,f.parentNode.removeChild(f),f=null},s.document.documentElement.appendChild(f)}:function(){setTimeout(y,0)};else{var m=new s.MessageChannel;m.port1.onmessage=y,o=function(){m.port2.postMessage(0)}}var h=[];function y(){var f,v;a=!0;for(var g=h.length;g;){for(v=h,h=[],f=-1;++f<g;)v[f]();g=h.length}a=!1}r.exports=function(f){h.push(f)!==1||a||o()}}).call(this,typeof Mt<"u"?Mt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,r,i){var s=e("immediate");function o(){}var a={},d=["REJECTED"],c=["FULFILLED"],p=["PENDING"];function _(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,g!==o&&f(this,g)}function m(g,x,C){this.promise=g,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof C=="function"&&(this.onRejected=C,this.callRejected=this.otherCallRejected)}function h(g,x,C){s(function(){var T;try{T=x(C)}catch(I){return a.reject(g,I)}T===g?a.reject(g,new TypeError("Cannot resolve promise with itself")):a.resolve(g,T)})}function y(g){var x=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof x=="function")return function(){x.apply(g,arguments)}}function f(g,x){var C=!1;function T(R){C||(C=!0,a.reject(g,R))}function I(R){C||(C=!0,a.resolve(g,R))}var O=v(function(){x(I,T)});O.status==="error"&&T(O.value)}function v(g,x){var C={};try{C.value=g(x),C.status="success"}catch(T){C.status="error",C.value=T}return C}(r.exports=_).prototype.finally=function(g){if(typeof g!="function")return this;var x=this.constructor;return this.then(function(C){return x.resolve(g()).then(function(){return C})},function(C){return x.resolve(g()).then(function(){throw C})})},_.prototype.catch=function(g){return this.then(null,g)},_.prototype.then=function(g,x){if(typeof g!="function"&&this.state===c||typeof x!="function"&&this.state===d)return this;var C=new this.constructor(o);return this.state!==p?h(C,this.state===c?g:x,this.outcome):this.queue.push(new m(C,g,x)),C},m.prototype.callFulfilled=function(g){a.resolve(this.promise,g)},m.prototype.otherCallFulfilled=function(g){h(this.promise,this.onFulfilled,g)},m.prototype.callRejected=function(g){a.reject(this.promise,g)},m.prototype.otherCallRejected=function(g){h(this.promise,this.onRejected,g)},a.resolve=function(g,x){var C=v(y,x);if(C.status==="error")return a.reject(g,C.value);var T=C.value;if(T)f(g,T);else{g.state=c,g.outcome=x;for(var I=-1,O=g.queue.length;++I<O;)g.queue[I].callFulfilled(x)}return g},a.reject=function(g,x){g.state=d,g.outcome=x;for(var C=-1,T=g.queue.length;++C<T;)g.queue[C].callRejected(x);return g},_.resolve=function(g){return g instanceof this?g:a.resolve(new this(o),g)},_.reject=function(g){var x=new this(o);return a.reject(x,g)},_.all=function(g){var x=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=g.length,T=!1;if(!C)return this.resolve([]);for(var I=new Array(C),O=0,R=-1,H=new this(o);++R<C;)P(g[R],R);return H;function P(G,Q){x.resolve(G).then(function(S){I[Q]=S,++O!==C||T||(T=!0,a.resolve(H,I))},function(S){T||(T=!0,a.reject(H,S))})}},_.race=function(g){var x=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=g.length,T=!1;if(!C)return this.resolve([]);for(var I=-1,O=new this(o);++I<C;)R=g[I],x.resolve(R).then(function(H){T||(T=!0,a.resolve(O,H))},function(H){T||(T=!0,a.reject(O,H))});var R;return O}},{immediate:36}],38:[function(e,r,i){var s={};(0,e("./lib/utils/common").assign)(s,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,r,i){var s=e("./zlib/deflate"),o=e("./utils/common"),a=e("./utils/strings"),d=e("./zlib/messages"),c=e("./zlib/zstream"),p=Object.prototype.toString,_=0,m=-1,h=0,y=8;function f(g){if(!(this instanceof f))return new f(g);this.options=o.assign({level:m,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},g||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var C=s.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(C!==_)throw new Error(d[C]);if(x.header&&s.deflateSetHeader(this.strm,x.header),x.dictionary){var T;if(T=typeof x.dictionary=="string"?a.string2buf(x.dictionary):p.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(C=s.deflateSetDictionary(this.strm,T))!==_)throw new Error(d[C]);this._dict_set=!0}}function v(g,x){var C=new f(x);if(C.push(g,!0),C.err)throw C.msg||d[C.err];return C.result}f.prototype.push=function(g,x){var C,T,I=this.strm,O=this.options.chunkSize;if(this.ended)return!1;T=x===~~x?x:x===!0?4:0,typeof g=="string"?I.input=a.string2buf(g):p.call(g)==="[object ArrayBuffer]"?I.input=new Uint8Array(g):I.input=g,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new o.Buf8(O),I.next_out=0,I.avail_out=O),(C=s.deflate(I,T))!==1&&C!==_)return this.onEnd(C),!(this.ended=!0);I.avail_out!==0&&(I.avail_in!==0||T!==4&&T!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(I.output,I.next_out))):this.onData(o.shrinkBuf(I.output,I.next_out)))}while((0<I.avail_in||I.avail_out===0)&&C!==1);return T===4?(C=s.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===_):T!==2||(this.onEnd(_),!(I.avail_out=0))},f.prototype.onData=function(g){this.chunks.push(g)},f.prototype.onEnd=function(g){g===_&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},i.Deflate=f,i.deflate=v,i.deflateRaw=function(g,x){return(x=x||{}).raw=!0,v(g,x)},i.gzip=function(g,x){return(x=x||{}).gzip=!0,v(g,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,r,i){var s=e("./zlib/inflate"),o=e("./utils/common"),a=e("./utils/strings"),d=e("./zlib/constants"),c=e("./zlib/messages"),p=e("./zlib/zstream"),_=e("./zlib/gzheader"),m=Object.prototype.toString;function h(f){if(!(this instanceof h))return new h(f);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},f||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||f&&f.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&(15&v.windowBits)==0&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var g=s.inflateInit2(this.strm,v.windowBits);if(g!==d.Z_OK)throw new Error(c[g]);this.header=new _,s.inflateGetHeader(this.strm,this.header)}function y(f,v){var g=new h(v);if(g.push(f,!0),g.err)throw g.msg||c[g.err];return g.result}h.prototype.push=function(f,v){var g,x,C,T,I,O,R=this.strm,H=this.options.chunkSize,P=this.options.dictionary,G=!1;if(this.ended)return!1;x=v===~~v?v:v===!0?d.Z_FINISH:d.Z_NO_FLUSH,typeof f=="string"?R.input=a.binstring2buf(f):m.call(f)==="[object ArrayBuffer]"?R.input=new Uint8Array(f):R.input=f,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new o.Buf8(H),R.next_out=0,R.avail_out=H),(g=s.inflate(R,d.Z_NO_FLUSH))===d.Z_NEED_DICT&&P&&(O=typeof P=="string"?a.string2buf(P):m.call(P)==="[object ArrayBuffer]"?new Uint8Array(P):P,g=s.inflateSetDictionary(this.strm,O)),g===d.Z_BUF_ERROR&&G===!0&&(g=d.Z_OK,G=!1),g!==d.Z_STREAM_END&&g!==d.Z_OK)return this.onEnd(g),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&g!==d.Z_STREAM_END&&(R.avail_in!==0||x!==d.Z_FINISH&&x!==d.Z_SYNC_FLUSH)||(this.options.to==="string"?(C=a.utf8border(R.output,R.next_out),T=R.next_out-C,I=a.buf2string(R.output,C),R.next_out=T,R.avail_out=H-T,T&&o.arraySet(R.output,R.output,C,T,0),this.onData(I)):this.onData(o.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(G=!0)}while((0<R.avail_in||R.avail_out===0)&&g!==d.Z_STREAM_END);return g===d.Z_STREAM_END&&(x=d.Z_FINISH),x===d.Z_FINISH?(g=s.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===d.Z_OK):x!==d.Z_SYNC_FLUSH||(this.onEnd(d.Z_OK),!(R.avail_out=0))},h.prototype.onData=function(f){this.chunks.push(f)},h.prototype.onEnd=function(f){f===d.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},i.Inflate=h,i.inflate=y,i.inflateRaw=function(f,v){return(v=v||{}).raw=!0,y(f,v)},i.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(d){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var p=c.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var _ in p)p.hasOwnProperty(_)&&(d[_]=p[_])}}return d},i.shrinkBuf=function(d,c){return d.length===c?d:d.subarray?d.subarray(0,c):(d.length=c,d)};var o={arraySet:function(d,c,p,_,m){if(c.subarray&&d.subarray)d.set(c.subarray(p,p+_),m);else for(var h=0;h<_;h++)d[m+h]=c[p+h]},flattenChunks:function(d){var c,p,_,m,h,y;for(c=_=0,p=d.length;c<p;c++)_+=d[c].length;for(y=new Uint8Array(_),c=m=0,p=d.length;c<p;c++)h=d[c],y.set(h,m),m+=h.length;return y}},a={arraySet:function(d,c,p,_,m){for(var h=0;h<_;h++)d[m+h]=c[p+h]},flattenChunks:function(d){return[].concat.apply([],d)}};i.setTyped=function(d){d?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(e,r,i){var s=e("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var d=new s.Buf8(256),c=0;c<256;c++)d[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function p(_,m){if(m<65537&&(_.subarray&&a||!_.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(_,m));for(var h="",y=0;y<m;y++)h+=String.fromCharCode(_[y]);return h}d[254]=d[254]=1,i.string2buf=function(_){var m,h,y,f,v,g=_.length,x=0;for(f=0;f<g;f++)(64512&(h=_.charCodeAt(f)))==55296&&f+1<g&&(64512&(y=_.charCodeAt(f+1)))==56320&&(h=65536+(h-55296<<10)+(y-56320),f++),x+=h<128?1:h<2048?2:h<65536?3:4;for(m=new s.Buf8(x),f=v=0;v<x;f++)(64512&(h=_.charCodeAt(f)))==55296&&f+1<g&&(64512&(y=_.charCodeAt(f+1)))==56320&&(h=65536+(h-55296<<10)+(y-56320),f++),h<128?m[v++]=h:(h<2048?m[v++]=192|h>>>6:(h<65536?m[v++]=224|h>>>12:(m[v++]=240|h>>>18,m[v++]=128|h>>>12&63),m[v++]=128|h>>>6&63),m[v++]=128|63&h);return m},i.buf2binstring=function(_){return p(_,_.length)},i.binstring2buf=function(_){for(var m=new s.Buf8(_.length),h=0,y=m.length;h<y;h++)m[h]=_.charCodeAt(h);return m},i.buf2string=function(_,m){var h,y,f,v,g=m||_.length,x=new Array(2*g);for(h=y=0;h<g;)if((f=_[h++])<128)x[y++]=f;else if(4<(v=d[f]))x[y++]=65533,h+=v-1;else{for(f&=v===2?31:v===3?15:7;1<v&&h<g;)f=f<<6|63&_[h++],v--;1<v?x[y++]=65533:f<65536?x[y++]=f:(f-=65536,x[y++]=55296|f>>10&1023,x[y++]=56320|1023&f)}return p(x,y)},i.utf8border=function(_,m){var h;for((m=m||_.length)>_.length&&(m=_.length),h=m-1;0<=h&&(192&_[h])==128;)h--;return h<0||h===0?m:h+d[_[h]]>m?h:m}},{"./common":41}],43:[function(e,r,i){r.exports=function(s,o,a,d){for(var c=65535&s|0,p=s>>>16&65535|0,_=0;a!==0;){for(a-=_=2e3<a?2e3:a;p=p+(c=c+o[d++]|0)|0,--_;);c%=65521,p%=65521}return c|p<<16|0}},{}],44:[function(e,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,r,i){var s=(function(){for(var o,a=[],d=0;d<256;d++){o=d;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[d]=o}return a})();r.exports=function(o,a,d,c){var p=s,_=c+d;o^=-1;for(var m=c;m<_;m++)o=o>>>8^p[255&(o^a[m])];return-1^o}},{}],46:[function(e,r,i){var s,o=e("../utils/common"),a=e("./trees"),d=e("./adler32"),c=e("./crc32"),p=e("./messages"),_=0,m=4,h=0,y=-2,f=-1,v=4,g=2,x=8,C=9,T=286,I=30,O=19,R=2*T+1,H=15,P=3,G=258,Q=G+P+1,S=42,L=113,u=1,F=2,it=3,$=4;function nt(l,B){return l.msg=p[B],B}function j(l){return(l<<1)-(4<l?9:0)}function tt(l){for(var B=l.length;0<=--B;)l[B]=0}function A(l){var B=l.state,M=B.pending;M>l.avail_out&&(M=l.avail_out),M!==0&&(o.arraySet(l.output,B.pending_buf,B.pending_out,M,l.next_out),l.next_out+=M,B.pending_out+=M,l.total_out+=M,l.avail_out-=M,B.pending-=M,B.pending===0&&(B.pending_out=0))}function z(l,B){a._tr_flush_block(l,0<=l.block_start?l.block_start:-1,l.strstart-l.block_start,B),l.block_start=l.strstart,A(l.strm)}function J(l,B){l.pending_buf[l.pending++]=B}function Y(l,B){l.pending_buf[l.pending++]=B>>>8&255,l.pending_buf[l.pending++]=255&B}function V(l,B){var M,b,w=l.max_chain_length,E=l.strstart,N=l.prev_length,U=l.nice_match,D=l.strstart>l.w_size-Q?l.strstart-(l.w_size-Q):0,Z=l.window,K=l.w_mask,X=l.prev,q=l.strstart+G,dt=Z[E+N-1],ot=Z[E+N];l.prev_length>=l.good_match&&(w>>=2),U>l.lookahead&&(U=l.lookahead);do if(Z[(M=B)+N]===ot&&Z[M+N-1]===dt&&Z[M]===Z[E]&&Z[++M]===Z[E+1]){E+=2,M++;do;while(Z[++E]===Z[++M]&&Z[++E]===Z[++M]&&Z[++E]===Z[++M]&&Z[++E]===Z[++M]&&Z[++E]===Z[++M]&&Z[++E]===Z[++M]&&Z[++E]===Z[++M]&&Z[++E]===Z[++M]&&E<q);if(b=G-(q-E),E=q-G,N<b){if(l.match_start=B,U<=(N=b))break;dt=Z[E+N-1],ot=Z[E+N]}}while((B=X[B&K])>D&&--w!=0);return N<=l.lookahead?N:l.lookahead}function ht(l){var B,M,b,w,E,N,U,D,Z,K,X=l.w_size;do{if(w=l.window_size-l.lookahead-l.strstart,l.strstart>=X+(X-Q)){for(o.arraySet(l.window,l.window,X,X,0),l.match_start-=X,l.strstart-=X,l.block_start-=X,B=M=l.hash_size;b=l.head[--B],l.head[B]=X<=b?b-X:0,--M;);for(B=M=X;b=l.prev[--B],l.prev[B]=X<=b?b-X:0,--M;);w+=X}if(l.strm.avail_in===0)break;if(N=l.strm,U=l.window,D=l.strstart+l.lookahead,Z=w,K=void 0,K=N.avail_in,Z<K&&(K=Z),M=K===0?0:(N.avail_in-=K,o.arraySet(U,N.input,N.next_in,K,D),N.state.wrap===1?N.adler=d(N.adler,U,K,D):N.state.wrap===2&&(N.adler=c(N.adler,U,K,D)),N.next_in+=K,N.total_in+=K,K),l.lookahead+=M,l.lookahead+l.insert>=P)for(E=l.strstart-l.insert,l.ins_h=l.window[E],l.ins_h=(l.ins_h<<l.hash_shift^l.window[E+1])&l.hash_mask;l.insert&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[E+P-1])&l.hash_mask,l.prev[E&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=E,E++,l.insert--,!(l.lookahead+l.insert<P)););}while(l.lookahead<Q&&l.strm.avail_in!==0)}function pt(l,B){for(var M,b;;){if(l.lookahead<Q){if(ht(l),l.lookahead<Q&&B===_)return u;if(l.lookahead===0)break}if(M=0,l.lookahead>=P&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+P-1])&l.hash_mask,M=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),M!==0&&l.strstart-M<=l.w_size-Q&&(l.match_length=V(l,M)),l.match_length>=P)if(b=a._tr_tally(l,l.strstart-l.match_start,l.match_length-P),l.lookahead-=l.match_length,l.match_length<=l.max_lazy_match&&l.lookahead>=P){for(l.match_length--;l.strstart++,l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+P-1])&l.hash_mask,M=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart,--l.match_length!=0;);l.strstart++}else l.strstart+=l.match_length,l.match_length=0,l.ins_h=l.window[l.strstart],l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+1])&l.hash_mask;else b=a._tr_tally(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++;if(b&&(z(l,!1),l.strm.avail_out===0))return u}return l.insert=l.strstart<P-1?l.strstart:P-1,B===m?(z(l,!0),l.strm.avail_out===0?it:$):l.last_lit&&(z(l,!1),l.strm.avail_out===0)?u:F}function at(l,B){for(var M,b,w;;){if(l.lookahead<Q){if(ht(l),l.lookahead<Q&&B===_)return u;if(l.lookahead===0)break}if(M=0,l.lookahead>=P&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+P-1])&l.hash_mask,M=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),l.prev_length=l.match_length,l.prev_match=l.match_start,l.match_length=P-1,M!==0&&l.prev_length<l.max_lazy_match&&l.strstart-M<=l.w_size-Q&&(l.match_length=V(l,M),l.match_length<=5&&(l.strategy===1||l.match_length===P&&4096<l.strstart-l.match_start)&&(l.match_length=P-1)),l.prev_length>=P&&l.match_length<=l.prev_length){for(w=l.strstart+l.lookahead-P,b=a._tr_tally(l,l.strstart-1-l.prev_match,l.prev_length-P),l.lookahead-=l.prev_length-1,l.prev_length-=2;++l.strstart<=w&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+P-1])&l.hash_mask,M=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),--l.prev_length!=0;);if(l.match_available=0,l.match_length=P-1,l.strstart++,b&&(z(l,!1),l.strm.avail_out===0))return u}else if(l.match_available){if((b=a._tr_tally(l,0,l.window[l.strstart-1]))&&z(l,!1),l.strstart++,l.lookahead--,l.strm.avail_out===0)return u}else l.match_available=1,l.strstart++,l.lookahead--}return l.match_available&&(b=a._tr_tally(l,0,l.window[l.strstart-1]),l.match_available=0),l.insert=l.strstart<P-1?l.strstart:P-1,B===m?(z(l,!0),l.strm.avail_out===0?it:$):l.last_lit&&(z(l,!1),l.strm.avail_out===0)?u:F}function lt(l,B,M,b,w){this.good_length=l,this.max_lazy=B,this.nice_length=M,this.max_chain=b,this.func=w}function ft(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*R),this.dyn_dtree=new o.Buf16(2*(2*I+1)),this.bl_tree=new o.Buf16(2*(2*O+1)),tt(this.dyn_ltree),tt(this.dyn_dtree),tt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(H+1),this.heap=new o.Buf16(2*T+1),tt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*T+1),tt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ct(l){var B;return l&&l.state?(l.total_in=l.total_out=0,l.data_type=g,(B=l.state).pending=0,B.pending_out=0,B.wrap<0&&(B.wrap=-B.wrap),B.status=B.wrap?S:L,l.adler=B.wrap===2?0:1,B.last_flush=_,a._tr_init(B),h):nt(l,y)}function wt(l){var B=ct(l);return B===h&&(function(M){M.window_size=2*M.w_size,tt(M.head),M.max_lazy_match=s[M.level].max_lazy,M.good_match=s[M.level].good_length,M.nice_match=s[M.level].nice_length,M.max_chain_length=s[M.level].max_chain,M.strstart=0,M.block_start=0,M.lookahead=0,M.insert=0,M.match_length=M.prev_length=P-1,M.match_available=0,M.ins_h=0})(l.state),B}function vt(l,B,M,b,w,E){if(!l)return y;var N=1;if(B===f&&(B=6),b<0?(N=0,b=-b):15<b&&(N=2,b-=16),w<1||C<w||M!==x||b<8||15<b||B<0||9<B||E<0||v<E)return nt(l,y);b===8&&(b=9);var U=new ft;return(l.state=U).strm=l,U.wrap=N,U.gzhead=null,U.w_bits=b,U.w_size=1<<U.w_bits,U.w_mask=U.w_size-1,U.hash_bits=w+7,U.hash_size=1<<U.hash_bits,U.hash_mask=U.hash_size-1,U.hash_shift=~~((U.hash_bits+P-1)/P),U.window=new o.Buf8(2*U.w_size),U.head=new o.Buf16(U.hash_size),U.prev=new o.Buf16(U.w_size),U.lit_bufsize=1<<w+6,U.pending_buf_size=4*U.lit_bufsize,U.pending_buf=new o.Buf8(U.pending_buf_size),U.d_buf=1*U.lit_bufsize,U.l_buf=3*U.lit_bufsize,U.level=B,U.strategy=E,U.method=M,wt(l)}s=[new lt(0,0,0,0,function(l,B){var M=65535;for(M>l.pending_buf_size-5&&(M=l.pending_buf_size-5);;){if(l.lookahead<=1){if(ht(l),l.lookahead===0&&B===_)return u;if(l.lookahead===0)break}l.strstart+=l.lookahead,l.lookahead=0;var b=l.block_start+M;if((l.strstart===0||l.strstart>=b)&&(l.lookahead=l.strstart-b,l.strstart=b,z(l,!1),l.strm.avail_out===0)||l.strstart-l.block_start>=l.w_size-Q&&(z(l,!1),l.strm.avail_out===0))return u}return l.insert=0,B===m?(z(l,!0),l.strm.avail_out===0?it:$):(l.strstart>l.block_start&&(z(l,!1),l.strm.avail_out),u)}),new lt(4,4,8,4,pt),new lt(4,5,16,8,pt),new lt(4,6,32,32,pt),new lt(4,4,16,16,at),new lt(8,16,32,32,at),new lt(8,16,128,128,at),new lt(8,32,128,256,at),new lt(32,128,258,1024,at),new lt(32,258,258,4096,at)],i.deflateInit=function(l,B){return vt(l,B,x,15,8,0)},i.deflateInit2=vt,i.deflateReset=wt,i.deflateResetKeep=ct,i.deflateSetHeader=function(l,B){return l&&l.state?l.state.wrap!==2?y:(l.state.gzhead=B,h):y},i.deflate=function(l,B){var M,b,w,E;if(!l||!l.state||5<B||B<0)return l?nt(l,y):y;if(b=l.state,!l.output||!l.input&&l.avail_in!==0||b.status===666&&B!==m)return nt(l,l.avail_out===0?-5:y);if(b.strm=l,M=b.last_flush,b.last_flush=B,b.status===S)if(b.wrap===2)l.adler=0,J(b,31),J(b,139),J(b,8),b.gzhead?(J(b,(b.gzhead.text?1:0)+(b.gzhead.hcrc?2:0)+(b.gzhead.extra?4:0)+(b.gzhead.name?8:0)+(b.gzhead.comment?16:0)),J(b,255&b.gzhead.time),J(b,b.gzhead.time>>8&255),J(b,b.gzhead.time>>16&255),J(b,b.gzhead.time>>24&255),J(b,b.level===9?2:2<=b.strategy||b.level<2?4:0),J(b,255&b.gzhead.os),b.gzhead.extra&&b.gzhead.extra.length&&(J(b,255&b.gzhead.extra.length),J(b,b.gzhead.extra.length>>8&255)),b.gzhead.hcrc&&(l.adler=c(l.adler,b.pending_buf,b.pending,0)),b.gzindex=0,b.status=69):(J(b,0),J(b,0),J(b,0),J(b,0),J(b,0),J(b,b.level===9?2:2<=b.strategy||b.level<2?4:0),J(b,3),b.status=L);else{var N=x+(b.w_bits-8<<4)<<8;N|=(2<=b.strategy||b.level<2?0:b.level<6?1:b.level===6?2:3)<<6,b.strstart!==0&&(N|=32),N+=31-N%31,b.status=L,Y(b,N),b.strstart!==0&&(Y(b,l.adler>>>16),Y(b,65535&l.adler)),l.adler=1}if(b.status===69)if(b.gzhead.extra){for(w=b.pending;b.gzindex<(65535&b.gzhead.extra.length)&&(b.pending!==b.pending_buf_size||(b.gzhead.hcrc&&b.pending>w&&(l.adler=c(l.adler,b.pending_buf,b.pending-w,w)),A(l),w=b.pending,b.pending!==b.pending_buf_size));)J(b,255&b.gzhead.extra[b.gzindex]),b.gzindex++;b.gzhead.hcrc&&b.pending>w&&(l.adler=c(l.adler,b.pending_buf,b.pending-w,w)),b.gzindex===b.gzhead.extra.length&&(b.gzindex=0,b.status=73)}else b.status=73;if(b.status===73)if(b.gzhead.name){w=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>w&&(l.adler=c(l.adler,b.pending_buf,b.pending-w,w)),A(l),w=b.pending,b.pending===b.pending_buf_size)){E=1;break}E=b.gzindex<b.gzhead.name.length?255&b.gzhead.name.charCodeAt(b.gzindex++):0,J(b,E)}while(E!==0);b.gzhead.hcrc&&b.pending>w&&(l.adler=c(l.adler,b.pending_buf,b.pending-w,w)),E===0&&(b.gzindex=0,b.status=91)}else b.status=91;if(b.status===91)if(b.gzhead.comment){w=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>w&&(l.adler=c(l.adler,b.pending_buf,b.pending-w,w)),A(l),w=b.pending,b.pending===b.pending_buf_size)){E=1;break}E=b.gzindex<b.gzhead.comment.length?255&b.gzhead.comment.charCodeAt(b.gzindex++):0,J(b,E)}while(E!==0);b.gzhead.hcrc&&b.pending>w&&(l.adler=c(l.adler,b.pending_buf,b.pending-w,w)),E===0&&(b.status=103)}else b.status=103;if(b.status===103&&(b.gzhead.hcrc?(b.pending+2>b.pending_buf_size&&A(l),b.pending+2<=b.pending_buf_size&&(J(b,255&l.adler),J(b,l.adler>>8&255),l.adler=0,b.status=L)):b.status=L),b.pending!==0){if(A(l),l.avail_out===0)return b.last_flush=-1,h}else if(l.avail_in===0&&j(B)<=j(M)&&B!==m)return nt(l,-5);if(b.status===666&&l.avail_in!==0)return nt(l,-5);if(l.avail_in!==0||b.lookahead!==0||B!==_&&b.status!==666){var U=b.strategy===2?(function(D,Z){for(var K;;){if(D.lookahead===0&&(ht(D),D.lookahead===0)){if(Z===_)return u;break}if(D.match_length=0,K=a._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,K&&(z(D,!1),D.strm.avail_out===0))return u}return D.insert=0,Z===m?(z(D,!0),D.strm.avail_out===0?it:$):D.last_lit&&(z(D,!1),D.strm.avail_out===0)?u:F})(b,B):b.strategy===3?(function(D,Z){for(var K,X,q,dt,ot=D.window;;){if(D.lookahead<=G){if(ht(D),D.lookahead<=G&&Z===_)return u;if(D.lookahead===0)break}if(D.match_length=0,D.lookahead>=P&&0<D.strstart&&(X=ot[q=D.strstart-1])===ot[++q]&&X===ot[++q]&&X===ot[++q]){dt=D.strstart+G;do;while(X===ot[++q]&&X===ot[++q]&&X===ot[++q]&&X===ot[++q]&&X===ot[++q]&&X===ot[++q]&&X===ot[++q]&&X===ot[++q]&&q<dt);D.match_length=G-(dt-q),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=P?(K=a._tr_tally(D,1,D.match_length-P),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(K=a._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),K&&(z(D,!1),D.strm.avail_out===0))return u}return D.insert=0,Z===m?(z(D,!0),D.strm.avail_out===0?it:$):D.last_lit&&(z(D,!1),D.strm.avail_out===0)?u:F})(b,B):s[b.level].func(b,B);if(U!==it&&U!==$||(b.status=666),U===u||U===it)return l.avail_out===0&&(b.last_flush=-1),h;if(U===F&&(B===1?a._tr_align(b):B!==5&&(a._tr_stored_block(b,0,0,!1),B===3&&(tt(b.head),b.lookahead===0&&(b.strstart=0,b.block_start=0,b.insert=0))),A(l),l.avail_out===0))return b.last_flush=-1,h}return B!==m?h:b.wrap<=0?1:(b.wrap===2?(J(b,255&l.adler),J(b,l.adler>>8&255),J(b,l.adler>>16&255),J(b,l.adler>>24&255),J(b,255&l.total_in),J(b,l.total_in>>8&255),J(b,l.total_in>>16&255),J(b,l.total_in>>24&255)):(Y(b,l.adler>>>16),Y(b,65535&l.adler)),A(l),0<b.wrap&&(b.wrap=-b.wrap),b.pending!==0?h:1)},i.deflateEnd=function(l){var B;return l&&l.state?(B=l.state.status)!==S&&B!==69&&B!==73&&B!==91&&B!==103&&B!==L&&B!==666?nt(l,y):(l.state=null,B===L?nt(l,-3):h):y},i.deflateSetDictionary=function(l,B){var M,b,w,E,N,U,D,Z,K=B.length;if(!l||!l.state||(E=(M=l.state).wrap)===2||E===1&&M.status!==S||M.lookahead)return y;for(E===1&&(l.adler=d(l.adler,B,K,0)),M.wrap=0,K>=M.w_size&&(E===0&&(tt(M.head),M.strstart=0,M.block_start=0,M.insert=0),Z=new o.Buf8(M.w_size),o.arraySet(Z,B,K-M.w_size,M.w_size,0),B=Z,K=M.w_size),N=l.avail_in,U=l.next_in,D=l.input,l.avail_in=K,l.next_in=0,l.input=B,ht(M);M.lookahead>=P;){for(b=M.strstart,w=M.lookahead-(P-1);M.ins_h=(M.ins_h<<M.hash_shift^M.window[b+P-1])&M.hash_mask,M.prev[b&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=b,b++,--w;);M.strstart=b,M.lookahead=P-1,ht(M)}return M.strstart+=M.lookahead,M.block_start=M.strstart,M.insert=M.lookahead,M.lookahead=0,M.match_length=M.prev_length=P-1,M.match_available=0,l.next_in=U,l.input=D,l.avail_in=N,M.wrap=E,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,r,i){r.exports=function(s,o){var a,d,c,p,_,m,h,y,f,v,g,x,C,T,I,O,R,H,P,G,Q,S,L,u,F;a=s.state,d=s.next_in,u=s.input,c=d+(s.avail_in-5),p=s.next_out,F=s.output,_=p-(o-s.avail_out),m=p+(s.avail_out-257),h=a.dmax,y=a.wsize,f=a.whave,v=a.wnext,g=a.window,x=a.hold,C=a.bits,T=a.lencode,I=a.distcode,O=(1<<a.lenbits)-1,R=(1<<a.distbits)-1;t:do{C<15&&(x+=u[d++]<<C,C+=8,x+=u[d++]<<C,C+=8),H=T[x&O];e:for(;;){if(x>>>=P=H>>>24,C-=P,(P=H>>>16&255)===0)F[p++]=65535&H;else{if(!(16&P)){if((64&P)==0){H=T[(65535&H)+(x&(1<<P)-1)];continue e}if(32&P){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}G=65535&H,(P&=15)&&(C<P&&(x+=u[d++]<<C,C+=8),G+=x&(1<<P)-1,x>>>=P,C-=P),C<15&&(x+=u[d++]<<C,C+=8,x+=u[d++]<<C,C+=8),H=I[x&R];i:for(;;){if(x>>>=P=H>>>24,C-=P,!(16&(P=H>>>16&255))){if((64&P)==0){H=I[(65535&H)+(x&(1<<P)-1)];continue i}s.msg="invalid distance code",a.mode=30;break t}if(Q=65535&H,C<(P&=15)&&(x+=u[d++]<<C,(C+=8)<P&&(x+=u[d++]<<C,C+=8)),h<(Q+=x&(1<<P)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(x>>>=P,C-=P,(P=p-_)<Q){if(f<(P=Q-P)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(L=g,(S=0)===v){if(S+=y-P,P<G){for(G-=P;F[p++]=g[S++],--P;);S=p-Q,L=F}}else if(v<P){if(S+=y+v-P,(P-=v)<G){for(G-=P;F[p++]=g[S++],--P;);if(S=0,v<G){for(G-=P=v;F[p++]=g[S++],--P;);S=p-Q,L=F}}}else if(S+=v-P,P<G){for(G-=P;F[p++]=g[S++],--P;);S=p-Q,L=F}for(;2<G;)F[p++]=L[S++],F[p++]=L[S++],F[p++]=L[S++],G-=3;G&&(F[p++]=L[S++],1<G&&(F[p++]=L[S++]))}else{for(S=p-Q;F[p++]=F[S++],F[p++]=F[S++],F[p++]=F[S++],2<(G-=3););G&&(F[p++]=F[S++],1<G&&(F[p++]=F[S++]))}break}}break}}while(d<c&&p<m);d-=G=C>>3,x&=(1<<(C-=G<<3))-1,s.next_in=d,s.next_out=p,s.avail_in=d<c?c-d+5:5-(d-c),s.avail_out=p<m?m-p+257:257-(p-m),a.hold=x,a.bits=C}},{}],49:[function(e,r,i){var s=e("../utils/common"),o=e("./adler32"),a=e("./crc32"),d=e("./inffast"),c=e("./inftrees"),p=1,_=2,m=0,h=-2,y=1,f=852,v=592;function g(S){return(S>>>24&255)+(S>>>8&65280)+((65280&S)<<8)+((255&S)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function C(S){var L;return S&&S.state?(L=S.state,S.total_in=S.total_out=L.total=0,S.msg="",L.wrap&&(S.adler=1&L.wrap),L.mode=y,L.last=0,L.havedict=0,L.dmax=32768,L.head=null,L.hold=0,L.bits=0,L.lencode=L.lendyn=new s.Buf32(f),L.distcode=L.distdyn=new s.Buf32(v),L.sane=1,L.back=-1,m):h}function T(S){var L;return S&&S.state?((L=S.state).wsize=0,L.whave=0,L.wnext=0,C(S)):h}function I(S,L){var u,F;return S&&S.state?(F=S.state,L<0?(u=0,L=-L):(u=1+(L>>4),L<48&&(L&=15)),L&&(L<8||15<L)?h:(F.window!==null&&F.wbits!==L&&(F.window=null),F.wrap=u,F.wbits=L,T(S))):h}function O(S,L){var u,F;return S?(F=new x,(S.state=F).window=null,(u=I(S,L))!==m&&(S.state=null),u):h}var R,H,P=!0;function G(S){if(P){var L;for(R=new s.Buf32(512),H=new s.Buf32(32),L=0;L<144;)S.lens[L++]=8;for(;L<256;)S.lens[L++]=9;for(;L<280;)S.lens[L++]=7;for(;L<288;)S.lens[L++]=8;for(c(p,S.lens,0,288,R,0,S.work,{bits:9}),L=0;L<32;)S.lens[L++]=5;c(_,S.lens,0,32,H,0,S.work,{bits:5}),P=!1}S.lencode=R,S.lenbits=9,S.distcode=H,S.distbits=5}function Q(S,L,u,F){var it,$=S.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new s.Buf8($.wsize)),F>=$.wsize?(s.arraySet($.window,L,u-$.wsize,$.wsize,0),$.wnext=0,$.whave=$.wsize):(F<(it=$.wsize-$.wnext)&&(it=F),s.arraySet($.window,L,u-F,it,$.wnext),(F-=it)?(s.arraySet($.window,L,u-F,F,0),$.wnext=F,$.whave=$.wsize):($.wnext+=it,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=it))),0}i.inflateReset=T,i.inflateReset2=I,i.inflateResetKeep=C,i.inflateInit=function(S){return O(S,15)},i.inflateInit2=O,i.inflate=function(S,L){var u,F,it,$,nt,j,tt,A,z,J,Y,V,ht,pt,at,lt,ft,ct,wt,vt,l,B,M,b,w=0,E=new s.Buf8(4),N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!S||!S.state||!S.output||!S.input&&S.avail_in!==0)return h;(u=S.state).mode===12&&(u.mode=13),nt=S.next_out,it=S.output,tt=S.avail_out,$=S.next_in,F=S.input,j=S.avail_in,A=u.hold,z=u.bits,J=j,Y=tt,B=m;t:for(;;)switch(u.mode){case y:if(u.wrap===0){u.mode=13;break}for(;z<16;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}if(2&u.wrap&&A===35615){E[u.check=0]=255&A,E[1]=A>>>8&255,u.check=a(u.check,E,2,0),z=A=0,u.mode=2;break}if(u.flags=0,u.head&&(u.head.done=!1),!(1&u.wrap)||(((255&A)<<8)+(A>>8))%31){S.msg="incorrect header check",u.mode=30;break}if((15&A)!=8){S.msg="unknown compression method",u.mode=30;break}if(z-=4,l=8+(15&(A>>>=4)),u.wbits===0)u.wbits=l;else if(l>u.wbits){S.msg="invalid window size",u.mode=30;break}u.dmax=1<<l,S.adler=u.check=1,u.mode=512&A?10:12,z=A=0;break;case 2:for(;z<16;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}if(u.flags=A,(255&u.flags)!=8){S.msg="unknown compression method",u.mode=30;break}if(57344&u.flags){S.msg="unknown header flags set",u.mode=30;break}u.head&&(u.head.text=A>>8&1),512&u.flags&&(E[0]=255&A,E[1]=A>>>8&255,u.check=a(u.check,E,2,0)),z=A=0,u.mode=3;case 3:for(;z<32;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}u.head&&(u.head.time=A),512&u.flags&&(E[0]=255&A,E[1]=A>>>8&255,E[2]=A>>>16&255,E[3]=A>>>24&255,u.check=a(u.check,E,4,0)),z=A=0,u.mode=4;case 4:for(;z<16;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}u.head&&(u.head.xflags=255&A,u.head.os=A>>8),512&u.flags&&(E[0]=255&A,E[1]=A>>>8&255,u.check=a(u.check,E,2,0)),z=A=0,u.mode=5;case 5:if(1024&u.flags){for(;z<16;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}u.length=A,u.head&&(u.head.extra_len=A),512&u.flags&&(E[0]=255&A,E[1]=A>>>8&255,u.check=a(u.check,E,2,0)),z=A=0}else u.head&&(u.head.extra=null);u.mode=6;case 6:if(1024&u.flags&&(j<(V=u.length)&&(V=j),V&&(u.head&&(l=u.head.extra_len-u.length,u.head.extra||(u.head.extra=new Array(u.head.extra_len)),s.arraySet(u.head.extra,F,$,V,l)),512&u.flags&&(u.check=a(u.check,F,V,$)),j-=V,$+=V,u.length-=V),u.length))break t;u.length=0,u.mode=7;case 7:if(2048&u.flags){if(j===0)break t;for(V=0;l=F[$+V++],u.head&&l&&u.length<65536&&(u.head.name+=String.fromCharCode(l)),l&&V<j;);if(512&u.flags&&(u.check=a(u.check,F,V,$)),j-=V,$+=V,l)break t}else u.head&&(u.head.name=null);u.length=0,u.mode=8;case 8:if(4096&u.flags){if(j===0)break t;for(V=0;l=F[$+V++],u.head&&l&&u.length<65536&&(u.head.comment+=String.fromCharCode(l)),l&&V<j;);if(512&u.flags&&(u.check=a(u.check,F,V,$)),j-=V,$+=V,l)break t}else u.head&&(u.head.comment=null);u.mode=9;case 9:if(512&u.flags){for(;z<16;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}if(A!==(65535&u.check)){S.msg="header crc mismatch",u.mode=30;break}z=A=0}u.head&&(u.head.hcrc=u.flags>>9&1,u.head.done=!0),S.adler=u.check=0,u.mode=12;break;case 10:for(;z<32;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}S.adler=u.check=g(A),z=A=0,u.mode=11;case 11:if(u.havedict===0)return S.next_out=nt,S.avail_out=tt,S.next_in=$,S.avail_in=j,u.hold=A,u.bits=z,2;S.adler=u.check=1,u.mode=12;case 12:if(L===5||L===6)break t;case 13:if(u.last){A>>>=7&z,z-=7&z,u.mode=27;break}for(;z<3;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}switch(u.last=1&A,z-=1,3&(A>>>=1)){case 0:u.mode=14;break;case 1:if(G(u),u.mode=20,L!==6)break;A>>>=2,z-=2;break t;case 2:u.mode=17;break;case 3:S.msg="invalid block type",u.mode=30}A>>>=2,z-=2;break;case 14:for(A>>>=7&z,z-=7&z;z<32;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}if((65535&A)!=(A>>>16^65535)){S.msg="invalid stored block lengths",u.mode=30;break}if(u.length=65535&A,z=A=0,u.mode=15,L===6)break t;case 15:u.mode=16;case 16:if(V=u.length){if(j<V&&(V=j),tt<V&&(V=tt),V===0)break t;s.arraySet(it,F,$,V,nt),j-=V,$+=V,tt-=V,nt+=V,u.length-=V;break}u.mode=12;break;case 17:for(;z<14;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}if(u.nlen=257+(31&A),A>>>=5,z-=5,u.ndist=1+(31&A),A>>>=5,z-=5,u.ncode=4+(15&A),A>>>=4,z-=4,286<u.nlen||30<u.ndist){S.msg="too many length or distance symbols",u.mode=30;break}u.have=0,u.mode=18;case 18:for(;u.have<u.ncode;){for(;z<3;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}u.lens[N[u.have++]]=7&A,A>>>=3,z-=3}for(;u.have<19;)u.lens[N[u.have++]]=0;if(u.lencode=u.lendyn,u.lenbits=7,M={bits:u.lenbits},B=c(0,u.lens,0,19,u.lencode,0,u.work,M),u.lenbits=M.bits,B){S.msg="invalid code lengths set",u.mode=30;break}u.have=0,u.mode=19;case 19:for(;u.have<u.nlen+u.ndist;){for(;lt=(w=u.lencode[A&(1<<u.lenbits)-1])>>>16&255,ft=65535&w,!((at=w>>>24)<=z);){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}if(ft<16)A>>>=at,z-=at,u.lens[u.have++]=ft;else{if(ft===16){for(b=at+2;z<b;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}if(A>>>=at,z-=at,u.have===0){S.msg="invalid bit length repeat",u.mode=30;break}l=u.lens[u.have-1],V=3+(3&A),A>>>=2,z-=2}else if(ft===17){for(b=at+3;z<b;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}z-=at,l=0,V=3+(7&(A>>>=at)),A>>>=3,z-=3}else{for(b=at+7;z<b;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}z-=at,l=0,V=11+(127&(A>>>=at)),A>>>=7,z-=7}if(u.have+V>u.nlen+u.ndist){S.msg="invalid bit length repeat",u.mode=30;break}for(;V--;)u.lens[u.have++]=l}}if(u.mode===30)break;if(u.lens[256]===0){S.msg="invalid code -- missing end-of-block",u.mode=30;break}if(u.lenbits=9,M={bits:u.lenbits},B=c(p,u.lens,0,u.nlen,u.lencode,0,u.work,M),u.lenbits=M.bits,B){S.msg="invalid literal/lengths set",u.mode=30;break}if(u.distbits=6,u.distcode=u.distdyn,M={bits:u.distbits},B=c(_,u.lens,u.nlen,u.ndist,u.distcode,0,u.work,M),u.distbits=M.bits,B){S.msg="invalid distances set",u.mode=30;break}if(u.mode=20,L===6)break t;case 20:u.mode=21;case 21:if(6<=j&&258<=tt){S.next_out=nt,S.avail_out=tt,S.next_in=$,S.avail_in=j,u.hold=A,u.bits=z,d(S,Y),nt=S.next_out,it=S.output,tt=S.avail_out,$=S.next_in,F=S.input,j=S.avail_in,A=u.hold,z=u.bits,u.mode===12&&(u.back=-1);break}for(u.back=0;lt=(w=u.lencode[A&(1<<u.lenbits)-1])>>>16&255,ft=65535&w,!((at=w>>>24)<=z);){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}if(lt&&(240&lt)==0){for(ct=at,wt=lt,vt=ft;lt=(w=u.lencode[vt+((A&(1<<ct+wt)-1)>>ct)])>>>16&255,ft=65535&w,!(ct+(at=w>>>24)<=z);){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}A>>>=ct,z-=ct,u.back+=ct}if(A>>>=at,z-=at,u.back+=at,u.length=ft,lt===0){u.mode=26;break}if(32&lt){u.back=-1,u.mode=12;break}if(64&lt){S.msg="invalid literal/length code",u.mode=30;break}u.extra=15&lt,u.mode=22;case 22:if(u.extra){for(b=u.extra;z<b;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}u.length+=A&(1<<u.extra)-1,A>>>=u.extra,z-=u.extra,u.back+=u.extra}u.was=u.length,u.mode=23;case 23:for(;lt=(w=u.distcode[A&(1<<u.distbits)-1])>>>16&255,ft=65535&w,!((at=w>>>24)<=z);){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}if((240&lt)==0){for(ct=at,wt=lt,vt=ft;lt=(w=u.distcode[vt+((A&(1<<ct+wt)-1)>>ct)])>>>16&255,ft=65535&w,!(ct+(at=w>>>24)<=z);){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}A>>>=ct,z-=ct,u.back+=ct}if(A>>>=at,z-=at,u.back+=at,64&lt){S.msg="invalid distance code",u.mode=30;break}u.offset=ft,u.extra=15&lt,u.mode=24;case 24:if(u.extra){for(b=u.extra;z<b;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}u.offset+=A&(1<<u.extra)-1,A>>>=u.extra,z-=u.extra,u.back+=u.extra}if(u.offset>u.dmax){S.msg="invalid distance too far back",u.mode=30;break}u.mode=25;case 25:if(tt===0)break t;if(V=Y-tt,u.offset>V){if((V=u.offset-V)>u.whave&&u.sane){S.msg="invalid distance too far back",u.mode=30;break}ht=V>u.wnext?(V-=u.wnext,u.wsize-V):u.wnext-V,V>u.length&&(V=u.length),pt=u.window}else pt=it,ht=nt-u.offset,V=u.length;for(tt<V&&(V=tt),tt-=V,u.length-=V;it[nt++]=pt[ht++],--V;);u.length===0&&(u.mode=21);break;case 26:if(tt===0)break t;it[nt++]=u.length,tt--,u.mode=21;break;case 27:if(u.wrap){for(;z<32;){if(j===0)break t;j--,A|=F[$++]<<z,z+=8}if(Y-=tt,S.total_out+=Y,u.total+=Y,Y&&(S.adler=u.check=u.flags?a(u.check,it,Y,nt-Y):o(u.check,it,Y,nt-Y)),Y=tt,(u.flags?A:g(A))!==u.check){S.msg="incorrect data check",u.mode=30;break}z=A=0}u.mode=28;case 28:if(u.wrap&&u.flags){for(;z<32;){if(j===0)break t;j--,A+=F[$++]<<z,z+=8}if(A!==(4294967295&u.total)){S.msg="incorrect length check",u.mode=30;break}z=A=0}u.mode=29;case 29:B=1;break t;case 30:B=-3;break t;case 31:return-4;default:return h}return S.next_out=nt,S.avail_out=tt,S.next_in=$,S.avail_in=j,u.hold=A,u.bits=z,(u.wsize||Y!==S.avail_out&&u.mode<30&&(u.mode<27||L!==4))&&Q(S,S.output,S.next_out,Y-S.avail_out)?(u.mode=31,-4):(J-=S.avail_in,Y-=S.avail_out,S.total_in+=J,S.total_out+=Y,u.total+=Y,u.wrap&&Y&&(S.adler=u.check=u.flags?a(u.check,it,Y,S.next_out-Y):o(u.check,it,Y,S.next_out-Y)),S.data_type=u.bits+(u.last?64:0)+(u.mode===12?128:0)+(u.mode===20||u.mode===15?256:0),(J==0&&Y===0||L===4)&&B===m&&(B=-5),B)},i.inflateEnd=function(S){if(!S||!S.state)return h;var L=S.state;return L.window&&(L.window=null),S.state=null,m},i.inflateGetHeader=function(S,L){var u;return S&&S.state?(2&(u=S.state).wrap)==0?h:((u.head=L).done=!1,m):h},i.inflateSetDictionary=function(S,L){var u,F=L.length;return S&&S.state?(u=S.state).wrap!==0&&u.mode!==11?h:u.mode===11&&o(1,L,F,0)!==u.check?-3:Q(S,L,F,F)?(u.mode=31,-4):(u.havedict=1,m):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,r,i){var s=e("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(p,_,m,h,y,f,v,g){var x,C,T,I,O,R,H,P,G,Q=g.bits,S=0,L=0,u=0,F=0,it=0,$=0,nt=0,j=0,tt=0,A=0,z=null,J=0,Y=new s.Buf16(16),V=new s.Buf16(16),ht=null,pt=0;for(S=0;S<=15;S++)Y[S]=0;for(L=0;L<h;L++)Y[_[m+L]]++;for(it=Q,F=15;1<=F&&Y[F]===0;F--);if(F<it&&(it=F),F===0)return y[f++]=20971520,y[f++]=20971520,g.bits=1,0;for(u=1;u<F&&Y[u]===0;u++);for(it<u&&(it=u),S=j=1;S<=15;S++)if(j<<=1,(j-=Y[S])<0)return-1;if(0<j&&(p===0||F!==1))return-1;for(V[1]=0,S=1;S<15;S++)V[S+1]=V[S]+Y[S];for(L=0;L<h;L++)_[m+L]!==0&&(v[V[_[m+L]]++]=L);if(R=p===0?(z=ht=v,19):p===1?(z=o,J-=257,ht=a,pt-=257,256):(z=d,ht=c,-1),S=u,O=f,nt=L=A=0,T=-1,I=(tt=1<<($=it))-1,p===1&&852<tt||p===2&&592<tt)return 1;for(;;){for(H=S-nt,G=v[L]<R?(P=0,v[L]):v[L]>R?(P=ht[pt+v[L]],z[J+v[L]]):(P=96,0),x=1<<S-nt,u=C=1<<$;y[O+(A>>nt)+(C-=x)]=H<<24|P<<16|G|0,C!==0;);for(x=1<<S-1;A&x;)x>>=1;if(x!==0?(A&=x-1,A+=x):A=0,L++,--Y[S]==0){if(S===F)break;S=_[m+v[L]]}if(it<S&&(A&I)!==T){for(nt===0&&(nt=it),O+=u,j=1<<($=S-nt);$+nt<F&&!((j-=Y[$+nt])<=0);)$++,j<<=1;if(tt+=1<<$,p===1&&852<tt||p===2&&592<tt)return 1;y[T=A&I]=it<<24|$<<16|O-f|0}}return A!==0&&(y[O+A]=S-nt<<24|64<<16|0),g.bits=it,0}},{"../utils/common":41}],51:[function(e,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,r,i){var s=e("../utils/common"),o=0,a=1;function d(w){for(var E=w.length;0<=--E;)w[E]=0}var c=0,p=29,_=256,m=_+1+p,h=30,y=19,f=2*m+1,v=15,g=16,x=7,C=256,T=16,I=17,O=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],H=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Q=new Array(2*(m+2));d(Q);var S=new Array(2*h);d(S);var L=new Array(512);d(L);var u=new Array(256);d(u);var F=new Array(p);d(F);var it,$,nt,j=new Array(h);function tt(w,E,N,U,D){this.static_tree=w,this.extra_bits=E,this.extra_base=N,this.elems=U,this.max_length=D,this.has_stree=w&&w.length}function A(w,E){this.dyn_tree=w,this.max_code=0,this.stat_desc=E}function z(w){return w<256?L[w]:L[256+(w>>>7)]}function J(w,E){w.pending_buf[w.pending++]=255&E,w.pending_buf[w.pending++]=E>>>8&255}function Y(w,E,N){w.bi_valid>g-N?(w.bi_buf|=E<<w.bi_valid&65535,J(w,w.bi_buf),w.bi_buf=E>>g-w.bi_valid,w.bi_valid+=N-g):(w.bi_buf|=E<<w.bi_valid&65535,w.bi_valid+=N)}function V(w,E,N){Y(w,N[2*E],N[2*E+1])}function ht(w,E){for(var N=0;N|=1&w,w>>>=1,N<<=1,0<--E;);return N>>>1}function pt(w,E,N){var U,D,Z=new Array(v+1),K=0;for(U=1;U<=v;U++)Z[U]=K=K+N[U-1]<<1;for(D=0;D<=E;D++){var X=w[2*D+1];X!==0&&(w[2*D]=ht(Z[X]++,X))}}function at(w){var E;for(E=0;E<m;E++)w.dyn_ltree[2*E]=0;for(E=0;E<h;E++)w.dyn_dtree[2*E]=0;for(E=0;E<y;E++)w.bl_tree[2*E]=0;w.dyn_ltree[2*C]=1,w.opt_len=w.static_len=0,w.last_lit=w.matches=0}function lt(w){8<w.bi_valid?J(w,w.bi_buf):0<w.bi_valid&&(w.pending_buf[w.pending++]=w.bi_buf),w.bi_buf=0,w.bi_valid=0}function ft(w,E,N,U){var D=2*E,Z=2*N;return w[D]<w[Z]||w[D]===w[Z]&&U[E]<=U[N]}function ct(w,E,N){for(var U=w.heap[N],D=N<<1;D<=w.heap_len&&(D<w.heap_len&&ft(E,w.heap[D+1],w.heap[D],w.depth)&&D++,!ft(E,U,w.heap[D],w.depth));)w.heap[N]=w.heap[D],N=D,D<<=1;w.heap[N]=U}function wt(w,E,N){var U,D,Z,K,X=0;if(w.last_lit!==0)for(;U=w.pending_buf[w.d_buf+2*X]<<8|w.pending_buf[w.d_buf+2*X+1],D=w.pending_buf[w.l_buf+X],X++,U===0?V(w,D,E):(V(w,(Z=u[D])+_+1,E),(K=R[Z])!==0&&Y(w,D-=F[Z],K),V(w,Z=z(--U),N),(K=H[Z])!==0&&Y(w,U-=j[Z],K)),X<w.last_lit;);V(w,C,E)}function vt(w,E){var N,U,D,Z=E.dyn_tree,K=E.stat_desc.static_tree,X=E.stat_desc.has_stree,q=E.stat_desc.elems,dt=-1;for(w.heap_len=0,w.heap_max=f,N=0;N<q;N++)Z[2*N]!==0?(w.heap[++w.heap_len]=dt=N,w.depth[N]=0):Z[2*N+1]=0;for(;w.heap_len<2;)Z[2*(D=w.heap[++w.heap_len]=dt<2?++dt:0)]=1,w.depth[D]=0,w.opt_len--,X&&(w.static_len-=K[2*D+1]);for(E.max_code=dt,N=w.heap_len>>1;1<=N;N--)ct(w,Z,N);for(D=q;N=w.heap[1],w.heap[1]=w.heap[w.heap_len--],ct(w,Z,1),U=w.heap[1],w.heap[--w.heap_max]=N,w.heap[--w.heap_max]=U,Z[2*D]=Z[2*N]+Z[2*U],w.depth[D]=(w.depth[N]>=w.depth[U]?w.depth[N]:w.depth[U])+1,Z[2*N+1]=Z[2*U+1]=D,w.heap[1]=D++,ct(w,Z,1),2<=w.heap_len;);w.heap[--w.heap_max]=w.heap[1],(function(ot,gt){var St,bt,Ct,ut,Dt,Lt,xt=gt.dyn_tree,Ft=gt.max_code,Gt=gt.stat_desc.static_tree,Xt=gt.stat_desc.has_stree,Vt=gt.stat_desc.extra_bits,Nt=gt.stat_desc.extra_base,Et=gt.stat_desc.max_length,zt=0;for(ut=0;ut<=v;ut++)ot.bl_count[ut]=0;for(xt[2*ot.heap[ot.heap_max]+1]=0,St=ot.heap_max+1;St<f;St++)Et<(ut=xt[2*xt[2*(bt=ot.heap[St])+1]+1]+1)&&(ut=Et,zt++),xt[2*bt+1]=ut,Ft<bt||(ot.bl_count[ut]++,Dt=0,Nt<=bt&&(Dt=Vt[bt-Nt]),Lt=xt[2*bt],ot.opt_len+=Lt*(ut+Dt),Xt&&(ot.static_len+=Lt*(Gt[2*bt+1]+Dt)));if(zt!==0){do{for(ut=Et-1;ot.bl_count[ut]===0;)ut--;ot.bl_count[ut]--,ot.bl_count[ut+1]+=2,ot.bl_count[Et]--,zt-=2}while(0<zt);for(ut=Et;ut!==0;ut--)for(bt=ot.bl_count[ut];bt!==0;)Ft<(Ct=ot.heap[--St])||(xt[2*Ct+1]!==ut&&(ot.opt_len+=(ut-xt[2*Ct+1])*xt[2*Ct],xt[2*Ct+1]=ut),bt--)}})(w,E),pt(Z,dt,w.bl_count)}function l(w,E,N){var U,D,Z=-1,K=E[1],X=0,q=7,dt=4;for(K===0&&(q=138,dt=3),E[2*(N+1)+1]=65535,U=0;U<=N;U++)D=K,K=E[2*(U+1)+1],++X<q&&D===K||(X<dt?w.bl_tree[2*D]+=X:D!==0?(D!==Z&&w.bl_tree[2*D]++,w.bl_tree[2*T]++):X<=10?w.bl_tree[2*I]++:w.bl_tree[2*O]++,Z=D,dt=(X=0)===K?(q=138,3):D===K?(q=6,3):(q=7,4))}function B(w,E,N){var U,D,Z=-1,K=E[1],X=0,q=7,dt=4;for(K===0&&(q=138,dt=3),U=0;U<=N;U++)if(D=K,K=E[2*(U+1)+1],!(++X<q&&D===K)){if(X<dt)for(;V(w,D,w.bl_tree),--X!=0;);else D!==0?(D!==Z&&(V(w,D,w.bl_tree),X--),V(w,T,w.bl_tree),Y(w,X-3,2)):X<=10?(V(w,I,w.bl_tree),Y(w,X-3,3)):(V(w,O,w.bl_tree),Y(w,X-11,7));Z=D,dt=(X=0)===K?(q=138,3):D===K?(q=6,3):(q=7,4)}}d(j);var M=!1;function b(w,E,N,U){Y(w,(c<<1)+(U?1:0),3),(function(D,Z,K,X){lt(D),J(D,K),J(D,~K),s.arraySet(D.pending_buf,D.window,Z,K,D.pending),D.pending+=K})(w,E,N)}i._tr_init=function(w){M||((function(){var E,N,U,D,Z,K=new Array(v+1);for(D=U=0;D<p-1;D++)for(F[D]=U,E=0;E<1<<R[D];E++)u[U++]=D;for(u[U-1]=D,D=Z=0;D<16;D++)for(j[D]=Z,E=0;E<1<<H[D];E++)L[Z++]=D;for(Z>>=7;D<h;D++)for(j[D]=Z<<7,E=0;E<1<<H[D]-7;E++)L[256+Z++]=D;for(N=0;N<=v;N++)K[N]=0;for(E=0;E<=143;)Q[2*E+1]=8,E++,K[8]++;for(;E<=255;)Q[2*E+1]=9,E++,K[9]++;for(;E<=279;)Q[2*E+1]=7,E++,K[7]++;for(;E<=287;)Q[2*E+1]=8,E++,K[8]++;for(pt(Q,m+1,K),E=0;E<h;E++)S[2*E+1]=5,S[2*E]=ht(E,5);it=new tt(Q,R,_+1,m,v),$=new tt(S,H,0,h,v),nt=new tt(new Array(0),P,0,y,x)})(),M=!0),w.l_desc=new A(w.dyn_ltree,it),w.d_desc=new A(w.dyn_dtree,$),w.bl_desc=new A(w.bl_tree,nt),w.bi_buf=0,w.bi_valid=0,at(w)},i._tr_stored_block=b,i._tr_flush_block=function(w,E,N,U){var D,Z,K=0;0<w.level?(w.strm.data_type===2&&(w.strm.data_type=(function(X){var q,dt=4093624447;for(q=0;q<=31;q++,dt>>>=1)if(1&dt&&X.dyn_ltree[2*q]!==0)return o;if(X.dyn_ltree[18]!==0||X.dyn_ltree[20]!==0||X.dyn_ltree[26]!==0)return a;for(q=32;q<_;q++)if(X.dyn_ltree[2*q]!==0)return a;return o})(w)),vt(w,w.l_desc),vt(w,w.d_desc),K=(function(X){var q;for(l(X,X.dyn_ltree,X.l_desc.max_code),l(X,X.dyn_dtree,X.d_desc.max_code),vt(X,X.bl_desc),q=y-1;3<=q&&X.bl_tree[2*G[q]+1]===0;q--);return X.opt_len+=3*(q+1)+5+5+4,q})(w),D=w.opt_len+3+7>>>3,(Z=w.static_len+3+7>>>3)<=D&&(D=Z)):D=Z=N+5,N+4<=D&&E!==-1?b(w,E,N,U):w.strategy===4||Z===D?(Y(w,2+(U?1:0),3),wt(w,Q,S)):(Y(w,4+(U?1:0),3),(function(X,q,dt,ot){var gt;for(Y(X,q-257,5),Y(X,dt-1,5),Y(X,ot-4,4),gt=0;gt<ot;gt++)Y(X,X.bl_tree[2*G[gt]+1],3);B(X,X.dyn_ltree,q-1),B(X,X.dyn_dtree,dt-1)})(w,w.l_desc.max_code+1,w.d_desc.max_code+1,K+1),wt(w,w.dyn_ltree,w.dyn_dtree)),at(w),U&&lt(w)},i._tr_tally=function(w,E,N){return w.pending_buf[w.d_buf+2*w.last_lit]=E>>>8&255,w.pending_buf[w.d_buf+2*w.last_lit+1]=255&E,w.pending_buf[w.l_buf+w.last_lit]=255&N,w.last_lit++,E===0?w.dyn_ltree[2*N]++:(w.matches++,E--,w.dyn_ltree[2*(u[N]+_+1)]++,w.dyn_dtree[2*z(E)]++),w.last_lit===w.lit_bufsize-1},i._tr_align=function(w){Y(w,2,3),V(w,C,Q),(function(E){E.bi_valid===16?(J(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)})(w)}},{"../utils/common":41}],53:[function(e,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,r,i){(function(s){(function(o,a){if(!o.setImmediate){var d,c,p,_,m=1,h={},y=!1,f=o.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(o);v=v&&v.setTimeout?v:o,d={}.toString.call(o.process)==="[object process]"?function(T){process.nextTick(function(){x(T)})}:(function(){if(o.postMessage&&!o.importScripts){var T=!0,I=o.onmessage;return o.onmessage=function(){T=!1},o.postMessage("","*"),o.onmessage=I,T}})()?(_="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",C,!1):o.attachEvent("onmessage",C),function(T){o.postMessage(_+T,"*")}):o.MessageChannel?((p=new MessageChannel).port1.onmessage=function(T){x(T.data)},function(T){p.port2.postMessage(T)}):f&&"onreadystatechange"in f.createElement("script")?(c=f.documentElement,function(T){var I=f.createElement("script");I.onreadystatechange=function(){x(T),I.onreadystatechange=null,c.removeChild(I),I=null},c.appendChild(I)}):function(T){setTimeout(x,0,T)},v.setImmediate=function(T){typeof T!="function"&&(T=new Function(""+T));for(var I=new Array(arguments.length-1),O=0;O<I.length;O++)I[O]=arguments[O+1];var R={callback:T,args:I};return h[m]=R,d(m),m++},v.clearImmediate=g}function g(T){delete h[T]}function x(T){if(y)setTimeout(x,0,T);else{var I=h[T];if(I){y=!0;try{(function(O){var R=O.callback,H=O.args;switch(H.length){case 0:R();break;case 1:R(H[0]);break;case 2:R(H[0],H[1]);break;case 3:R(H[0],H[1],H[2]);break;default:R.apply(a,H)}})(I)}finally{g(T),y=!1}}}}function C(T){T.source===o&&typeof T.data=="string"&&T.data.indexOf(_)===0&&x(+T.data.slice(_.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Mt<"u"?Mt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Bt)),Bt.exports}var se=ie();const re=ee(se);let st=new Zt,_t=!1;const ne={getStorage(){return st},isDropboxMode(){return _t},_nodes:[],_edges:[],_nodeMap:new Map,_selectedNode:null,_heatmapOn:!1,_revokableURLs:[],_ctxTargetId:null,_clusterMode:"strict",_filesVisible:!1,_groupingEnabled:!0,_groupedFolders:new Set,_nodeComments:new Map,_favorites:new Set,_theme:"dark",init(){window.AetherApp=this;const t={onNodeSelect:r=>this.onNodeSelect(r),onContextMenu:(r,i,s)=>this.showContextMenu(r,i,s),onConnectionDrop:(r,i,s,o,a)=>this.onConnectionDrop(r,i,s,o,a),onNodeMoveAttempt:(r,i)=>this.handleNodeMove(r,i),getFavorites:()=>this._favorites,onShowMoveCopyMenu:(r,i,s,o)=>this.showMoveCopyMenu(r,i,s,o)};W.init("aether-canvas","minimap-canvas",t),W.setFilesVisible(this._filesVisible),this.bindEvents();const n=localStorage.getItem("aetherfs-theme")||"dark";this._theme=n,document.documentElement.dataset.theme=this._theme;const e=k.el("btn-toggle-theme");e&&(e.textContent=this._theme==="dark"?"‚òÄ":"üåô"),this._handleDropboxCallback(),this._loadComments(),this._loadFavorites(),k.el("btn-close-activity-log")?.addEventListener("click",()=>this.toggleActivityLog()),this._logTimeInterval=null},toggleActivityLog(){mt.togglePanel();const t=mt.isPanelVisible(),n=k.el("btn-activity-log");n&&n.classList.toggle("active",t),t&&!this._logTimeInterval?this._logTimeInterval=setInterval(()=>{if(!mt.isPanelVisible())return;const e=k.el("activity-log-time");e&&(e.textContent=new Date().toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}))},1e3):!t&&this._logTimeInterval&&(clearInterval(this._logTimeInterval),this._logTimeInterval=null)},async _handleDropboxCallback(){new URLSearchParams(window.location.search).has("code")&&(this._showLoading("–ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø DROPBOX‚Ä¶"),await Tt.handleCallback()?(k.toast("Dropbox –ø–æ–¥–∫–ª—é—á–µ–Ω!","success",2e3),await this._openDropbox()):(this._hideLoading(),k.toast("–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Dropbox","error",3e3)))},bindEvents(){document.addEventListener("keydown",e=>{document.activeElement.tagName!=="INPUT"&&((e.ctrlKey||e.metaKey)&&e.key==="k"&&(e.preventDefault(),this.openSearch()),e.key==="Escape"&&(this.closeSearch(null),this.closePreview(),k.hide(k.el("context-menu")),k.hide(k.el("create-menu"))),(e.key==="h"||e.key==="H")&&this.toggleHeatmap(),(e.key==="f"||e.key==="F")&&W.fitView())}),document.addEventListener("click",e=>{e.target.closest(".context-menu")||(k.hide(k.el("context-menu")),k.hide(k.el("create-menu")))}),document.querySelectorAll(".cluster-btn").forEach(e=>{e.addEventListener("click",r=>{const i=r.currentTarget.dataset.mode;document.querySelectorAll(".cluster-btn").forEach(s=>s.classList.remove("active")),r.currentTarget.classList.add("active"),this.setLayoutMode(i)})}),W.canvas?.addEventListener("dblclick",e=>{const r=W.screenToWorld(e.offsetX,e.offsetY),i=W.hitTest(r.x,r.y);i&&i.type==="folder"&&this.toggleCollapse(i.id)}),k.el("search-input")?.addEventListener("input",e=>this._onSearchInput(e.target.value)),k.el("search-overlay")?.addEventListener("click",e=>this.closeSearch(e)),k.el("btn-search")?.addEventListener("click",()=>this.openSearch()),k.el("btn-open-dir")?.addEventListener("click",()=>this.openDirectory()),k.el("btn-load-demo")?.addEventListener("click",()=>this.loadDemo()),k.el("btn-go-home")?.addEventListener("click",()=>this.goHome()),k.el("btn-close-app")?.addEventListener("click",()=>this.goHome()),k.el("btn-heatmap")?.addEventListener("click",()=>this.toggleHeatmap()),k.el("btn-fit")?.addEventListener("click",()=>W.fitView()),k.el("btn-reset-layout")?.addEventListener("click",()=>this.resetLayoutToStrict()),k.el("btn-toggle-files")?.addEventListener("click",()=>this.toggleFilesVisibility()),k.el("btn-connect-dropbox")?.addEventListener("click",()=>this.connectDropbox()),k.el("btn-zoom-in")?.addEventListener("click",()=>W.zoom(1.3)),k.el("btn-zoom-out")?.addEventListener("click",()=>W.zoom(.77)),k.el("btn-zoom-fit")?.addEventListener("click",()=>W.fitView()),k.el("btn-close-preview")?.addEventListener("click",()=>this.closePreview()),window.addEventListener("keydown",e=>{if(e.key==="Delete"&&(W._selectedId||W._selectedIds.size>0)){const r=new Set(W._selectedIds);if(W._selectedId&&r.add(W._selectedId),r.size===0)return;const i=[...r].map(s=>this._nodeMap.get(s)?.name).filter(Boolean).join(", ");if(!confirm(`–£–¥–∞–ª–∏—Ç—å ${r.size} —ç–ª–µ–º–µ–Ω—Ç(–æ–≤)?
${i}`))return;for(const s of r){const o=this._nodeMap.get(s);if(!o)continue;const a=new Set,d=c=>{a.add(c),this._edges.filter(p=>p.source===c).forEach(p=>d(p.target))};d(o.id),this._nodes=this._nodes.filter(c=>!a.has(c.id)),this._edges=this._edges.filter(c=>!a.has(c.source)&&!a.has(c.target)),this._nodeMap=new Map(this._nodes.map(c=>[c.id,c])),_t&&st.deleteNode&&st.deleteNode(o).catch(()=>{})}W._selectedIds.clear(),W._selectedId=null,this._applyGraph(.4),k.toast(`–£–¥–∞–ª–µ–Ω–æ: ${r.size} —ç–ª–µ–º–µ–Ω—Ç(–æ–≤)`,"success"),e.preventDefault()}if(e.key==="a"&&(e.ctrlKey||e.metaKey)){e.preventDefault(),W._selectedIds.clear();for(const r of this._nodes)W._selectedIds.add(r.id);W.markDirty(),k.toast(`–í—ã–¥–µ–ª–µ–Ω–æ: ${this._nodes.length}`,"info",1e3)}if(e.key==="e"&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.exportGraph()),e.key==="b"&&(e.ctrlKey||e.metaKey)&&W._selectedId){e.preventDefault();const r=this._nodeMap.get(W._selectedId);r&&(this._ctxTargetId=r.id,this.ctx_toggleFavorite())}e.key==="Escape"&&(W._pathHighlightIds.clear(),W._selectedId=null,W._selectedIds.clear(),W.markDirty(),this._uploadPickerMode&&kt.cancelUploadPicker(this),this._timelineOpen&&Rt.close(this))});const t=W.canvas;let n=0;t&&(t.addEventListener("dragenter",e=>{e.preventDefault(),n++,k.show(k.el("upload-overlay"))}),t.addEventListener("dragleave",e=>{e.preventDefault(),n--,n<=0&&(n=0,k.hide(k.el("upload-overlay")))}),t.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"}),t.addEventListener("drop",e=>{e.preventDefault(),n=0,k.hide(k.el("upload-overlay"));const r=e.dataTransfer.files;!r||r.length===0||(this._pendingUploadFiles=[...r],kt.enterUploadPickerMode(this))}))},goHome(){location.reload()},loadDemo(){this._showLoading("–ì–ï–ù–ï–†–ê–¶–ò–Ø –î–ï–ú–û‚Ä¶"),setTimeout(()=>{const t=st.generateDemo();this._loadGraph(t.nodes,t.edges,"–º–æ–π-–ø—Ä–æ–µ–∫—Ç [–î–ï–ú–û]")},300)},setLayoutMode(t){this._clusterMode=t,et.setMode(t),this._applyGraph(t==="strict"?0:.8)},resetLayoutToStrict(){if(this._clusterMode!=="strict"){k.toast("–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ ¬´–°—Ç—Ä–æ–≥–∏–π¬ª","info",2e3);return}et.applyStrictLayout(),this._nodes=et.nodes,this._nodeMap=new Map(this._nodes.map(t=>[t.id,t])),W.loadGraph(this._nodes,this._edges),W.markDirty(),k.toast("–†–∞—Å–∫–ª–∞–¥–∫–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –≤ —Å—Ç—Ä–æ–≥–∏–π –≤–∏–¥","success",1500)},async openDirectory(){if(!("showDirectoryPicker"in window)){k.toast("File System Access API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º","error",3e3);return}this._showLoading("–û–¢–ö–†–´–¢–ò–ï –ü–ê–ü–ö–ò‚Ä¶");let t;try{if(t=await st.openDirectory((n,e)=>{k.el("loading-text").textContent="–°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï –°–ò–°–¢–ï–ú–´‚Ä¶",k.el("loading-sub").textContent=`${n} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ ¬∑ ${e}`}),!t){this._hideLoading();return}this._loadGraph(t.nodes,t.edges,st.rootName)}catch(n){this._hideLoading(),n.name!=="AbortError"&&k.toast(`–û—à–∏–±–∫–∞: ${n.message}`,"error")}},_groupFiles(t,n){if(!this._groupingEnabled&&this._groupedFolders.size===0)return{nodes:t,edges:n};const e=5,r=new Map,i=new Map(t.map(p=>[p.id,p]));for(const p of n){const _=i.get(p.target);_&&_.type!=="folder"&&(r.has(p.source)||r.set(p.source,[]),r.get(p.source).push(_))}const s=new Set,o=[],a=[];for(const[p,_]of r.entries()){const m=this._groupingEnabled&&_.length>e,h=this._groupedFolders.has(p)&&_.length>1;if(m||h){const y=_.reduce((v,g)=>v+(g.sizeBytes||0),0),f=p+"_filegroup";o.push({id:f,name:`[ üìÑ ${_.length} —Ñ–∞–π–ª–æ–≤ ]`,type:"file-group",sizeBytes:y,parentId:p,_hiddenFiles:_,x:0,y:0}),a.push({id:`${p}->${f}`,source:p,target:f});for(const v of _)s.add(v.id)}}const d=t.filter(p=>!s.has(p.id)).concat(o),c=n.filter(p=>!s.has(p.target)).concat(a);return{nodes:d,edges:c}},_loadGraph(t,n,e){const{nodes:r,edges:i}=this._groupFiles(t,n);this._rawNodes=t,this._rawEdges=n,this._edges=i,this._nodeMap=new Map(r.map(s=>[s.id,s])),It.load(r),k.hide(k.el("landing-screen")),k.show(k.el("graph-screen")),W.resize(),k.el("toolbar-path").textContent=e||"",this._updateStats(r),this._renderSidebarTree(r),et.init(r,i,this._clusterMode,(s,o)=>{this._nodes=s,this._nodeMap=new Map(s.map(a=>[a.id,a])),W.loadGraph(s,i),W.markDirty(),o&&this._hideLoading()}),this._nodes=et.nodes,W.loadGraph(et.nodes,i),W.markDirty(),et.start(),k.el("loading-text").textContent="–†–ê–°–ß–ï–¢ –ì–†–ê–§–ê‚Ä¶",k.el("loading-sub").textContent=`${r.length} —É–∑–ª–æ–≤ ‚Äî —Å–∏–º—É–ª—è—Ü–∏—è‚Ä¶`},showMoveCopyMenu(t,n,e,r){this._pendingMoveCopy={srcNode:t,targetFolder:n};const i=k.el("move-copy-menu");i.style.left=`${Math.min(e,window.innerWidth-180)}px`,i.style.top=`${Math.min(r,window.innerHeight-150)}px`;const s=Array.isArray(t)?t.length:1,o=i.querySelector(".move-copy-header");o&&(o.textContent=s>1?`${s} —ç–ª–µ–º–µ–Ω—Ç(–æ–≤) ‚Üí ${n.name}`:`${t.name||""} ‚Üí ${n.name}`),k.show(i)},async executeMoveCopy(t){if(k.hide(k.el("move-copy-menu")),!this._pendingMoveCopy||t==="cancel"){this._pendingMoveCopy=null;return}const{srcNode:n,targetFolder:e}=this._pendingMoveCopy;this._pendingMoveCopy=null;const r=Array.isArray(n)?n:[n];for(const i of r)t==="move"?await this.handleNodeMove(i,e):t==="copy"&&await this.handleNodeCopy(i,e)},async handleNodeMove(t,n){const e=t._dbxPath??t.path,r=t.parentId,i=this._edges.filter(o=>o.target===t.id);this._edges=this._edges.filter(o=>o.target!==t.id);const s={id:`${n.id}->${t.id}`,source:n.id,target:t.id};this._edges.push(s),t.parentId=n.id,t.parent=n.id,this._applyGraph(.6),k.toast(`–ü–µ—Ä–µ–º–µ—â–µ–Ω–æ: ${t.name} –≤ ${n.name}`,"success"),mt.add({type:"move",title:`–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ ¬´${n.name}¬ª`,status:"success",tags:[t.name,n.name,(e||"").replace(/^\//,"")]});try{await st.moveNode(t,n),t._tag&&await this._persistTagsConfigPathMove(e,t._dbxPath??t.path,t._tag),this._syncDropboxNow()}catch(o){this._edges=this._edges.filter(a=>a.id!==s.id),i.forEach(a=>this._edges.push(a)),t.parentId=r,t.parent=r,this._applyGraph(0),k.toast(`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è: ${o.message}`,"error",3e3),mt.add({type:"move",title:`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è: ${t.name}`,status:"error",tags:[o.message]})}},async handleNodeCopy(t,n){try{await st.copyNode(t,n),k.toast(`–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: ${t.name} –≤ ${n.name}`,"success"),mt.add({type:"copy",title:`–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ ¬´${n.name}¬ª`,status:"success",tags:[t.name,n.name]}),this._syncDropboxNow()}catch(e){k.toast(e.message,"error",3e3),mt.add({type:"copy",title:`–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ${t.name}`,status:"error",tags:[e.message]})}},onConnectionDrop(t,n,e,r,i){if(!t||t.type!=="folder"){k.toast("–°–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∏–∑ –ø–∞–ø–∫–∏","info",1500);return}this._pendingCreate={srcNode:t,wx:r,wy:i},setTimeout(()=>{const s=k.el("create-menu");s.style.left=`${Math.min(n,window.innerWidth-150)}px`,s.style.top=`${Math.min(e,window.innerHeight-100)}px`,k.show(s)},10)},async createNode(t){if(k.hide(k.el("create-menu")),!this._pendingCreate)return;const{srcNode:n,wx:e,wy:r}=this._pendingCreate;this._pendingCreate=null;const i=t==="folder",s=i?"–ò–º—è –ø–∞–ø–∫–∏...":"–ò–º—è —Ñ–∞–π–ª–∞.txt";W.showInlineInput(e,r,s,o=>{o&&this._doCreateNode(n,o,i,e,r)})},async _doCreateNode(t,n,e,r,i){const o=(t._dbxPath||t.path||"")+"/"+n,a=o,d=k.hashStr(a),c=e?"folder":rt.infer(n,!1),p={id:d,name:n,path:a,type:c,sizeBytes:e?0:1024,subtreeSizeBytes:e?0:1024,modifiedAt:new Date,parentId:t.id,handle:null,x:r,y:i,vx:0,vy:0,_radius:rt.radius(1024,e),_dbxPath:a},_={id:t.id+"->"+d,source:t.id,target:d};this._nodes.push(p),this._edges.push(_),this._nodeMap.set(d,p),W._nodeMap.set(d,p),this._renderSidebarTree(this._nodes),It.load(this._nodes),et?(et.nodes.push(p),et.edges.push(_),et._calcTreeDepths(et.nodes,et.edges),et.reheat(this._clusterMode==="strict"?0:.5),W.nodes=et.nodes,W.edges=et.edges):(W.nodes=this._nodes,W.edges=this._edges),W.selectNode(d),W.markDirty(),this._syncRawData(),k.toast(`–°–æ–∑–¥–∞–Ω–æ: ${n}`,"success"),mt.add({type:"create",title:e?`–°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ ¬´${n}¬ª`:`–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª ¬´${n}¬ª`,status:"success",tags:[n,t.name||""]});try{if(_t){const m=e?await st.createFolder(o):await st.createFile(o);m?.path_display&&(p._dbxPath=m.path_display,p.path=m.path_display),this._syncDropboxNow()}else t.handle&&await(e?st.createFolder(t.id,n):st.createFile(t.id,n))}catch(m){this._nodes=this._nodes.filter(h=>h.id!==d),this._edges=this._edges.filter(h=>h.id!==_.id),this._nodeMap.delete(d),et&&(et.nodes=this._nodes,et.edges=this._edges,et._calcTreeDepths(this._nodes,this._edges)),W.loadGraph(this._nodes,this._edges),W.markDirty(),this._renderSidebarTree(this._nodes),k.toast(`–û—à–∏–±–∫–∞: ${m.message}`,"error",3e3),mt.add({type:"create",title:`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${n}`,status:"error",tags:[m.message]})}},_updateStats(t){const n=t||this._nodes;k.el("stat-nodes").textContent=n.length,k.el("stat-files").textContent=n.filter(e=>e.type!=="folder").length,k.el("stat-size").textContent=k.formatSize(n.filter(e=>e.type!=="folder").reduce((e,r)=>e+(r.sizeBytes||0),0))},_ensureGraphIntegrity(){let t=0;const n=new Set(this._nodes.map(c=>c.id)),e=this._edges.length;this._edges=this._edges.filter(c=>n.has(c.source)&&n.has(c.target)),t+=e-this._edges.length;const r=new Set,i=[];for(const c of this._edges){const p=`${c.source}‚Üí${c.target}`;r.has(p)?t++:(r.add(p),i.push(c))}this._edges=i;const s=new Set(this._edges.map(c=>c.target)),o=this._nodes.filter(c=>!s.has(c.id)),a=o.length>0?o[0].id:this._nodes[0]?.id||null,d=new Set;d.add(a);for(const c of this._edges)d.add(c.source),d.add(c.target);for(const c of this._nodes)if(!d.has(c.id)&&c.id!==a){const p=c.parentId||a;n.has(p)?this._edges.push({id:`${p}->${c.id}`,source:p,target:c.id}):this._edges.push({id:`${a}->${c.id}`,source:a,target:c.id}),t++}return this._nodeMap=new Map(this._nodes.map(c=>[c.id,c])),t>0&&console.warn(`[GraphIntegrity] Fixed ${t} issue(s)`),{fixed:t}},_applyGraph(t=.3){this._ensureGraphIntegrity(),et&&(et.nodes=this._nodes,et.edges=this._edges,et.reheat(this._clusterMode==="strict"?0:t),this._clusterMode==="strict"&&et.applyStrictLayout({onlyUnpositioned:!0})),W.loadGraph(this._nodes,this._edges),W.markDirty(),this._syncRawData(),this._renderSidebarTree(this._nodes),this._updateStats(this._nodes)},_syncRawData(){const t=[],n=[];for(const e of this._nodes)if(e.type!=="file-group")t.push(e);else if(e._hiddenFiles)for(const r of e._hiddenFiles)t.push(r),n.push({id:`${r.parentId}->${r.id}`,source:r.parentId,target:r.id});for(const e of this._edges)e.id&&e.id.includes("_filegroup")||n.push(e);this._rawNodes=t,this._rawEdges=n},exportGraph(){const t=W.canvas;if(!t)return;const n=document.createElement("a");n.download=`aetherfs-graph-${Date.now()}.png`,n.href=t.toDataURL("image/png"),n.click(),k.toast("–ì—Ä–∞—Ñ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ PNG","success")},_pendingUploadFiles:null,_uploadPickerMode:!1,_enterUploadPickerMode(){kt.enterUploadPickerMode(this)},cancelUploadPicker(){kt.cancelUploadPicker(this)},_exitUploadPickerMode(){kt.exitUploadPickerMode(this)},_timelineOpen:!1,openTimeline(){Rt.open(this)},closeTimeline(){Rt.close(this)},_showLoading(t){k.el("loading-text").textContent=t||"–ó–ê–ì–†–£–ó–ö–ê‚Ä¶",k.el("loading-sub").textContent="",k.show(k.el("loading-overlay"))},_hideLoading(){k.hide(k.el("loading-overlay"))},_renderSidebarTree(t){Kt.renderTree(this,t)},onNodeSelect(t){const n=this._nodeMap.get(t);if(!n)return;this._selectedNode=n,this._openPreview(n),document.querySelectorAll(".tree-item").forEach(r=>r.classList.remove("selected"));const e=document.querySelector(`.tree-item[data-id="${t}"]`);e&&(e.classList.add("selected"),e.scrollIntoView({behavior:"smooth",block:"nearest"}))},async _openPreview(t){const n=k.el("preview-panel");for(const p of this._revokableURLs)URL.revokeObjectURL(p);this._revokableURLs=[],k.el("panel-node-icon").textContent="",k.el("panel-node-icon").style.background=rt.hexToRgba(rt.color(t.type),.4),k.el("panel-node-icon").style.borderColor=rt.color(t.type),k.el("panel-filename").textContent=t.name,k.el("panel-filename").style.color=rt.color(t.type),k.el("panel-path").textContent=t.path;const e=t.name.includes(".")?t.name.slice(t.name.lastIndexOf(".")):"";k.el("meta-type").textContent=rt.label(t.type)+(e?` (${e})`:""),k.el("meta-size").textContent=t.type==="folder"?`${k.formatSize(t.subtreeSizeBytes)} –≤—Å–µ–≥–æ`:k.formatSize(t.sizeBytes),k.el("meta-modified").textContent=k.formatDate(t.modifiedAt);const r=k.el("meta-path");r.textContent=t.path,r.title=t.path;const i=k.el("panel-preview-area");if(i.innerHTML="",t.type==="file-group"){const p=document.createElement("div");p.style.padding="10px",p.style.display="flex",p.style.flexDirection="column",p.style.gap="5px",p.style.overflowY="auto",p.style.maxHeight="100%",p.style.width="100%";for(const _ of t._hiddenFiles||[]){const m=document.createElement("div");m.style.padding="8px",m.style.background="#222",m.style.borderRadius="4px",m.style.borderLeft=`3px solid ${rt.color(_.type)}`,m.style.cursor="pointer",m.innerHTML=`
                    <div style="font-size: 13px; font-weight: bold; color: ${rt.color(_.type)}">${k.escapeHtml(_.name)}</div>
                    <div style="font-size: 11px; color: #888">${k.formatSize(_.sizeBytes)}</div>
                `,m.addEventListener("mouseenter",()=>m.style.background="#333"),m.addEventListener("mouseleave",()=>m.style.background="#222"),m.addEventListener("click",()=>this._openPreview(_)),p.appendChild(m)}i.appendChild(p)}else if(t.handle||t._dbxPath){const p=t.handle||t;if(t.type==="image"){const _=await st.readFileURL(p).catch(()=>null);if(_){this._revokableURLs.push(_);const m=document.createElement("img");m.src=_,i.appendChild(m)}else this._placeholderPreview(i,t)}else if(t.type==="code"||t.type==="document"){const _=await st.readFileText(p).catch(()=>null);if(_!==null){const m=document.createElement("pre");m.className="preview-code",m.textContent=_.slice(0,3e3),i.appendChild(m)}else this._placeholderPreview(i,t)}else if(t.type==="video"){const _=await st.readFileURL(p).catch(()=>null);if(_){this._revokableURLs.push(_);const m=document.createElement("video");m.src=_,m.controls=!0,m.style.maxHeight="220px",i.appendChild(m)}else this._placeholderPreview(i,t)}else if(t.type==="audio"){const _=await st.readFileURL(p).catch(()=>null);if(_){this._revokableURLs.push(_);const m=document.createElement("audio");m.src=_,m.controls=!0,m.style.width="90%",i.appendChild(m)}else this._placeholderPreview(i,t)}else this._placeholderPreview(i,t)}else this._placeholderPreview(i,t);const s=k.el("panel-comment-area");s&&s.remove();const o=document.createElement("div");o.id="panel-comment-area",o.style.cssText="padding:12px 16px; border-top:1px solid rgba(255,255,255,0.08);",o.innerHTML=`
            <div style="font-size:11px; color:#888; margin-bottom:6px; text-transform:uppercase; letter-spacing:1px;">–ó–∞–º–µ—Ç–∫–∞</div>
            <textarea id="panel-comment-text" placeholder="–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É –∫ —ç—Ç–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É..."
                style="width:100%; min-height:64px; max-height:150px; resize:vertical;
                background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.1);
                border-radius:8px; padding:10px 12px; color:#e0e8ff; font-size:13px;
                font-family:'Inter Tight',sans-serif; outline:none;
                transition:border-color 0.2s, box-shadow 0.2s;"
                onfocus="this.style.borderColor='rgba(100,180,255,0.4)';this.style.boxShadow='0 0 0 3px rgba(100,180,255,0.08)'"
                onblur="this.style.borderColor='rgba(255,255,255,0.1)';this.style.boxShadow='none'"
            ></textarea>
        `,(n.querySelector(".panel-content")||n).appendChild(o);const d=k.el("panel-comment-text"),c=this._nodeComments.get(t.id)||"";d.value=c,d.addEventListener("blur",()=>{this.saveComment(t.id,d.value)}),d.addEventListener("keydown",p=>{p.key==="Enter"&&(p.ctrlKey||p.metaKey)&&(this.saveComment(t.id,d.value),k.toast("–ó–∞–º–µ—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞","success",1e3),p.preventDefault())}),k.show(n)},_placeholderPreview(t,n){t.innerHTML=`<div class="preview-placeholder"><div style="background:${rt.color(n.type)}; width:32px; height:32px; display:inline-block; margin-bottom:12px;"></div><p style="color:${rt.hexToRgba(rt.color(n.type),.6)}">${rt.label(n.type).toUpperCase()}</p></div>`},closePreview(){k.hide(k.el("preview-panel")),this._selectedNode=null,W.deselect()},toggleFilesVisibility(){this._filesVisible=!this._filesVisible;const t=k.el("btn-toggle-files");t&&t.classList.toggle("active",this._filesVisible),W.setFilesVisible(this._filesVisible),this._applyGraph(.5)},toggleGrouping(){this._groupingEnabled=!this._groupingEnabled;const t=k.el("btn-toggle-grouping");t&&t.classList.toggle("active",this._groupingEnabled),(!this._rawNodes||!this._rawEdges)&&this._syncRawData();const n=this._rawNodes.map(s=>({...s})),e=this._rawEdges.map(s=>({...s})),{nodes:r,edges:i}=this._groupFiles(n,e);this._nodes=r,this._edges=i,this._applyGraph(.3),k.toast(this._groupingEnabled?"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –í–ö–õ":"–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –í–´–ö–õ","info",1500)},toggleTheme(){this._theme=this._theme==="dark"?"light":"dark",document.documentElement.dataset.theme=this._theme,localStorage.setItem("aetherfs-theme",this._theme);const t=k.el("btn-toggle-theme");t&&(t.textContent=this._theme==="dark"?"‚òÄ":"üåô"),W.markDirty()},toggleCollapse(t){const n=this._nodeMap.get(t);!n||n.type!=="folder"||(n.collapsed=!n.collapsed,et&&et.reheat(.4),W.markDirty(),this._renderSidebarTree(this._nodes))},showContextMenu(t,n,e){this._ctxTargetId=e;const r=k.el("context-menu");if(!r)return;const i=this._nodeMap.get(e),s=i&&i.type==="folder";r.querySelectorAll(".ctx-folder-only").forEach(o=>{o.style.display=s?"":"none"}),r.style.left=`${Math.min(t,window.innerWidth-180)}px`,r.style.top=`${Math.min(n,window.innerHeight-300)}px`,k.show(r)},ctx_open(){k.toast("–û—Ç–∫—Ä—ã—Ç–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ File System Access API","info")},ctx_copyPath(){const t=this._nodeMap.get(this._ctxTargetId);t&&k.copyText(t.path)},async ctx_download(){k.hide(k.el("context-menu"));const t=this._nodeMap.get(this._ctxTargetId);if(!(!t||!st.getFileBlob))if(t.type==="folder"){const n=new Set,e=i=>{n.add(i),this._edges.filter(s=>s.source===i).forEach(s=>e(s.target))};e(t.id);const r=this._nodes.filter(i=>i.type!=="folder"&&n.has(i.id));if(r.length===0){k.toast("–í –ø–∞–ø–∫–µ –Ω–µ—Ç —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è","info");return}this._showLoading(`–°–∫–∞—á–∏–≤–∞–Ω–∏–µ‚Ä¶ ${r.length} —Ñ–∞–π–ª(–æ–≤)`);try{const i=new re,s=((t._dbxPath??t.path)||"").replace(/\/+$/,"")||t.name;for(let a=0;a<r.length;a++){const d=r[a],c=d._dbxPath??d.path??d.name,p=c.startsWith(s)?c.slice(s.length).replace(/^\/+/,""):d.name,_=p?`${t.name}/${p}`:`${t.name}/${d.name}`,m=await st.getFileBlob(d);m&&i.file(_,m),r.length>3&&(k.el("loading-sub").textContent=`${a+1} / ${r.length}`)}const o=await i.generateAsync({type:"blob"});this._triggerDownload(o,`${t.name}.zip`),k.toast(`–°–∫–∞—á–∞–Ω–æ: ${t.name}.zip`,"success",2e3)}catch(i){console.error(i),k.toast(`–û—à–∏–±–∫–∞: ${i.message}`,"error",3e3)}finally{this._hideLoading()}}else{this._showLoading("–°–∫–∞—á–∏–≤–∞–Ω–∏–µ‚Ä¶");try{const n=await st.getFileBlob(t);if(!n)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª");this._triggerDownload(n,t.name),k.toast(`–°–∫–∞—á–∞–Ω–æ: ${t.name}`,"success",2e3)}catch(n){k.toast(`–û—à–∏–±–∫–∞: ${n.message}`,"error",3e3)}finally{this._hideLoading()}}},_triggerDownload(t,n){const e=URL.createObjectURL(t),r=document.createElement("a");r.href=e,r.download=n,r.click(),URL.revokeObjectURL(e)},ctx_focusType(){const t=this._nodeMap.get(this._ctxTargetId);t&&(W.setDimMode(!0,t.type),k.toast(`–ü–æ–∫–∞–∑ —Ç–æ–ª—å–∫–æ: ${rt.label(t.type)}`,"info",2e3),setTimeout(()=>W.setDimMode(!1),4e3))},ctx_expandCluster(){const t=this._nodeMap.get(this._ctxTargetId);if(!t)return;const n=new Set,e=[t.id];for(;e.length>0;){const i=e.pop();n.add(i),this._edges.filter(s=>s.source===i).forEach(s=>e.push(s.target))}this._nodes.filter(i=>!n.has(i.id)).forEach(i=>i._tempHidden=!0),k.toast(`–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–æ: ${t.name}`,"info",3e3),W.markDirty(),setTimeout(()=>{this._nodes.forEach(i=>delete i._tempHidden),W.markDirty()},8e3)},ctx_collapseAll(){const t=this._nodes.find(n=>!n.parentId)?.id;this._nodes.forEach(n=>{n.type==="folder"&&n.id!==t&&(n.collapsed=!0)}),et&&et.reheat(.4),W.markDirty(),this._renderSidebarTree(this._nodes),k.toast("–í—Å–µ –ø–∞–ø–∫–∏ —Å–≤–µ—Ä–Ω—É—Ç—ã","info")},toggleHeatmap(){this._heatmapOn=!this._heatmapOn,W.heatmapMode=this._heatmapOn,W.markDirty();const t=k.el("btn-heatmap"),n=k.el("heatmap-legend");this._heatmapOn?(t.classList.add("active"),k.show(n),this._buildHeatmapLegend(),k.toast("–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –í–ö–õ","info",1500)):(t.classList.remove("active"),k.hide(n),k.toast("–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –í–´–ö–õ","info",1500))},_buildHeatmapLegend(){const t=this._nodes.filter(e=>e.type==="folder").sort((e,r)=>(r.subtreeSizeBytes||0)-(e.subtreeSizeBytes||0)).slice(0,5),n=t[0]?t[0].subtreeSizeBytes:1;k.el("legend-entries").innerHTML=t.map(e=>{const r=(e.subtreeSizeBytes||0)/n;return`<div class="legend-entry"><div class="legend-entry-dot" style="background:${rt.heatColor(r)}"></div><div class="legend-entry-name">${k.escapeHtml(e.name)}</div><div class="legend-entry-size">${k.formatSize(e.subtreeSizeBytes)}</div></div>`}).join("")},async _applyTagsFromConfig(){if(!(!_t||!st.readTagsConfig))try{const t=await st.readTagsConfig();if(!t||!t.pathToTag)return;for(const n of this._nodes){const e=n._dbxPath??n.path;e&&t.pathToTag[e]!==void 0&&(n._tag=t.pathToTag[e])}}catch(t){console.warn("[Tags] Failed to load config:",t.message)}},openSearch(){k.show(k.el("search-overlay"));const t=k.el("search-input");t.value="",t.focus(),k.el("search-results").innerHTML='<div class="search-empty">–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç...</div>'},closeSearch(t){(!t||t.target===k.el("search-overlay"))&&k.hide(k.el("search-overlay"))},_onSearchInput(t){const n=It.query(t);It.renderResults(k.el("search-results"),n,t,e=>{k.hide(k.el("search-overlay")),W.selectNode(e),W.highlightNode(e),W.panTo(e,1.8),W.setDimMode(!0,null),setTimeout(()=>W.setDimMode(!1),3e3)})},async connectDropbox(){Tt.isLoggedIn()?(this._showLoading("–ó–ê–ì–†–£–ó–ö–ê DROPBOX‚Ä¶"),await this._openDropbox()):Tt.login()},async _openDropbox(){this._showLoading("–°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï DROPBOX‚Ä¶"),st=new Ot,_t=!0;try{const t=await st.openDirectory((n,e)=>{k.el("loading-text").textContent="–°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï DROPBOX‚Ä¶",k.el("loading-sub").textContent=`${n} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ ¬∑ ${e}`});if(!t){this._hideLoading();return}this._loadGraph(t.nodes,t.edges,st.rootName),await this._applyTagsFromConfig(),W.markDirty(),k.show(k.el("btn-sync-dropbox")),this._startDropboxSync()}catch(t){this._hideLoading(),k.toast(`–û—à–∏–±–∫–∞ Dropbox: ${t.message}`,"error",4e3)}},_startDropboxSync(){this._dropboxSyncInterval&&clearInterval(this._dropboxSyncInterval),this._dropboxSyncInterval=null},async forceSyncDropbox(){if(_t){this._showLoading("–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø DROPBOX‚Ä¶");try{const t=new Ot,n=await t.openDirectory(()=>{});if(!n)return;for(const e of n.nodes){const r=this._nodeMap?.get(e.id);r&&(e.x=r.x,e.y=r.y,e.vx=r.vx||0,e.vy=r.vy||0)}this._loadGraph(n.nodes,n.edges,t.rootName),await this._applyTagsFromConfig(),W.markDirty(),k.toast("‚òÅ Dropbox: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ","success",2e3)}catch(t){k.toast(`–û—à–∏–±–∫–∞ Dropbox: ${t.message}`,"error",4e3),this._hideLoading()}}},_syncDropboxNow(){_t&&(this._syncDebounce&&clearTimeout(this._syncDebounce),this._syncDebounce=setTimeout(async()=>{try{const t=new Ot,n=await t.openDirectory(()=>{});if(!n)return;const e=new Set((this._rawNodes||[]).map(s=>s.id)),r=new Set(n.nodes.map(s=>s.id));let i=!1;if(e.size!==r.size)i=!0;else for(const s of r)if(!e.has(s)){i=!0;break}if(i){st=t;for(const a of n.nodes){const d=this._nodeMap?.get(a.id);d&&(a.x=d.x,a.y=d.y,a.vx=d.vx||0,a.vy=d.vy||0)}const{nodes:s,edges:o}=this._groupFiles(n.nodes,n.edges);this._rawNodes=n.nodes,this._rawEdges=n.edges;for(const a of s)if(a.type==="file-group"){const d=this._nodeMap?.get(a.id);d&&(a.x=d.x,a.y=d.y)}this._nodes=s,this._edges=o,this._nodeMap=new Map(s.map(a=>[a.id,a])),et.nodes=this._nodes,et.edges=this._edges,et._calcTreeDepths(this._nodes,this._edges),et.reheat(this._clusterMode==="strict"?0:.3),W.loadGraph(this._nodes,this._edges),W.markDirty(),this._renderSidebarTree(this._nodes),this._updateStats(this._nodes),It.load(this._nodes),await this._applyTagsFromConfig(),W.markDirty(),k.toast("‚òÅ Dropbox: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ","info",1500)}}catch(t){console.warn("[Dropbox Sync] Error:",t.message)}},2e3))},disconnectDropbox(){Tt.logout(),st=new Zt,_t=!1,k.hide(k.el("btn-sync-dropbox")),this.goHome()},async ctx_delete(){k.hide(k.el("context-menu"));const t=this._nodeMap.get(this._ctxTargetId);if(!t||!confirm(`–£–¥–∞–ª–∏—Ç—å ¬´${t.name}¬ª?

–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!`))return;const e=t._dbxPath??t.path,r=new Set,i=a=>{r.add(a),this._edges.filter(d=>d.source===a).forEach(d=>i(d.target))};i(t.id);const s=[...this._nodes],o=[...this._edges];this._nodes=this._nodes.filter(a=>!r.has(a.id)),this._edges=this._edges.filter(a=>!r.has(a.source)&&!r.has(a.target)),this._applyGraph(.4),k.toast(`–£–¥–∞–ª–µ–Ω–æ: ${t.name}`,"success"),mt.add({type:"delete",title:`–£–¥–∞–ª–µ–Ω–∏–µ ¬´${t.name}¬ª`,status:"success",tags:[t.name,(e||t.path||"").replace(/^\//,"")]});try{_t&&st.deleteNode&&(await st.deleteNode(t),e&&await this._persistTagsConfig(e,null),this._syncDropboxNow())}catch(a){a.message&&a.message.includes("not_found")?console.warn("[Delete] Already deleted on server, ignoring:",a.message):(this._nodes=s,this._edges=o,this._applyGraph(0),k.toast(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${a.message}`,"error",3e3),mt.add({type:"delete",title:`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${t.name}`,status:"error",tags:[a.message]}))}},async ctx_copyNode(){k.hide(k.el("context-menu"));const t=this._nodeMap.get(this._ctxTargetId);if(!t)return;if(!_t||!st.copyNode){k.toast("–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è Dropbox","info",3e3);return}const n=this._nodeMap.get(t.parentId);if(n){this._showLoading("–ö–û–ü–ò–†–û–í–ê–ù–ò–ï‚Ä¶");try{const e=await st.copyNode(t,n),r=e.path_display,i=k.hashStr(r),s={id:i,name:e.name,path:r,type:t.type,sizeBytes:t.sizeBytes,subtreeSizeBytes:t.sizeBytes,modifiedAt:new Date,parentId:t.parentId,handle:null,_radius:t._radius,_dbxPath:r},o={id:`${t.parentId}-${i}`,source:t.parentId,target:i};this._nodes.push(s),this._edges.push(o),this._nodeMap.set(i,s),W.loadGraph(this._nodes,this._edges),et.nodes=this._nodes,et.edges=this._edges,et._calcTreeDepths(this._nodes,this._edges),et.reheat(.5),W.markDirty(),this._renderSidebarTree(this._nodes),k.toast(`–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: ${e.name}`,"success")}catch(e){k.toast(`–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ${e.message}`,"error",3e3)}finally{this._hideLoading()}}},async ctx_rename(){k.hide(k.el("context-menu"));const t=this._nodeMap.get(this._ctxTargetId);t&&W.showInlineInput(t.x,t.y,t.name,async n=>{if(!(!n||n===t.name))if(_t&&st.renameNode){const e=t._dbxPath??t.path;this._showLoading("–ü–ï–†–ï–ò–ú–ï–ù–û–í–ê–ù–ò–ï‚Ä¶");try{await st.renameNode(t,n),t._tag&&await this._persistTagsConfigPathMove(e,t._dbxPath??t.path,t._tag),this._nodeMap=new Map(this._nodes.map(r=>[r.id,r])),W.markDirty(),this._renderSidebarTree(this._nodes),k.toast(`–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –≤: ${n}`,"success"),mt.add({type:"rename",title:"–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ",status:"success",tags:[t.name,n]})}catch(r){k.toast(`–û—à–∏–±–∫–∞: ${r.message}`,"error",3e3),mt.add({type:"rename",title:`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è: ${t.name}`,status:"error",tags:[r.message]})}finally{this._hideLoading()}}else k.toast("–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è Dropbox","info",3e3)})},_tagColors:{urgent:"#ff4444",review:"#ffaa00",wip:"#44aaff",done:"#44cc44",important:"#cc44ff"},async _persistTagsConfig(t,n){if(!(!_t||!st.readTagsConfig||!st.writeTagsConfig))try{const e=await st.readTagsConfig()||{pathToTag:{}};e.pathToTag||(e.pathToTag={}),n?e.pathToTag[t]=n:delete e.pathToTag[t],await st.writeTagsConfig(e)}catch(e){console.warn("[Tags] Failed to persist:",e.message),k.toast("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–≥–∏ –≤ Dropbox","error",2e3)}},async _persistTagsConfigPathMove(t,n,e){if(!(!e||!_t||!st.readTagsConfig||!st.writeTagsConfig))try{const r=await st.readTagsConfig()||{pathToTag:{}};r.pathToTag||(r.pathToTag={}),delete r.pathToTag[t],r.pathToTag[n]=e,await st.writeTagsConfig(r)}catch(r){console.warn("[Tags] Failed to update path:",r.message)}},async ctx_setTag(t){k.hide(k.el("context-menu"));const n=this._nodeMap.get(this._ctxTargetId);if(!n)return;n._tag===t?n._tag=null:n._tag=t,W.markDirty();const e=n._dbxPath??n.path;e&&_t&&await this._persistTagsConfig(e,n._tag),k.toast(n._tag?`–¢–µ–≥: #${t}`:"–¢–µ–≥ —Å–Ω—è—Ç","info",1500)},ctx_toggleGroupFolder(){k.hide(k.el("context-menu"));const t=this._nodeMap.get(this._ctxTargetId);if(!t||t.type!=="folder")return;this._groupedFolders.has(t.id)?(this._groupedFolders.delete(t.id),k.toast(`–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–Ω—è—Ç–∞: ${t.name}`,"info",1500)):(this._groupedFolders.add(t.id),k.toast(`–§–∞–π–ª—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã: ${t.name}`,"success",1500)),(!this._rawNodes||!this._rawEdges)&&this._syncRawData();const n=this._rawNodes.map(s=>({...s})),e=this._rawEdges.map(s=>({...s})),{nodes:r,edges:i}=this._groupFiles(n,e);this._nodes=r,this._edges=i,this._applyGraph(.3)},saveComment(t,n){t&&(n&&n.trim()?this._nodeComments.set(t,n.trim()):this._nodeComments.delete(t),this._persistComments())},_persistComments(){try{const t={};for(const[n,e]of this._nodeComments)t[n]=e;localStorage.setItem("aetherfs-comments",JSON.stringify(t))}catch{}},_loadComments(){try{const t=localStorage.getItem("aetherfs-comments");if(t){const n=JSON.parse(t);for(const[e,r]of Object.entries(n))this._nodeComments.set(e,r)}}catch{}},ctx_toggleFavorite(){k.hide(k.el("context-menu"));const t=this._nodeMap.get(this._ctxTargetId);t&&(this._favorites.has(t.id)?(this._favorites.delete(t.id),k.toast(`–£–±—Ä–∞–Ω–æ –∏–∑ –ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ: ${t.name}`,"info",1500)):(this._favorites.add(t.id),k.toast(`–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –ò–∑–±—Ä–∞–Ω–Ω–æ–µ: ${t.name}`,"success",1500)),this._persistFavorites(),W.markDirty())},_persistFavorites(){try{localStorage.setItem("aetherfs-favorites",JSON.stringify([...this._favorites]))}catch{}},_loadFavorites(){try{const t=localStorage.getItem("aetherfs-favorites");if(t){const n=JSON.parse(t);Array.isArray(n)&&(this._favorites=new Set(n))}}catch{}}};document.addEventListener("DOMContentLoaded",()=>{ne.init()});
